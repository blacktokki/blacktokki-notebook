"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[515],{96515:(t,e,n)=>{n.r(e),n.d(e,{default:()=>Ye});var r=n(24586),i=n(86330),o=n(32024),a=n(12089),l=n(29399),u=n(20048),s=n(88610),c=n(77650),d=n(50910),f=n(90689),p=n(83705),h=n(54807),g=n(47904),y=n(63390),x=n(63717),v=n(56927),m=n(95346),j=n(20863),b=n(82103),O=n(41867),P=n(8594),w=n(5209),C=n(68111),S="@blacktokki:notebook:keywords:",k=function(){var t=(0,i.default)((function*(t){try{var e=yield w.default.getItem(S+t);return e?JSON.parse(e):[]}catch(n){return console.error("Error loading keywords",n),[]}}));return function(e){return t.apply(this,arguments)}}(),D=function(){var t=(0,i.default)((function*(t,e){try{var n=JSON.stringify(e);yield w.default.setItem(S+t,n)}catch(r){console.error("Error saving keywords",r)}}));return function(e,n){return t.apply(this,arguments)}}(),E=function(){var t,e=(0,P.useAuthContext)().auth,n=e.isLocal?"":`${null==(t=e.user)?void 0:t.id}`;return(0,C.useQuery)({queryKey:["keywords",n],queryFn:function(){var t=(0,i.default)((function*(){return yield k(n)}));return function(){return t.apply(this,arguments)}}()})},L=(0,P.axiosCreate)("notebook"),T=(function(){var t=(0,i.default)((function*(t){return(yield L.get(`/api/v1/content/${t}`)).data}))}(),function(){var t=(0,i.default)((function*(t,e){var n=void 0!==t?`&parentId=${t}`:"",r=void 0!==e?`&types=${e.join(",")}`:"";return(yield L.get(`/api/v1/content?self=true&size=256${n}${r}`)).data.value}));return function(e,n){return t.apply(this,arguments)}}()),F=function(){var t=(0,i.default)((function*(t){return(yield L.post("/api/v1/content",t)).data.id}));return function(e){return t.apply(this,arguments)}}(),N=function(){var t=(0,i.default)((function*(t){var e=t.id,n=t.updated;yield L.patch("/api/v1/content",{ids:[e],updated:n})}));return function(e){return t.apply(this,arguments)}}(),B=(function(){var t=(0,i.default)((function*(t){yield L.delete(`/api/v1/content/${t}`)}))}(),function(){var t=(0,i.default)((function*(t){return(yield L.get(`/api/v1/preview/autocomplete?query=${t.query}`)).data}));return function(e){return t.apply(this,arguments)}}());function M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function R(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function I(){return z.apply(this,arguments)}function z(){return(z=(0,i.default)((function*(){return new Promise((function(t,e){var n=indexedDB.open("@Blacktokki:notebook",1);n.onupgradeneeded=function(t){var e=t.target.result;e.objectStoreNames.contains("NOTE")||e.createObjectStore("NOTE",{keyPath:"title"})},n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}}))}))).apply(this,arguments)}var A,$="@blacktokki:notebook:recent_pages",H=function(){var t=(0,i.default)((function*(t,e){if(t)return yield T(void 0,[e]);if("SNAPSHOT"===e)return[];try{var n=yield I();return new Promise((function(t){var r=n.transaction(e,"readonly").objectStore(e).getAll();r.onsuccess=function(){t(r.result)},r.onerror=function(){throw console.error("Error loading contents from IndexedDB:",r.error),r.error}}))}catch(r){return console.error("Error opening IndexedDB",r),[]}}));return function(e,n){return t.apply(this,arguments)}}(),W=function(){var t=(0,i.default)((function*(t,e,n){var r=e.find((function(t){return n===t.id}));if(t){if(r){var i=yield n?N({id:n,updated:r}).then((function(){return n})):F(r),o=R(R({},r),{},{type:"SNAPSHOT",id:void 0,parentId:i});yield F(o)}}else try{var a=(yield I()).transaction(["NOTE"],"readwrite"),l=a.objectStore("NOTE");for(var u of e)l.put(u);yield new Promise((function(t,e){a.oncomplete=function(){return t(void 0)},a.onerror=function(){return e(a.error)}}))}catch(s){console.error("Error saving contents to IndexedDB",s)}}));return function(e,n,r){return t.apply(this,arguments)}}(),q=function(){var t=(0,i.default)((function*(){try{var t=yield w.default.getItem($);return t?JSON.parse(t):[]}catch(e){return console.error("Error loading recent pages",e),[]}}));return function(){return t.apply(this,arguments)}}(),Y=function(){var t=(0,i.default)((function*(t){try{var e=JSON.stringify(t);yield w.default.setItem($,e)}catch(n){console.error("Error saving recent pages",n)}}));return function(e){return t.apply(this,arguments)}}(),K=function(){var t=(0,P.useAuthContext)().auth;return(0,C.useQuery)({queryKey:["pageContents",!t.isLocal],queryFn:function(){var e=(0,i.default)((function*(){return yield H(!t.isLocal,"NOTE")}));return function(){return e.apply(this,arguments)}}()})},Q=function(){var t=(0,P.useAuthContext)().auth;return(0,C.useQuery)({queryKey:["snapshotContents",!t.isLocal],queryFn:function(){var e=(0,i.default)((function*(){return yield H(!t.isLocal,"SNAPSHOT")}));return function(){return e.apply(this,arguments)}}()})},V=function(t){var e=(0,C.useQueryClient)(),n=K(),r=n.data,o=void 0===r?[]:r,a=n.isFetching;return(0,C.useQuery)({queryKey:["pageContent",t],queryFn:function(){var n=(0,i.default)((function*(){var n=o.find((function(e){return e.title===t}));n&&(void 0===(yield q()).find((function(e){return e===t}))&&(A=t,yield e.invalidateQueries({queryKey:["lastPage"]})));return n||{title:t,description:"",id:void 0}}));return function(){return n.apply(this,arguments)}}(),enabled:!a})},_=function(){var t=K(),e=t.data,n=void 0===e?[]:e,r=t.isFetching;return(0,C.useQuery)({queryKey:["lastPage"],queryFn:function(){var t=(0,i.default)((function*(){return n.find((function(t){return t.title===A}))}));return function(){return t.apply(this,arguments)}}(),enabled:!r})},U=function(){var t=(0,C.useQueryClient)(),e=(0,P.useAuthContext)().auth,n=K().data,r=void 0===n?[]:n;return(0,C.useMutation)({mutationFn:function(){var t=(0,i.default)((function*(t){var n,i=t.title,o=t.description,a=r.find((function(t){return t.title===i}));if((null==a?void 0:a.description)===o)return{title:i,description:o,skip:!0};var l=e.isLocal?(new Date).toISOString():void 0;if(a)n=r.map((function(t,e){return t.id===a.id?R(R({},t),{},{description:o,updated:l}):t}));else{var u,s={title:i,description:o,input:i,userId:(null==(u=e.user)?void 0:u.id)||0,parentId:0,type:"NOTE",order:0,updated:l,option:{}};n=[].concat((0,p.default)(r),[s])}return yield W(!e.isLocal,n,null==a?void 0:a.id),{title:i,description:o,skip:!1}}));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(){var e=(0,i.default)((function*(e){e.skip||(yield t.invalidateQueries({queryKey:["pageContents"]}),yield t.invalidateQueries({queryKey:["snapshotContents"]}),yield t.invalidateQueries({queryKey:["pageContent",e.title]}),yield t.invalidateQueries({queryKey:["recentPages"]}))}));return function(t){return e.apply(this,arguments)}}()})},G=function(){var t=(0,C.useQueryClient)();return(0,C.useMutation)({mutationFn:function(){var t=(0,i.default)((function*(t){var e=(yield q()).filter((function(e){return t!==e}));return A=void 0,yield Y(e),{title:t}}));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(e){t.invalidateQueries({queryKey:["recentPages"]}),t.invalidateQueries({queryKey:["pageContent"]}),t.invalidateQueries({queryKey:["lastPage"]})}})},J=function(t){return j.default.create({container:{flex:1,backgroundColor:"dark"===t?"#121212":"#FFFFFF",paddingHorizontal:24,paddingVertical:16},card:{backgroundColor:"dark"===t?"#1E1E1E":"#FFFFFF",borderRadius:8,padding:16,marginBottom:16,borderWidth:1,borderColor:"dark"===t?"#333333":"#EEEEEE",shadowColor:"dark"===t?"#000000":"#888888",shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:4,elevation:2},title:{fontSize:18,fontWeight:"bold",marginBottom:8,color:"dark"===t?"#FFFFFF":"#000000"},text:{fontSize:16,color:"dark"===t?"#E4E4E4":"#333333",lineHeight:24},button:{backgroundColor:"dark"===t?"#2C73B5":"#3498DB",borderRadius:4,padding:12,alignItems:"center",marginVertical:8},buttonText:{color:"#FFFFFF",fontWeight:"500",fontSize:16},searchButton:{backgroundColor:"#3498DB",justifyContent:"center",alignItems:"center",width:36,height:36,borderRadius:4,marginHorizontal:4},resultSeparator:{height:1,backgroundColor:"dark"===t?"#333333":"#EEEEEE"},input:{backgroundColor:"dark"===t?"#222222":"#FFFFFF",borderWidth:1,borderColor:"dark"===t?"#444444":"#CCCCCC",borderRadius:4,padding:10,color:"dark"===t?"#E4E4E4":"#333333",marginBottom:16},separator:{height:1,backgroundColor:"dark"===t?"#333333":"#EEEEEE",marginVertical:12},smallText:{fontSize:14,color:"dark"===t?"#BBBBBB":"#777777"},header:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:16},flex:{flex:1},row:{flexDirection:"row",alignItems:"center"},centerContent:{justifyContent:"center",alignItems:"center"}})},X=n(50575);function Z(t){for(var e=(new DOMParser).parseFromString(t,"text/html"),n=[{path:"",title:"",header:"",level:0,description:""}],r=["H1","H2","H3","H4","H5","H6"],i=[],o=null,a=e.body.firstChild,l=function(){o&&(n.push(o),o=null)};a;){if(a.nodeType===Node.ELEMENT_NODE){var u=a;if(r.includes(u.tagName)){var s;l();for(var c=parseInt(u.tagName.substring(1),10),d=(null==(s=u.textContent)?void 0:s.trim())||"";i.length>0&&i[i.length-1].level>=c;)i.pop();i.push({level:c,title:d});var f=i.map((function(t){return t.title})).join(" > ");o={path:f,title:d,level:c,header:u.outerHTML,description:""}}else o?o.description+=u.outerHTML:n[0].description+=u.outerHTML}else a.nodeType===Node.TEXT_NODE&&o&&(o.description+=a.textContent||"");a=a.nextSibling}return l(),n}function tt(t){var e=(0,o.useColorScheme)(),n=J(e);return(0,X.jsx)(g.default,{style:[et.resultsContainer,"dark"===e?et.darkResults:et.lightResults],children:(0,X.jsx)(v.default,{data:t.data,keyExtractor:function(t){return t.path},renderItem:function(e){return function(e){return(0,X.jsxs)(x.default,{style:et.resultItem,onPress:function(){return t.onPress(e)},children:[0===e.level&&(0,X.jsx)(O.default,{name:"file-text-o",size:18,color:"#FFFFFF"}),(0,X.jsx)(o.Text,{style:[t.path===e.path?[n.title,{marginBottom:5,marginTop:3}]:n.text,et.resultText,{left:10*e.level+10}],children:0===e.level?t.root:e.title})]})}(e.item)},ItemSeparatorComponent:function(){return(0,X.jsx)(g.default,{style:n.resultSeparator})}})})}var et=j.default.create({backButton:{padding:8},resultItem:{padding:10,flexDirection:"row"},resultText:{fontSize:14},buttonContainer:{flexDirection:"row",justifyContent:"space-between"},resultsContainer:{borderWidth:1,borderRadius:4},lightResults:{backgroundColor:"#FFFFFF",borderColor:"#CCCCCC"},darkResults:{backgroundColor:"#222222",borderColor:"#444444"}});function nt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function rt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?nt(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):nt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var it="";function ot(t){var e=new URL(t);if(location.origin===e.origin){var n=new URLSearchParams(e.search),r=n.get("title"),i=n.get("paragraph")||void 0;if(r)return{title:r,paragraph:i}}}function at(t,e){var n=ot(t);n?e.push("NotePage",n):window.open(t,"_blank")}function lt(t){return t.flatMap((function(t){return function(t){var e=(new DOMParser).parseFromString(t,"text/html").querySelectorAll("a");return Array.from(e).map((function(t){var e;return{text:(null==(e=t.textContent)?void 0:e.trim())||t.href,url:t.href}}))}(t.description||"").map((function(e){var n=ot(e.url);if(n&&e.text!==n.title)return rt(rt({type:"_NOTELINK",name:e.text},n),{},{origin:t.title})})).filter((function(t){return void 0!==t}))}))}var ut=function(t,e){var n=e.toLowerCase(),r=lt(t);return[].concat((0,p.default)(t.filter((function(t){return t.title.toLowerCase().startsWith(n)}))),(0,p.default)(r.filter((function(t){return t.name.toLowerCase().startsWith(n)}))))},st=function(){var t=(0,o.useColorScheme)(),e=J(t),n=(0,h.useNavigation)(),r=K().data,i=(void 0===r?[]:r).filter((function(t){return t.description}));return i&&(0,X.jsx)(x.default,{style:e.searchButton,onPress:function(){var t=i[Math.floor(Math.random()*i.length)],e=Z(t.description||"");n.push("NotePage",{title:t.title,paragraph:e[Math.floor(Math.random()*e.length)].title})},children:(0,X.jsx)(O.default,{name:"random",size:18,color:"#FFFFFF"})})},ct=function(t){return`${t.title}${t.paragraph?" \u25b6 "+t.paragraph:""}`},dt=function(t){var e=t.filteredPages,n=t.handlePagePress,r=t.addKeyword,i=(0,o.useColorScheme)(),a=J(i),u=(0,l.useCallback)((function(t){return b.default.create({onPanResponderStart:function(){"_NOTELINK"===t.type&&t.paragraph?(n(t.title,t.paragraph),null==r||r(t)):(n(t.title),null==r||r({type:"_KEYWORD",title:t.title}))}}).panHandlers}),[]);return(0,X.jsx)(v.default,{data:e,keyExtractor:function(t){return JSON.stringify([t.title,t.name,t.paragraph])},renderItem:function(t){var e=t.item;return(0,X.jsxs)(x.default,rt(rt({style:pt.resultItem},u(e)),{},{children:[(0,X.jsx)(m.default,{style:[a.text,pt.resultText],children:"_NOTELINK"===e.type?e.name:e.title}),"_NOTELINK"===e.type&&(0,X.jsx)(m.default,{style:[a.text,pt.resultText,{fontSize:12}],children:ct(e)})]}))},ItemSeparatorComponent:function(){return(0,X.jsx)(g.default,{style:[a.resultSeparator]})}})},ft=function(t){var e=t.handlePress,n=t.useRandom,r=void 0===n||n,a=(0,l.useState)(it),u=(0,f.default)(a,2),s=u[0],c=u[1],d=(0,l.useState)(!1),v=(0,f.default)(d,2),j=v[0],w=v[1],S=(0,h.useNavigation)(),L=(0,o.useColorScheme)(),T=J(L),F=(0,l.useRef)(),N=E().data,B=void 0===N?[]:N,M=function(){var t,e=(0,C.useQueryClient)(),n=(0,P.useAuthContext)().auth,r=n.isLocal?"":`${null==(t=n.user)?void 0:t.id}`;return(0,C.useMutation)({mutationFn:function(){var t=(0,i.default)((function*(t){var e=yield k(r),n=(0,p.default)(new Set([JSON.stringify(t)].concat((0,p.default)(e.map((function(t){return JSON.stringify(t)})))))).map((function(t){return JSON.parse(t)}));yield D(r,n)}));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(){var t=(0,i.default)((function*(){yield e.invalidateQueries({queryKey:["keywords",r]})}));return function(){return t.apply(this,arguments)}}()})}(),R=K().data,I=void 0===R?[]:R,z=s.length>0?ut(I,s).slice(0,10):B.slice(0,10),A=function(){s.trim()&&($(s.trim()),M.mutate({type:"_KEYWORD",title:s.trim()}))},$=function(t,n){e?e(t):S.push("NotePage",{title:t,paragraph:n}),c("")},H=(0,l.useMemo)((function(){return b.default.create({onPanResponderStart:A}).panHandlers}),[s]);return(0,l.useEffect)((function(){it=s}),[s]),(0,h.useFocusEffect)((function(){s!==it&&c(it)})),(0,X.jsxs)(g.default,{style:pt.container,children:[(0,X.jsxs)(g.default,{style:pt.searchContainer,children:[(0,X.jsx)(y.default,{ref:function(t){F.current=t},style:[T.input,pt.searchInput],value:s,onChangeText:function(t){c(t)},placeholder:"\uac80\uc0c9",placeholderTextColor:"dark"===L?"#777777":"#999999",onSubmitEditing:A,onFocus:function(){return w(!0)},onBlur:function(){return w(!1)}}),(0,X.jsx)(x.default,{style:T.searchButton,onPress:A,disabled:!s.trim(),children:(0,X.jsx)(O.default,{name:"search",size:18,color:"#FFFFFF"})}),r&&(0,X.jsx)(st,{})]}),j&&(0,X.jsx)(g.default,{style:[pt.resultsContainer,"dark"===L?pt.darkResults:pt.lightResults],children:z.length>0?(0,X.jsx)(dt,{filteredPages:z,handlePagePress:$,addKeyword:M.mutate}):s.trim()?(0,X.jsx)(x.default,rt(rt({style:pt.resultItem},H),{},{children:(0,X.jsxs)(m.default,{style:[T.text,pt.resultText],children:['"',s,'" \uc0c8 \ub178\ud2b8 \ub9cc\ub4e4\uae30']})})):null})]})},pt=j.default.create({container:{position:"relative",width:"100%",maxWidth:960,zIndex:999},searchContainer:{flexDirection:"row"},searchInput:{flex:1,height:36,marginBottom:0,paddingVertical:4,fontSize:14},resultsContainer:{position:"absolute",top:40,left:0,right:0,maxHeight:500,borderWidth:1,borderRadius:4,zIndex:999,elevation:5},lightResults:{backgroundColor:"#FFFFFF",borderColor:"#CCCCCC"},darkResults:{backgroundColor:"#222222",borderColor:"#444444"},resultItem:{flexDirection:"row",justifyContent:"space-between",padding:10},resultText:{fontSize:14}}),ht=n(16434),gt=n.n(ht);function yt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function xt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?yt(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var vt=function(t,e){for(var n=gt()(t),r=n.clone().startOf("month").add(-1,"month"),i=n.clone().endOf("month").add(1,"month"),o=e.map((function(t){return{startDate:gt()(t.dateStart),endDate:gt()(t.dateEnd)}})),a=[];r<=i;)o.find((function(t){return!t.startDate.isAfter(r)&&!t.endDate.isBefore(r)}))&&a.push(r.format("YYYY-MM-DD")),r=r.add(1,"day");return xt(xt(xt({},[].reduce((function(t,e){return t[e]={disabled:!0},t}),{})),a.reduce((function(t,e){return t[e]={marked:!0,dotColor:"red"},t}),{})),(t?[t]:[]).reduce((function(t,e){return t[e]={selected:!0},t}),{}))};function mt(t){var e=t.datetime,n=t.markedDateStrings,r=t.callback,i=e?gt()(e):function(){var t=gt()(),e=parseInt(t.format("mm"),10)%5;return t.add(5-e,"minute")}(),a=(0,o.useLangContext)(),u=a.lang,s=a.locale,c=(0,l.useState)(i.format("YYYY-MM-DD")),d=(0,f.default)(c,2),p=d[0],h=(d[1],(0,l.useState)(vt(i.format("YYYY-MM-DD"),n||[]))),g=(0,f.default)(h,2),y=g[0],v=g[1],m=(0,o.useModalsContext)().setModal,j=function(){m(mt,null)},b=function(t){null==r||r(t),j()};return(0,X.jsx)(o.View,{style:{flex:1,margin:0,justifyContent:"flex-end",backgroundColor:"transparent"},children:(0,X.jsxs)(o.View,{style:{alignItems:"center",minHeight:450},children:[(0,X.jsxs)(o.View,{style:{flexDirection:"row",width:"100%"},children:[(0,X.jsx)(o.View,{style:{flex:1,flexDirection:"row"},children:(0,X.jsx)(x.default,{onPress:j,children:(0,X.jsx)(o.Text,{children:u("back")})})}),(0,X.jsx)(o.View,{style:{flex:1},children:(0,X.jsx)(o.Text,{style:{fontSize:20,textAlign:"center"},children:u("Date")})}),(0,X.jsx)(o.View,{style:{flex:1}})]}),(0,X.jsx)(o.View,{style:{marginBottom:20,height:1,width:"100%"},lightColor:"#ddd",darkColor:"rgba(255,255,255, 0.3)"}),(0,X.jsx)(l.Suspense,{fallback:(0,X.jsx)(X.Fragment,{}),children:(0,X.jsx)(o.Calendar,{locale:s,style:void 0,date:p,setDate:b,disableAllTouchEventsForDisabledDays:!0,onMonthChange:function(t){return v(vt(t.dateString,n||[]))},markedDates:y})}),!1]})})}var jt=function(t){var e=t.contents,n=t.isLoading,r=t.onPress,i=t.emptyMessage,a=(0,o.useColorScheme)(),l=J(a);return(0,X.jsx)(g.default,{style:l.container,children:n?(0,X.jsx)(g.default,{style:[l.card,l.centerContent],children:(0,X.jsx)(m.default,{style:l.text,children:"\ub85c\ub529 \uc911..."})}):e.length>0?(0,X.jsx)(v.default,{data:e,keyExtractor:function(t){return JSON.stringify([t.title,t.paragraph,t.id])},renderItem:function(t){var e=t.item;return(0,X.jsxs)(x.default,{style:l.card,onPress:function(){return r(e.title,e.paragraph,e.id)},children:[(0,X.jsx)(m.default,{style:l.title,children:ct(e)}),(e.subtitles||[]).map((function(t,e){return(0,X.jsx)(m.default,{style:[l.smallText],children:t},e)}))]})},ItemSeparatorComponent:function(){return(0,X.jsx)(g.default,{style:{height:8}})}}):(0,X.jsx)(g.default,{style:[l.card,l.centerContent],children:(0,X.jsx)(m.default,{selectable:!1,style:l.text,children:i})})})},bt=n(9367),Ot=n(46072),Pt=n(76579),wt=n(52034),Ct=n(40205),St=n(57687),kt=n(54426);function Dt(t){var e=(new Date).getFullYear(),n=[{regex:/\b(\d{4}-\d{2}-\d{2})\/(\d{4}-\d{2}-\d{2})\b/g,parse:function(t){return{pattern:"YYYY-MM-DD",format:function(t,e){return`${t}/${e}`},text:t[0],dateStart:t[1],dateEnd:t[2],index:t.index}}},{regex:/\b(\d{4}-\d{2}-\d{2})\b/g,parse:function(t){return{pattern:"YYYY-MM-DD",text:t[0],dateStart:t[1],dateEnd:t[1],index:t.index}}},{regex:/\b\d{4}-\d{2}(?!-)\b/g,parse:function(t){var e=t[0].split("-"),n=parseInt(e[0],10),r=parseInt(e[1],10),i=new Date(n,r,0).getDate();return{pattern:"YYYY-MM",text:t[0],dateStart:`${n}-${String(r).padStart(2,"0")}-01`,dateEnd:`${n}-${String(r).padStart(2,"0")}-${String(i).padStart(2,"0")}`,index:t.index}}},{regex:/\b(?<!\d)(\d{2})\/(\d{2})(?!\d)\b/g,parse:function(t){var n=parseInt(t[1],10),r=parseInt(t[2],10);return{pattern:"MM/DD",text:t[0],dateStart:`${e}-${String(n).padStart(2,"0")}-${String(r).padStart(2,"0")}`,dateEnd:`${e}-${String(n).padStart(2,"0")}-${String(r).padStart(2,"0")}`,index:t.index}}}],r=[],i=[];for(var o of n)for(var a=new RegExp(o.regex.source,"g"),l=void 0,u=function(){var t=l.index,e=a.lastIndex;if(r.some((function(n){return t<n.index+n.text.length&&e>n.index})))return 1;r.push(o.parse(l)),i.push([t,e])};null!==(l=a.exec(t));)u();return r}function Et(t){var e=(new DOMParser).parseFromString(t,"text/html");return e.querySelectorAll("code").forEach((function(t){t.textContent=""})),e.querySelectorAll("tr").forEach((function(t){var e=t.querySelectorAll("td");if(e.length>1){var n=Array.from(e).map((function(t){var e;return(null==(e=t.textContent)?void 0:e.trim())||""})).join(" "),r=document.createElement("td");r.textContent=n,t.innerHTML="",t.appendChild(r)}})),e.body.innerHTML}var Lt=function(t,e){return e.map((function(e){var n=[(0,kt.toRaw)(e.header)].concat((0,p.default)((0,kt.toRaw)(Et(e.description)).split("\n"))).map((function(t,n){return{path:e.path,isHeader:0===n,original:t,matches:Dt(t)}}));return{title:t,paragraph:e.title,dateMatches:n}})).filter((function(t){return t.dateMatches.filter((function(t){return t.matches.length>0})).length>0}))},Tt=function(t,e){return t.filter((function(t){return t.matches.find((function(t){return new Date(t.dateStart).getTime()<=e&&e<=new Date(t.dateEnd).getTime()}))}))},Ft=function(){return gt()().format("YYYY-MM-DD")};const Nt=function(t){var e=gt()(t.data.dateStart),n=gt()(t.data.dateEnd).add(1,"day"),r=e.diff(t.now)/e.diff(n);return(0,X.jsx)(x.default,{onPress:function(){return t.toggleExpand()},children:(0,X.jsxs)(g.default,{style:{backgroundColor:"lightgray",borderRadius:20,overflow:"hidden",margin:4},children:[(0,X.jsx)(g.default,{style:{backgroundColor:"darkgray",position:"absolute",width:100*r+"%",height:"100%"}}),t.isExpand?(0,X.jsxs)(g.default,{style:{paddingVertical:4,paddingHorizontal:4,maxWidth:270},children:[(0,X.jsxs)(g.default,{style:{flexDirection:"row",alignItems:"stretch"},children:[(0,X.jsx)(m.default,{children:"\u231a"}),(0,X.jsx)(m.default,{selectable:!1,children:t.data.text})]}),(0,X.jsx)(m.default,{children:t.data.original}),(0,X.jsx)(g.default,{style:{width:"100%",alignItems:"center"},children:t.buttons(t.data).map((function(t){return(0,X.jsx)(o.CommonButton,{title:t.title,onPress:function(){return t.onPress()},style:{width:"100%",backgroundColor:"#8888",margin:4,maxWidth:150}},t.title)}))})]}):(0,X.jsx)(g.default,{style:{paddingVertical:4,paddingHorizontal:4,flexDirection:"row"},children:(0,X.jsx)(g.default,{style:{paddingHorizontal:4},children:(0,X.jsx)(m.default,{selectable:!1,children:t.data.text})})})]})})};var Bt=n(57917);function Mt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Rt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Mt(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Mt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var It=function(t,e){return t.original.substring(0,t.index)+e+t.original.substring(t.index+t.text.length)},zt=function(t,e,n,r){var i=r?gt()(t.dateStart).add(e,n).format(t.pattern):t.dateStart,o=gt()(t.dateEnd).add(e,n).format(t.pattern);return It(t,t.format?t.format(i,o):o)},At=function(t){var e=t.format;return[].concat((0,p.default)(t.pattern.includes("DD")?[{title:"+1d",onPress:function(){return t.replace(zt(t,1,"day",!0))}},{title:"+2d",onPress:function(){return t.replace(zt(t,2,"day",!0))}},{title:"+7d",onPress:function(){return t.replace(zt(t,7,"day",!0))}}]:[]),[{title:"+1M",onPress:function(){return t.replace(zt(t,1,"month",!0))}}],(0,p.default)(e?[{title:"+Period",onPress:function(){var n=gt()(t.dateStart),r=gt()(t.dateEnd),i=r.diff(n,"day");t.replace(It(t,e(n.add(i+1,"day").format(t.pattern),r.add(i+1,"day").format(t.pattern))))}},{title:"+0d/+1d",onPress:function(){return t.replace(zt(t,1,"day",!1))}},{title:"+0d/+2d",onPress:function(){return t.replace(zt(t,2,"day",!1))}},{title:"+0d/+7d",onPress:function(){return t.replace(zt(t,7,"day",!1))}},{title:"+0d/+1M",onPress:function(){return t.replace(zt(t,1,"month",!1))}}]:[]),[{title:"Delete",onPress:function(){return t.replace(It(t,""))}}])};const $t=function(t){var e=new Date(Ft()).getTime(),n=U(),r=Lt(t.title,t.paragraphs).flatMap((function(t){return Tt(t.dateMatches,e)})).flatMap((function(e){return e.matches.map((function(r){return Rt(Rt({},r),{},{original:e.original,replace:function(r){return n.mutate({title:t.title,description:t.paragraphs.map((function(t){return(t.path===e.path&&e.isHeader?t.header.replace(e.original,r):t.header)+(t.path!==e.path||e.isHeader?t.description:t.description.replace(e.original,r))})).join("")})}})}))})),i=(0,l.useState)(gt()()),o=(0,f.default)(i,2),a=o[0],u=o[1],s=(0,l.useState)(),c=(0,f.default)(s,2),d=c[0],p=c[1];return(0,l.useEffect)((function(){var t=setTimeout((function(){u(gt()())}),3e4);return function(){return clearTimeout(t)}}),[a]),(0,X.jsx)(g.default,{style:{height:0},children:(0,X.jsx)(g.default,{style:{flexDirection:"row",overflow:"hidden"},children:r.map((function(t,e){return(0,X.jsx)(Nt,{data:t,buttons:At,now:a,isExpand:e===d,toggleExpand:function(){return p(d===e?void 0:e)}},e)}))})})};var Ht=function(t,e,n){var r,i=null==(r=t.find((function(t){return t.title===e})))?void 0:r.path;return i?t.filter((function(t){return t.path.startsWith(i)})).map((function(t){return(n||t.path!==i?t.header:"")+t.description})).join(""):""},Wt=function(t){var e=t.split("/");return e.length<2?[t]:[e.slice(0,e.length-1).join("/"),e[e.length-1]]},qt=j.default.create({backButton:{padding:8},pageTitle:{flex:1,fontSize:20},actionButtons:{flexDirection:"row"},actionButton:{padding:8,marginLeft:8}});function Yt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Kt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Yt(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Yt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Qt=function(){function t(t){var e=(t.match(/[.!?]+/g)||[]).length||1,n=t.trim().split(/\s+/),r=n.length;return r/e*.39+n.reduce((function(t,e){return t+function(t){if((t=t.toLowerCase()).length<=3)return 1;var e=(t.match(/[aeiouy]+/g)||[]).length;return/e\b/.test(t)&&e>1&&e--,Math.max(e,1)}(e)}),0)/r*11.8-15.59}return function(e){var n,r=function(t){return(t.match(/[\uac00-\ud7a3]/g)||[]).length/t.length}(e),i=t(e),o=(n=i)<3?1:n<6?2:n<9?3:n<12?4:5,a=function(t){var e=t.split(/[.?!\r\n]/).filter((function(t){return t.trim().length>0})),n=t.trim().split(/\s+/).length/(e.length||1);return n<=7?1:n<=10?2:n<=13?3:n<=16?4:5}(e);return{koRatio:r,enLevel:o,koLevel:a,level:a*r+o*(1-r)}}}();function Vt(t){for(var e,n=[],r=/<(ul|ol)[^>]*?>([\s\S]*?)<\/\1>/gi,i=/<li[^>]*>([\s\S]*?)<\/li>/gi;null!==(e=r.exec(t));){for(var o=e,a=(0,f.default)(o,3),l=a[1],u=a[2],s=[],c=void 0;null!==(c=i.exec(u));){var d=c[1].trim();s.push(d)}n.push({type:l,items:s})}return n}const _t=function(){var t=K(),e=t.data,n=void 0===e?[]:e,r=t.isLoading,i=(0,l.useMemo)((function(){var t={},e=function(e,n,r){void 0===t[e]&&(t[e]={subtitles:[],paragraphs:{}});var i=t[e];void 0!==n?(void 0===i.paragraphs[n]&&(i.paragraphs[n]=[]),i.paragraphs[n].push(r)):i.subtitles.push(r)};return n.forEach((function(t){lt([t]).forEach((function(t){var r=n.find((function(e){return e.title===t.title}));null!=r&&r.description&&(void 0===t.paragraph||Z(r.description).find((function(e){return e.title===t.paragraph})))||e(t.title,t.paragraph,(void 0===t.paragraph?"Unknown note link":"Unknown paragraph link")+`(${t.origin})`)}));var r=Wt(t.title);t.description&&2===r.length&&void 0===n.find((function(t){return t.title===r[0]}))&&e(r[0],void 0,`Empty parent note(${t.title})`);var i=Z(t.description||""),o=i.map((function(t){return Kt(Kt({},t),{},{lists:Vt(t.description)})})).filter((function(t){return t.lists.length>0}));i.filter((function(t){return 0!==t.level&&""===Ht(i,t.title,!1).trim()})).forEach((function(n){return e(t.title,0===n.level?void 0:n.title,"Empty paragraph")})),o.filter((function(t){return t.lists.filter((function(t){return t.items.filter((function(t){return 0===t.replaceAll("&nbsp;","").trim().length})).length>0})).length>0})).forEach((function(n){return e(t.title,0===n.level?void 0:n.title,"Empty list")})),i.filter((function(t){return t!==i.findLast((function(e){return e.path===t.path}))})).forEach((function(n){return e(t.title,void 0,`Duplicate paragraphs(${n})`)})),i.map((function(t){var e=Et(t.description).split("\n").map((function(t){return(0,kt.toRaw)(t).trim()})).filter((function(t){return t.includes(" ")&&t.length>4}));return Kt(Kt({},t),{},{duplicates:e.filter((function(t,n){return n!==e.lastIndexOf(t)}))})})).forEach((function(n){return n.duplicates.forEach((function(r){return e(t.title,0===n.level?void 0:n.title,`Duplicate contents(${r})`)}))}));var a=t.description?Qt((0,kt.toRaw)(t.description.replaceAll(/<code\b[^>]*>[\s\S]*?<\/code>/gi,"<code></code>").replaceAll(/<br\s*[/]?>/gi,"\r\n"))):{level:0};a.level>3.5&&e(t.title,void 0,`Too high readability score: ${a.level.toFixed(4)} > 3.5`)})),Object.entries(t).flatMap((function(t){var e=(0,f.default)(t,2),n=e[0],r=e[1];return[].concat((0,p.default)(r.subtitles.length>0?[{title:n,subtitles:r.subtitles}]:[]),(0,p.default)(Object.entries(r.paragraphs).map((function(t){var e=(0,f.default)(t,2),r=e[0],i=e[1];return{title:n,paragraph:r,subtitles:i}}))))}))}),[n]);return{data:i,isLoading:r}};function Ut(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Gt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ut(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ut(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}const Jt=function(t){var e=new Date(t||Ft()).getTime(),n=K(),r=n.data,i=void 0===r?[]:r,o=n.isLoading,a=(0,l.useMemo)((function(){return i.flatMap((function(t){return Lt(t.title,Z((null==t?void 0:t.description)||""))}))}),[i]);return{data:a.map((function(t){return Gt(Gt({},t),{},{subtitles:Tt(t.dateMatches,e).map((function(t){return t.original}))})})).filter((function(t){return t.subtitles.length>0})),isLoading:o,preData:a}};function Xt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Zt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Xt(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Xt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var te=function(){var t=(0,o.useLangContext)().lang,e=Jt().data;return(0,X.jsx)(Pt.default,{left:function(t){return(0,X.jsx)(u.default,Zt(Zt({},t),{},{icon:"calendar"}))},right:function(t){return(0,X.jsx)(o.View,{style:{alignSelf:"center",backgroundColor:"transparent"},children:e.length>0&&(0,X.jsx)(wt.default,{children:e.length})})},title:t("TimeLine"),onPress:function(){return(0,a.navigate)("TimeLine")}})},ee=function(){var t=(0,o.useLangContext)().lang,e=_t().data;return(0,X.jsx)(Pt.default,{left:function(t){return(0,X.jsx)(u.default,Zt(Zt({},t),{},{icon:"note-alert"}))},right:function(t){return(0,X.jsx)(o.View,{style:{alignSelf:"center",backgroundColor:"transparent"},children:e.length>0&&(0,X.jsx)(wt.default,{children:e.length})})},title:t("Problems"),onPress:function(){return(0,a.push)("Problem")}})},ne=function(t){return t.filter((function(t){return t.description})).sort((function(t,e){return new Date(e.updated).getTime()-new Date(t.updated).getTime()}))};const re=function(t){var e=(0,o.useLangContext)().lang,n=K(),r=function(){var t=K(),e=t.data,n=void 0===e?[]:e,r=t.isFetching;return(0,C.useQuery)({queryKey:["recentPages"],queryFn:function(){var t=(0,i.default)((function*(){return(yield q()).map((function(t){return n.find((function(e){return e.title===t}))})).filter((function(t){return void 0!==t}))}));return function(){return t.apply(this,arguments)}}(),enabled:!r})}(),s=_().data,c=(0,l.useRef)(void 0),d=function(){var t=(0,C.useQueryClient)();return(0,C.useMutation)({mutationFn:function(){var t=(0,i.default)((function*(t){var e=t.title,n=t.direct,r=yield q();if(void 0===r.find((function(t){return t===e}))||n){var i=[e].concat((0,p.default)(r));yield Y(i)}return{title:e}}));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(e){t.invalidateQueries({queryKey:["recentPages"]})}})}(),f=G(),h="NOTE"===t.type?n.data?ne(n.data):[]:r.data,g=s&&void 0===(null==h?void 0:h.find((function(t){return t.id===s.id}))),y=(0,o.useResizeContext)(),x="landscape"===y?5:8,v=function(t){t===(null==s?void 0:s.title)&&(c.current?(clearTimeout(c.current),c.current=void 0,d.mutate({title:t})):c.current=setTimeout((function(){c.current=void 0}),500)),(0,a.navigate)("NotePage",{title:t})},m=function(t){var e;c.current&&(clearTimeout(c.current),c.current=void 0),void 0===(null==(e=r.data)?void 0:e.find((function(e){return e.title===t})))?d.mutate({title:t,direct:!0}):f.mutate(t)};return("LAST"!==t.type||g)&&(0,X.jsx)(Ct.default,{children:h&&("LAST"===t.type?g&&(0,X.jsx)(Pt.default,{left:function(t){return(0,X.jsx)(u.default,Zt(Zt({},t),{},{icon:"file-document"}))},title:s.title,onPress:function(){return v(s.title)},onLongPress:function(){return m(s.title)},style:{padding:x},titleStyle:{fontStyle:"italic"}}):"NOTE"===t.type?(0,X.jsxs)(X.Fragment,{children:[h.slice(0,t.noteCount).map((function(t){return(0,X.jsx)(Pt.default,{left:function(e){var n;return(0,X.jsx)(u.default,Zt(Zt({},e),{},{icon:void 0===(null==(n=r.data)?void 0:n.find((function(e){return e.title===t.title})))?"notebook":"notebook-edit"}))},title:t.title,onPress:function(){return v(t.title)},onLongPress:function(){return m(t.title)},style:{padding:x}},t.title)})),(0,X.jsx)(Pt.default,{left:function(t){return(0,X.jsx)(u.default,Zt(Zt({},t),{},{icon:"notebook-multiple"}))},title:e("more..."),onPress:function(){return(0,a.push)("RecentPages")},style:{padding:x}})]}):h.map((function(t){return(0,X.jsx)(Pt.default,{left:function(t){return(0,X.jsx)(u.default,Zt(Zt({},t),{},{icon:"file-document-edit"}))},right:function(e){return(0,X.jsx)(St.default,{style:{justifyContent:"center",borderRadius:x,width:40+2*x,height:40+2*x,margin:-x},onPress:function(){return f.mutate(t.title)},children:(0,X.jsx)(u.default,{style:{left:x-7},icon:"close"})})},title:t.title,onPress:function(){return(0,a.navigate)("NotePage",{title:t.title})},style:{padding:x}},t.title)})))})};function ie(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function oe(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ie(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ie(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ae=(new Date).getTimezoneOffset(),le=function(t){var e=new Date(t);e.setMinutes(e.getMinutes()-ae);var n=e.toISOString().slice(0,16),r=n.slice(0,10);return r===(new Date).toISOString().slice(0,10)?n.slice(11):r};function ue(t){var e=Array.from(t.attributes);for(var n of e)"href"===n.name?t.setAttribute("href",""):t.removeAttribute(n.name);for(var r of t.children)ue(r)}function se(t){var e=(new DOMParser).parseFromString(t,"text/html").body;for(var n of e.children)ue(n);return e.innerHTML}var ce=function(t){return t?20:4},de=function(t){return t?250:190},fe=l.memo((function(t){var e=t.item,n=t.index,r=(0,o.useResizeContext)(),i=de("landscape"===r),a=(0,o.useColorScheme)(),u=J(a),s="landscape"===r?2:0,c=(0,l.useState)(n<10),d=(0,f.default)(c,2),p=d[0],g=d[1];if((0,l.useEffect)((function(){if(!p){var t=setTimeout((function(){return g(!0)}),50*n-400);return function(){return clearTimeout(t)}}}),[e,n,p]),null===e)return(0,X.jsx)(o.View,{style:{flexBasis:"landscape"===r?"33%":"50%",maxWidth:i}});var y=(0,h.useNavigation)(),v=function(){return y.push("NotePage",{title:e.title})};return(0,X.jsxs)(x.default,{style:{flexBasis:"landscape"===r?"33%":"50%",padding:ce("landscape"===r),paddingRight:0,minWidth:i,maxWidth:i},onPress:v,children:[(0,X.jsx)(Ot.default,{onPress:v,style:[u.card,{paddingTop:8,aspectRatio:1/Math.sqrt(2),borderRadius:6,marginVertical:10,marginHorizontal:8,overflow:"hidden"}],children:(0,X.jsx)(Ot.default.Content,{style:{padding:0},children:p&&e.descriptionComponent})}),(0,X.jsxs)(o.View,{style:{flexDirection:"row",marginTop:10,padding:0,justifyContent:"space-between",alignItems:"center",width:"100%"},children:[(0,X.jsx)(o.Text,{style:{fontSize:14+s,overflow:"hidden"},children:e.title}),(0,X.jsx)(o.Text,{style:{fontSize:12+s,opacity:.4,textAlign:"right"},children:le(e.updated)})]})]})})),pe=l.memo((function(){var t=(0,o.useColorScheme)(),e=J(t),r=(0,o.useResizeContext)(),i=K(),a=i.data,u=void 0===a?[]:a,s=i.isLoading,c=(0,h.useNavigation)(),d=de("landscape"===r),f=(0,l.useMemo)((function(){return l.lazy((function(){return n.e(274).then(n.t.bind(n,39274,23))}))}),[]),g=(0,l.useMemo)((function(){return[].concat((0,p.default)(ne(u).map((function(t){return oe(oe({},t),{},{descriptionComponent:(0,X.jsx)(f,{source:{html:se(t.description||"").slice(0,300)||""},renderersProps:{a:{onPress:function(){return c.push("NotePage",{title:t.title})}}},tagsStyles:{body:{color:e.text.color}},contentWidth:d})})}))),[null,null])}),[u]),y=(d+5)*("landscape"===r?5:3);return s?(0,X.jsx)(o.View,{style:[e.card,e.centerContent],children:(0,X.jsx)(o.Text,{style:e.text,children:"\ub85c\ub529 \uc911..."})}):g.length>2?(0,X.jsx)(bt.default,{contentContainerStyle:{alignSelf:"center",backgroundColor:"transparent",flexBasis:"100%",maxWidth:y,flexWrap:"wrap",flexDirection:"row",paddingRight:ce("landscape"===r),justifyContent:"landscape"===r?void 0:"center"},children:(0,X.jsx)(l.Suspense,{children:g.map((function(t,e){return function(t){var e=t.item,n=t.index;return(0,X.jsx)(fe,{index:n,item:e},n)}({item:t,index:e})}))})},r):(0,X.jsx)(o.View,{style:[e.card,e.centerContent],children:(0,X.jsx)(o.Text,{style:e.text,children:"\ucd5c\uadfc \uc218\uc815\ud55c \ub178\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."})})}));function he(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ge(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?he(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):he(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ye=n(95225),xe=j.default.create({buttonContainer:{flexDirection:"row",justifyContent:"space-between"},cancelButton:{flex:1,marginRight:8,backgroundColor:"#95A5A6"},saveButton:{flex:1,marginLeft:8}}),ve=j.default.create({columns:{marginTop:8,marginBottom:16},backButton:{padding:8},buttonContainer:{flexDirection:"row",justifyContent:"space-between"},cancelButton:{flex:1,marginRight:8,backgroundColor:"#95A5A6"},moveButton:{flex:1,marginLeft:8}}),me=n(55589),je=n(31692),be=function(){var t=(0,i.default)((function*(t){var e=new(0,(yield n.e(779).then(n.t.bind(n,39779,23))).default);for(var r of t.filter((function(t){var e;return((null==(e=t.description)?void 0:e.length)||0)>0})))e.file(r.title+".md",r.description);var i=yield e.generateAsync({type:"blob"}),o=window.URL.createObjectURL(i),a=document.createElement("a");a.href=o,a.download="notebook.zip",document.body.appendChild(a),a.click(),setTimeout((function(){window.URL.revokeObjectURL(o)}),500),a.remove()}));return function(e){return t.apply(this,arguments)}}(),Oe=function(){var t=(0,i.default)((function*(){var t=yield new Promise((function(t,e){var n=document.createElement("input");n.type="file",n.accept="application/zip,.md,.markdown",n.style.display="none",n.multiple=!0,n.onchange=function(){n.files&&n.files.length>0?t(Array.from(n.files)):e(new Error("\ud30c\uc77c\uc774 \uc120\ud0dd\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."))},n.click()})),e=[],r=(yield n.e(779).then(n.t.bind(n,39779,23))).default;for(var i of t)if("application/zip"===i.type||i.name.endsWith(".zip")){var o=new r,a=(yield o.loadAsync(i)).files;for(var l in a){var u=o.files[l];u.dir||e.push({title:l.replace(/\.[^/.]+$/,""),description:(yield u.async("text")).toString()})}}else(i.name.endsWith(".md")||i.name.endsWith(".markdown"))&&e.push({title:i.name.replace(/\.[^/.]+$/,""),description:yield i.text()});return e}));return function(){return t.apply(this,arguments)}}(),Pe=function(t){var e=(0,o.useColorScheme)(),n=J(e),r=o.Colors[e].text;return(0,X.jsxs)(x.default,{style:[n.header,{marginBottom:0}],onPress:t.onPress,disabled:!t.onPress,children:[(0,X.jsx)(o.Text,{style:{fontSize:20,color:r,fontWeight:"600"},children:t.title}),t.onPress&&(0,X.jsx)(o.Text,{children:">"})]})},we=function(t){var e=(0,o.useColorScheme)(),n=o.Colors[e].text;return(0,X.jsx)(o.TextButton,{title:t.title,textStyle:{fontSize:16,color:n,textDecorationLine:t.active?"underline":"none"},style:{borderRadius:20},onPress:t.onPress})};const Ce=function(){var t,e=(0,o.useLangContext)().lang,n=(0,P.useAuthContext)(),r=n.auth,u=n.dispatch,s=(0,o.useColorScheme)(),c=(0,h.useNavigation)(),d=J(s),p=K().data,y=U(),x=(0,l.useState)(!1),v=(0,f.default)(x,2),m=v[0],j=v[1],b=E().data,O=void 0===b?[]:b,w=function(){var t,e=(0,C.useQueryClient)(),n=(0,P.useAuthContext)().auth,r=n.isLocal?"":`${null==(t=n.user)?void 0:t.id}`;return(0,C.useMutation)({mutationFn:function(){var t=(0,i.default)((function*(){yield D(r,[])}));return function(){return t.apply(this,arguments)}}(),onSuccess:function(){var t=(0,i.default)((function*(){yield e.invalidateQueries({queryKey:["keywords",r]})}));return function(){return t.apply(this,arguments)}}()})}();return(0,X.jsxs)(g.default,{children:[(0,X.jsx)(g.default,{style:d.card,children:(0,X.jsx)(a.ConfigSections,{})}),(0,X.jsxs)(g.default,{style:d.card,children:[(0,X.jsx)(Pe,{title:e("* Search Settings")}),(0,X.jsxs)(g.default,{style:{flexDirection:"row"},children:[(0,X.jsx)(we,{title:"Search History",onPress:function(){return j(!m)},active:m}),m&&!!O.length&&(0,X.jsx)(we,{title:"Clear",onPress:function(){return w.mutate()},active:!1})]}),m&&(0,X.jsx)(g.default,{style:[d.card,{padding:0}],children:(0,X.jsx)(dt,{filteredPages:O,handlePagePress:function(t,e){return c.push("NotePage",{title:t,paragraph:e})}})})]}),(0,X.jsxs)(g.default,{style:d.card,children:[(0,X.jsx)(Pe,{title:e("* Archive")}),(0,X.jsxs)(g.default,{style:{flexDirection:"row"},children:[(0,X.jsx)(we,{title:"Export",onPress:function(){return p&&be(p)},active:!1}),(0,X.jsx)(we,{title:"Import",onPress:function(){return Oe().then((function(t){return t.forEach((function(t){return y.mutate(t)}))}))},active:!1}),!r.isLocal&&(0,X.jsx)(we,{title:"Changelog",onPress:function(){return c.push("Archive",{})},active:!1})]})]}),(0,X.jsxs)(g.default,{style:d.card,children:[(0,X.jsxs)(g.default,{style:{flexDirection:"row",alignItems:"center"},children:[(0,X.jsx)(Pe,{title:e("* Account Settings")}),!r.isLocal&&(0,X.jsxs)(o.Text,{numberOfLines:1,ellipsizeMode:"tail",style:{marginLeft:4},children:["- ",null==(t=r.user)?void 0:t.username]})]}),(0,X.jsxs)(g.default,{style:{flexDirection:"row"},children:[!!r.user&&(0,X.jsx)(we,{title:"My Account",onPress:function(){return r.isLocal&&u({type:"LOGOUT_LOCAL"})},active:!r.isLocal}),(0,X.jsx)(we,{title:"Local Account",onPress:function(){return!r.isLocal&&u({type:"LOGIN_LOCAL"})},active:!!r.isLocal}),r.user?(0,X.jsx)(we,{title:"Logout",onPress:function(){return u({type:"LOGOUT_REQUEST"})},active:!1}):(0,X.jsx)(we,{title:"Login",onPress:function(){return u({type:"LOGOUT_LOCAL"})},active:!1})]})]})]})};var Se=function(){var t=(0,o.useColorScheme)(),e=(0,o.useLangContext)().lang;return(0,X.jsxs)(bt.default,{style:{flex:1,backgroundColor:o.Colors[t].background},children:[(0,X.jsx)(me.default,{style:{},selectable:!1,children:e("Open Pages")}),(0,X.jsx)(re,{type:"LAST"}),(0,X.jsx)(re,{type:"PAGE"}),(0,X.jsx)(me.default,{style:{},selectable:!1,children:e("Event Pages")}),(0,X.jsx)(te,{}),(0,X.jsx)(ee,{})]})},ke=function(){return(0,X.jsx)(pe,{})},De=function(){var t=(0,o.useColorScheme)(),e=J(t);return(0,X.jsx)(bt.default,{style:{flex:1},contentContainerStyle:[e.container,{backgroundColor:o.Colors[t].background}],children:(0,X.jsx)(Ce,{})})};var Ee=n(15189);function Le(t){var e=t.date,n=t.setDate,r=t.monthly,i=t.markedDateRange,a=(0,o.useColorScheme)(),l=J(a),u=(0,o.useModalsContext)().setModal,s=function(t){return n(gt()(e).add(t,r?"month":"day").format("YYYY-MM-DD"))},c=j.default.create({container:{backgroundColor:l.container.backgroundColor,shadowColor:l.text.color,borderColor:l.card.borderColor},dateDisplay:{color:l.text.color},todayButton:{backgroundColor:l.searchButton.backgroundColor},navButton:{backgroundColor:"dark"===a?"#333333":"#efefef"}});return(0,X.jsxs)(g.default,{style:[Te.container,c.container],children:[(0,X.jsx)(g.default,{style:l.flex}),(0,X.jsx)(g.default,{style:Te.dateContainer,children:(0,X.jsx)(x.default,{onPress:function(){return u(mt,{datetime:e,markedDateStrings:i,callback:function(t){return n(t||e)}})},children:(0,X.jsx)(o.Text,{style:[Te.dateDisplay,c.dateDisplay],children:e})})}),(0,X.jsxs)(g.default,{style:Te.navContainer,children:[(0,X.jsx)(x.default,{onPress:function(){return s(-1)},style:[Te.navButton,c.navButton],children:(0,X.jsx)(Ee.default,{name:"chevron-left",size:16,color:l.text.color})}),(0,X.jsx)(x.default,{onPress:function(){return n(Ft())},style:[Te.todayButton,c.todayButton],accessibilityLabel:"Go to today",children:(0,X.jsx)(o.Text,{style:Te.todayButtonText,children:"Today"})}),(0,X.jsx)(x.default,{onPress:function(){return s(1)},style:[Te.navButton,c.navButton],children:(0,X.jsx)(Ee.default,{name:"chevron-right",size:16,color:l.text.color})})]})]})}var Te=j.default.create({container:{width:"100%",alignSelf:"center",flexDirection:"row",justifyContent:"flex-end",padding:16,borderRadius:8,shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:4,elevation:2,borderWidth:1},dateContainer:{flex:1,minWidth:130,height:30,alignItems:"center",justifyContent:"center"},dateDisplay:{fontSize:20,fontWeight:"bold"},navContainer:{flex:1,minWidth:150,flexDirection:"row",justifyContent:"flex-end"},navButton:{width:30,height:30,justifyContent:"center",alignItems:"center",marginHorizontal:8,borderRadius:8,padding:8},todayButton:{alignItems:"center",justifyContent:"center",alignSelf:"center",paddingHorizontal:12,paddingVertical:6,borderRadius:6},todayButtonText:{fontSize:14,color:"#ffffff",fontWeight:"bold"}});function Fe(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ne(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Fe(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Fe(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Be=function(t){return t.isLocal?"Blacktokki Notebook - Local":"Blacktokki Notebook"},Me={Home:{title:Be,component:function(t){t.navigation,t.route;var e=(0,o.useLangContext)().lang,n=(0,o.useColorScheme)(),r=J(n),i=(0,P.useAuthContext)().auth.isLocal?"Blacktokki Notebook - Local":"Blacktokki Notebook",l=[{title:e("Discovery"),component:Se,icon:(0,X.jsx)(u.default,{icon:"compass"}),headerRight:function(){return(0,X.jsx)(X.Fragment,{})}},{title:e("All Notes"),component:ke,icon:(0,X.jsx)(u.default,{icon:"notebook"}),headerRight:function(){return(0,X.jsx)(X.Fragment,{})}},{title:e("Config"),component:De,icon:(0,X.jsx)(u.default,{icon:"dots-horizontal"}),headerRight:function(){return(0,X.jsx)(X.Fragment,{})}}];return(0,X.jsx)(a.HomeSection,{tabViews:l,homeView:{title:i,headerRight:function(){return(0,X.jsx)(ft,{})}},headerTitle:i,children:(0,X.jsxs)(g.default,{style:[r.container,{width:"100%",justifyContent:"space-between"}],children:[(0,X.jsx)(Ce,{}),(0,X.jsx)(o.ContractFooter,{buttons:[{icon:(0,X.jsx)(je.default,{name:"github",size:24,color:o.Colors[n].iconColor}),url:"https://github.com/blacktokki/blacktokki-notebook",isWeb:!0},{icon:(0,X.jsx)(je.default,{name:"mail",size:24,color:o.Colors[n].iconColor}),url:"mailto:ydh051541@naver.com",isWeb:!1}]})]})})},path:"home"},NotePage:{title:Be,component:function(){var t=(0,h.useIsFocused)(),e=(0,h.useRoute)(),n=e.params,r=n.title,i=n.paragraph,a=n.archiveId,u=(0,h.useNavigation)(),s=(0,o.useColorScheme)(),c=(0,o.useResizeContext)(),d=J(s),p=(0,l.useState)(!1),y=(0,f.default)(p,2),v=y[0],j=y[1],b=(0,l.useState)(!1),P=(0,f.default)(b,2),w=P[0],C=P[1],S=V(r),k=S.data,D=S.isFetching,E=Q().data,L=a?null==E?void 0:E.find((function(t){return t.id===a&&t.description!==(null==k?void 0:k.description)})):void 0,T=function(){u.navigate("EditPage",{title:r})},F=Z((null==k?void 0:k.description)||""),N=F.findIndex((function(t){return t.title===i})),B=[{icon:"arrow-left",moveParagraph:F.findLast((function(t,e){var n;return e<N&&(!w||(null==(n=F[N])?void 0:n.level)>=t.level)})),reverse:!1},{icon:"arrow-right",moveParagraph:F.find((function(t,e){var n;return e>N&&(!w||(null==(n=F[N])?void 0:n.level)>=t.level)})),reverse:!0}],M=(0,l.useState)(),R=(0,f.default)(M,2),I=R[0],z=R[1];(0,l.useEffect)((function(){var t,e;z(L?L.description:null==(t=i?w?Ht(F,i,!0):null==(e=F.find((function(t){return t.title===i})))?void 0:e.description:null==k?void 0:k.description)?void 0:t.trim())}),[k,L,i,w]),(0,l.useEffect)((function(){j(!1)}),[e]);var A=Wt(r),$="dark"===s?"#E4E4E4":"#333333",H="dark"===s?"#FFFFFF88":"#00000088";return t&&(0,X.jsxs)(X.Fragment,{children:["portrait"===c&&(0,X.jsx)(ft,{}),(0,X.jsxs)(bt.default,{style:[d.container,{paddingRight:12,scrollbarGutter:"stable"}],contentContainerStyle:{flexGrow:1},children:[(0,X.jsxs)(g.default,{style:[d.header,{zIndex:1}],children:[(0,X.jsxs)(g.default,{style:{flexDirection:"row"},children:[(0,X.jsx)(x.default,{onPress:function(){return(2===A.length?u.push:u.navigate)("NotePage",{title:A[0]})},children:(0,X.jsx)(m.default,{style:[d.title,qt.pageTitle,i||2===A.length?{color:H}:{}],numberOfLines:1,children:A[0]})}),2===A.length&&(0,X.jsxs)(X.Fragment,{children:[(0,X.jsx)(m.default,{style:[d.title,qt.pageTitle,{flex:0}],children:"/"}),(0,X.jsx)(x.default,{onPress:function(){return u.navigate("NotePage",{title:r})},children:(0,X.jsx)(m.default,{style:[d.title,qt.pageTitle,i?{color:H}:{}],numberOfLines:1,children:A[1]})})]}),!!i&&(0,X.jsx)(m.default,{style:[d.title,qt.pageTitle,{marginLeft:5}],numberOfLines:1,children:ct({title:"",paragraph:i})}),L&&(0,X.jsx)(m.default,{style:[d.text,{marginLeft:5,fontStyle:"italic"}],children:"("+L.updated+")"})]}),(0,X.jsxs)(g.default,{style:qt.actionButtons,children:[(0,X.jsx)($t,{title:(null==k?void 0:k.title)||"",paragraphs:F}),!i&&(0,X.jsx)(X.Fragment,{children:(0,X.jsx)(x.default,{onPress:function(){return u.navigate("Archive",{title:r})},style:qt.actionButton,children:(0,X.jsx)(O.default,{name:"history",size:16,color:$})})}),!!i&&(0,X.jsx)(X.Fragment,{children:(0,X.jsx)(x.default,{onPress:function(){return C(!w)},style:qt.actionButton,children:(0,X.jsx)(O.default,{name:w?"compress":"expand",size:16,color:$})})}),!(!i&&!I)&&!L&&(0,X.jsxs)(X.Fragment,{children:[(0,X.jsx)(x.default,{onPress:function(){return j(!v)},style:qt.actionButton,children:(0,X.jsx)(O.default,{name:"list",size:16,color:$})}),(0,X.jsx)(x.default,{onPress:function(){u.navigate("MovePage",{title:r,paragraph:i})},style:qt.actionButton,children:(0,X.jsx)(O.default,{name:"exchange",size:16,color:$})})]}),!(!i&&!I)&&!L&&!i&&(0,X.jsx)(X.Fragment,{children:(0,X.jsx)(x.default,{onPress:T,style:qt.actionButton,children:(0,X.jsx)(O.default,{name:"pencil",size:16,color:$})})})]})]}),(0,X.jsxs)(g.default,{style:d.flex,children:[(0,X.jsx)(g.default,{style:!v&&I?[d.card,{padding:0,marginBottom:0}]:{flex:1,position:"absolute"},children:(0,X.jsx)(kt.EditorViewer,{active:!0,value:I||"",theme:s,onLink:function(t){return at(t,u)},autoResize:!0})}),D||void 0===I?(0,X.jsx)(g.default,{style:[d.card,d.centerContent],children:(0,X.jsx)(Bt.default,{size:"large",color:"#3498DB"})}):v?(0,X.jsx)(tt,{data:F,path:i||"",root:r,onPress:function(t){return u.navigate("NotePage",{title:r,paragraph:t.title})}}):null!=k&&k.description?!!i&&(0,X.jsx)(g.default,{style:{flex:1,flexDirection:"row",justifyContent:"space-between",alignItems:"flex-end"},children:B.map((function(t){var e=t.moveParagraph,n=t.icon,i=t.reverse;return void 0!==e&&(0,X.jsxs)(x.default,{onPress:function(){return u.navigate("NotePage",0===e.level?{title:r}:{title:r,paragraph:e.title})},style:[{flexDirection:i?"row-reverse":"row",paddingVertical:16}],children:[(0,X.jsx)(O.default,{name:n,size:16,color:$,style:{alignSelf:"center"}}),(0,X.jsx)(m.default,{style:[d.text,{fontWeight:"bold",marginHorizontal:16}],children:0===e.level?r:e.title})]},n)}))}):(0,X.jsxs)(g.default,{style:[d.card,d.centerContent],children:[(0,X.jsx)(m.default,{style:d.text,children:"\uc544\uc9c1 \ub0b4\uc6a9\uc774 \uc5c6\ub294 \ubb38\uc11c\uc785\ub2c8\ub2e4. '\ud3b8\uc9d1' \ubc84\ud2bc\uc744 \ub20c\ub7ec \ub0b4\uc6a9\uc744 \ucd94\uac00\ud574\ubcf4\uc138\uc694."}),(0,X.jsx)(x.default,{onPress:T,style:d.button,children:(0,X.jsx)(m.default,{style:d.buttonText,children:"\ud3b8\uc9d1\ud558\uae30"})})]})]})]})]})},path:"page"},EditPage:{title:Be,component:function(){var t=(0,h.useRoute)(),e=(0,h.useIsFocused)(),n=t.params.title,r=(0,h.useNavigation)(),a=(0,o.useColorScheme)(),u=J(a),s=V(n),c=s.data,d=s.isLoading,y=K().data,v=void 0===y?[]:y,j=(0,l.useState)(""),b=(0,f.default)(j,2),O=b[0],P=b[1],w=U();return(0,l.useEffect)((function(){!d&&null!=c&&c.description&&P(null==c?void 0:c.description)}),[d,c]),(0,h.useFocusEffect)((function(){var t=function(t){t.preventDefault(),t.returnValue=""};return window.addEventListener("beforeunload",t),function(){return window.removeEventListener("beforeunload",t)}})),e&&(0,X.jsxs)(g.default,{style:u.container,children:[(0,X.jsx)(g.default,{style:u.header,children:(0,X.jsxs)(m.default,{style:[u.title,{flex:1}],children:[n," - \ud3b8\uc9d1"]})}),(0,X.jsx)(kt.Editor,{active:!0,value:O,setValue:P,theme:a,autoComplete:[{trigger:"[",getMatchedChars:function(){var t=(0,i.default)((function*(t){var e,r=(e=t,v.filter((function(t){return t.title.startsWith(n+"/")})).map((function(t){return{type:"_CHILDNOTE",name:t.title.split(n+"/")[1],title:t.title}})).filter((function(t){return t.name.toLowerCase().startsWith(e.toLowerCase())})));return[{type:"_NOTELINK",name:t,title:n,paragraph:t}].concat((0,p.default)(r.length?r:[{type:"_CHILDNOTE",name:t,title:n+"/"+t}]),(0,p.default)(ut(v,t))).map((function(t){var e="_NOTELINK"===t.type?t.name+`(${ct(t)})`:"_CHILDNOTE"===t.type?t.name:t.title;return{text:e,value:`<a href=${encodeURI("_NOTELINK"===t.type&&t.paragraph?`?title=${t.title}&paragraph=${t.paragraph}`:`?title=${t.title}`)}>${e}</a>`}}))}));return function(e){return t.apply(this,arguments)}}()},{trigger:"http",getMatchedChars:function(){var t=(0,i.default)((function*(t){var e="http"+t,n=new URL(e);if("http:"!==n.protocol&&"https:"!==n.protocol)return[];var r=yield B({query:e});return r.title?[{text:r.title,value:`<a href=${r.url}>${r.title}</a>`}]:[]}));return function(e){return t.apply(this,arguments)}}()}]}),(0,X.jsxs)(g.default,{style:xe.buttonContainer,children:[(0,X.jsx)(x.default,{style:[u.button,xe.cancelButton],onPress:function(){r.canGoBack()?r.goBack():r.navigate("NotePage",{title:n})},children:(0,X.jsx)(m.default,{style:u.buttonText,children:"\ucde8\uc18c"})}),(0,X.jsx)(x.default,{style:[u.button,xe.saveButton],onPress:function(){w.mutate({title:n,description:O},{onSuccess:function(){r.navigate("NotePage",{title:n})},onError:function(t){ye.default.alert("\uc624\ub958",t.message||"\ubb38\uc11c\ub97c \uc800\uc7a5\ud558\ub294 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}})},children:(0,X.jsx)(m.default,{style:u.buttonText,children:"\uc800\uc7a5"})})]})]})},path:"edit"},MovePage:{title:Be,component:function(){var t,e=(0,h.useRoute)().params,n=e.title,r=e.paragraph,a=(0,h.useNavigation)(),u=(0,o.useColorScheme)(),s=(0,o.useResizeContext)(),c=(0,l.useState)(n),d=(0,f.default)(c,2),y=d[0],v=d[1],j=V(n),b=j.data,O=j.isLoading,w=Z((null==b?void 0:b.description)||""),S=(null==(t=w.find((function(t){return t.title===r})))?void 0:t.path)||"",k=V(y).data,D=Z((null==k?void 0:k.description)||"").filter((function(t){return n!==y||S===t.path||!t.path.startsWith(S)})),E=(0,l.useState)(""),L=(0,f.default)(E,2),T=L[0],F=L[1],N=(0,l.useState)(),B=(0,f.default)(N,2),M=B[0],I=B[1],z=J(u),A=U(),$=function(){var t=(0,C.useQueryClient)(),e=K().data,n=void 0===e?[]:e,r=(0,P.useAuthContext)().auth;return(0,C.useMutation)({mutationFn:function(){var t=(0,i.default)((function*(t){var e=t.oldTitle,i=t.newTitle,o=t.description,a=n.find((function(t){return t.title===e}));if(!a)throw new Error("Page not found");if(n.some((function(t){return t.title===i})))throw new Error("Page with new title already exists");var l=n.map((function(t){return t.title===e?R(R({},t),{},{title:i,description:o||a.description}):t}));yield W(!r.isLocal,l,a.id);var u=(yield q()).map((function(t){return t===e?i:t}));return yield Y(u),{oldTitle:e,newTitle:i}}));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(e){t.invalidateQueries({queryKey:["pageContents"]}),t.invalidateQueries({queryKey:["snapshotContents"]}),t.invalidateQueries({queryKey:["pageContent",e.oldTitle]}),t.invalidateQueries({queryKey:["pageContent",e.newTitle]}),t.invalidateQueries({queryKey:["recentPages"]})}})}(),H=(0,l.useMemo)((function(){var t,e=w.filter((function(t){return t.path.startsWith(S)})),n=(null==k?void 0:k.title)===(null==b?void 0:b.title)+"/"+(null==(t=e[0])?void 0:t.title),r=e.map((function(t,e){return(n&&0===e?"":t.header)+t.description})).join(""),i=w.filter((function(t){return!t.path.startsWith(S)})),o=i.map((function(t){return t.header+t.description})).join(""),a=(null==b?void 0:b.title)===(null==k?void 0:k.title)?i:D,l=a.findLastIndex((function(t){return t.path.startsWith(T)}));return{sourceDescription:o,targetDescription:void 0===(null==k?void 0:k.id)?r:[].concat((0,p.default)(a.slice(0,l+1).map((function(t){return t.header+t.description}))),(0,p.default)(e.map((function(t,e){return(t.path===S&&""===t.description||n&&0===e?"":t.header)+t.description}))),(0,p.default)(a.slice(l+1).map((function(t){return t.header+t.description})))).join("")}}),[w,D,S,T]),Q=H.sourceDescription,_=H.targetDescription,G=function(){a.canGoBack()?a.goBack():a.navigate("NotePage",{title:n})};(0,l.useEffect)((function(){O||b||G(),b&&v(b.title+(r?`/${r}`:""))}),[b,O]),(0,l.useEffect)((function(){O||F(r?"":S)}),[r,O]);var et=w.find((function(t){return t.path===S})),nt=D.find((function(t){return t.path===T})),rt=!y.trim()||void 0===nt;return(0,X.jsx)(bt.default,{style:z.container,children:(0,X.jsxs)(g.default,{style:z.card,children:[(0,X.jsxs)(g.default,{style:{flexDirection:"landscape"===s?"row":"column",zIndex:1},children:[(0,X.jsxs)(g.default,{style:{zIndex:1},children:[(0,X.jsx)(m.default,{style:z.text,children:r?"\ud604\uc7ac \ub178\ud2b8 \uc81c\ubaa9 \ubc0f \ubb38\ub2e8:":"\ud604\uc7ac \ub178\ud2b8 \uc81c\ubaa9:"}),(0,X.jsx)(m.default,{style:[z.title,ve.columns],children:ct({title:n,paragraph:r})}),(0,X.jsx)(m.default,{style:z.text,children:"\uc0c8 \ub178\ud2b8 \uc81c\ubaa9 \ubc0f \ubb38\ub2e8:"}),(0,X.jsx)(ft,{handlePress:v,useRandom:!1}),(0,X.jsx)(g.default,{style:ve.columns,children:(0,X.jsx)(tt,{path:T,onPress:function(t){return F(t.path)},root:(null==k?void 0:k.title)||"",data:D})})]}),(0,X.jsxs)(g.default,{style:{flex:1},children:[(0,X.jsx)(m.default,{style:z.text,children:" \ubbf8\ub9ac\ubcf4\uae30:"}),(0,X.jsxs)(x.default,{style:[z.button,ve.moveButton,{flex:0,flexDirection:"row",alignItems:"center",paddingTop:24,paddingBottom:16}],onPress:function(){return I(!M)},children:[(0,X.jsx)(m.default,{style:z.title,children:ct({title:n,paragraph:null==et?void 0:et.title})}),(0,X.jsx)(m.default,{style:[z.text,{marginBottom:8,fontSize:14}],children:" \u279c "}),(0,X.jsx)(m.default,{style:z.title,children:ct({title:y,paragraph:null==nt?void 0:nt.title})})]}),void 0!==M&&(0,X.jsx)(g.default,{style:{display:M?"flex":"none"},children:(0,X.jsx)(kt.EditorViewer,{active:!0,value:_,theme:u,onLink:function(t){return at(t,a)},autoResize:!0})})]})]}),(0,X.jsxs)(g.default,{style:ve.buttonContainer,children:[(0,X.jsx)(x.default,{style:[z.button,ve.cancelButton],onPress:G,children:(0,X.jsx)(m.default,{style:z.buttonText,children:"\ucde8\uc18c"})}),(0,X.jsx)(x.default,{style:[z.button,rt?ve.cancelButton:ve.moveButton],onPress:function(){void 0===(null==k?void 0:k.id)?$.mutate({oldTitle:n,newTitle:y.trim(),description:""===S?void 0:_},{onSuccess:function(t){a.navigate({name:"NotePage",params:{title:t.newTitle}})},onError:function(t){ye.default.alert("\uc624\ub958",t.message||"\ub178\ud2b8 \uc774\ub3d9 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}}):((null==b?void 0:b.title)===k.title&&S===T&&G(),A.mutate({title:k.title,description:_},{onSuccess:function(t){(null==b?void 0:b.title)!==k.title&&A.mutate({title:n,description:Q}),a.navigate({name:"NotePage",params:{title:t.title}})},onError:function(t){ye.default.alert("\uc624\ub958",t.message||"\ub178\ud2b8 \uc774\ub3d9 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}}))},disabled:rt,children:(0,X.jsx)(m.default,{style:z.buttonText,children:"\uc774\ub3d9"})})]})]})})},path:"move"},RecentPages:{title:Be,component:function(){var t=(0,o.useResizeContext)();return(0,X.jsxs)(X.Fragment,{children:["portrait"===t&&(0,X.jsx)(ft,{}),(0,X.jsx)(pe,{})]})},path:"recent"},Problem:{title:Be,component:function(){var t=(0,o.useResizeContext)(),e=(0,h.useNavigation)(),n=_t(),r=n.data,i=n.isLoading;return(0,X.jsxs)(X.Fragment,{children:["portrait"===t&&(0,X.jsx)(ft,{}),(0,X.jsx)(jt,{contents:r,onPress:function(t){return e.push("EditPage",{title:t})},isLoading:i,emptyMessage:"\uc791\uc131\uc774 \ud544\uc694\ud55c \ub178\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."})]})},path:"problem"},Archive:{title:Be,component:function(){var t,e=(0,h.useNavigation)(),n=(0,h.useRoute)(),r=(0,o.useResizeContext)(),i=null==(t=n.params)?void 0:t.title,a=Q(),l=a.data,u=void 0===l?[]:l,s=a.isLoading;return(0,X.jsxs)(X.Fragment,{children:["portrait"===r&&(0,X.jsx)(ft,{}),(0,X.jsx)(jt,{contents:u.filter((function(t){return void 0===i||i===t.title})).sort((function(t,e){return new Date(e.updated).getTime()-new Date(t.updated).getTime()})).map((function(t,e){return ge(ge({},t),{},{subtitles:[`\ucd5c\uadfc \uc218\uc815: ${le(t.updated)}`],id:t.id||e})})),isLoading:s,onPress:function(t,n,r){return(void 0===t?e.push:e.navigate)("NotePage",{title:t,archiveId:r})},emptyMessage:"\ucd5c\uadfc \uc218\uc815\ud55c \ub178\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."})]})},path:"archive"},TimeLine:{title:Be,component:function(){var t=(0,h.useNavigation)(),e=(0,o.useColorScheme)(),n=J(e),r=(0,o.useResizeContext)(),i=(0,l.useState)(Ft()),a=(0,f.default)(i,2),u=a[0],s=a[1],c=Jt(u),d=c.data,p=c.preData,y=c.isLoading,x=p.flatMap((function(t){return t.dateMatches.flatMap((function(t){return t.matches}))}));return(0,X.jsxs)(X.Fragment,{children:["portrait"===r&&(0,X.jsx)(ft,{}),(0,X.jsx)(g.default,{style:[Ne(Ne({},n.container),{},{flex:void 0,paddingBottom:0})],children:(0,X.jsx)(Le,{date:u,setDate:s,markedDateRange:x})}),(0,X.jsx)(jt,{contents:d,onPress:function(e,n){return t.push("NotePage",{title:e,paragraph:n})},isLoading:y,emptyMessage:"\ub178\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."})]})},path:"timeline"}},Re=n(52990);function Ie(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ze(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ie(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}const Ae=function(){var t=(0,o.useLangContext)().lang;return(0,X.jsxs)(o.View,{style:{flex:1},children:[(0,X.jsx)(Pt.default,{left:function(t){return(0,X.jsx)(u.default,ze(ze({},t),{},{icon:"home"}))},title:t("Home"),onPress:function(){return(0,a.push)("Home")}}),(0,X.jsx)(te,{}),(0,X.jsx)(ee,{}),(0,X.jsxs)(bt.default,{style:"web"===Re.default.OS?{scrollbarWidth:"thin"}:{},children:[(0,X.jsx)(me.default,{style:{},selectable:!1,children:t("Open Pages")}),(0,X.jsx)(re,{type:"LAST"}),(0,X.jsx)(re,{type:"PAGE"}),(0,X.jsx)(me.default,{style:{flex:1},selectable:!1,children:t("Recent Changes")}),(0,X.jsx)(re,{type:"NOTE",noteCount:10})]})]})};function $e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function He(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$e(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var We=function(){return"landscape"===(0,o.useResizeContext)()?(0,X.jsx)(ft,{}):void 0},qe=function(){var t=(0,i.default)((function*(){var t=yield Promise.all([n.e(928),n.e(973)]).then(n.bind(n,49928));return{main:Me,login:a.login,prefixes:[t.makeUrl("/")],rootPath:"blacktokki-notebook",documentTitle:{formatter:function(){return"blacktokki-notebook"}},rootScreen:{main:"Home",login:"LoginScreen"},headerLeftIcon:(0,X.jsx)(u.default,{icon:"backburger",style:{left:-18,top:-14}}),headerRight:(0,X.jsx)(We,{}),modals:[mt],drawer:(0,X.jsx)(Ae,{})}}));return function(){return t.apply(this,arguments)}}();const Ye=function(){var t=(0,o.useColorScheme)(),e="dark"===t?s.MD2DarkTheme:c.MD2LightTheme,n=He(He({},e),{},{colors:He(He({},e.colors),{},{primary:o.Colors[t].text})}),r=l.lazy((function(){return qe().then((function(t){return{default:function(){return(0,X.jsx)(a.Navigation,{config:t})}}}))}));return(0,X.jsx)(d.default,{theme:n,children:(0,X.jsx)(l.Suspense,{fallback:(0,X.jsx)(X.Fragment,{}),children:(0,X.jsx)(r,{})})})}}}]);
//# sourceMappingURL=515.9f8f7e65.chunk.js.map