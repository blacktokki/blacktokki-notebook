"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[279],{41279:(e,t,n)=>{n.r(t),n.d(t,{default:()=>dt});var r=n(24586),i=n(86330),o=n(29399),a=n(12089),u=n(83705),l=n(90689),s=n(47904),c=n(95346),d=n(63717),f=n(95225),p=n(20863),h=n(54807),y=n(68111),g=n(5209),v=n(8594),x=(0,v.axiosCreate)("notebook"),m=(function(){var e=(0,i.default)((function*(e){return(yield x.get(`/api/v1/content/${e}`)).data}))}(),function(){var e=(0,i.default)((function*(e,t){var n=void 0!==e?`&parentId=${e}`:"",r=void 0!==t?`&types=${t.join(",")}`:"";return(yield x.get(`/api/v1/content?self=true&size=256${n}${r}`)).data.value}));return function(t,n){return e.apply(this,arguments)}}()),j=function(){var e=(0,i.default)((function*(e){return(yield x.post("/api/v1/content",e)).data.id}));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=(0,i.default)((function*(e){var t=e.id,n=e.updated;yield x.patch("/api/v1/content",{ids:[t],updated:n})}));return function(t){return e.apply(this,arguments)}}(),O=(function(){var e=(0,i.default)((function*(e){yield x.delete(`/api/v1/content/${e}`)}))}(),function(){var e=(0,i.default)((function*(e){return(yield x.get(`/api/v1/preview/autocomplete?query=${e.query}`)).data}));return function(t){return e.apply(this,arguments)}}());function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var w,k="@blacktokki:notebook:contents",S="@blacktokki:notebook:recent_pages",E=function(){var e=(0,i.default)((function*(e){return yield m(void 0,[e])}));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=(0,i.default)((function*(e,t){var n=e.find((function(e){return t===e.id}));if(n){var r=yield t?b({id:t,updated:n}).then((function(){return t})):j(n),i=C(C({},n),{},{type:"SNAPSHOT",id:void 0,parentId:r});yield j(i)}try{var o=JSON.stringify(e);yield g.default.setItem(k,o)}catch(a){console.error("Error saving page contents",a)}}));return function(t,n){return e.apply(this,arguments)}}(),T=function(){var e=(0,i.default)((function*(){try{var e=yield g.default.getItem(S);return e?JSON.parse(e):[]}catch(t){return console.error("Error loading recent pages",t),[]}}));return function(){return e.apply(this,arguments)}}(),N=function(){var e=(0,i.default)((function*(e){try{var t=JSON.stringify(e);yield g.default.setItem(S,t)}catch(n){console.error("Error saving recent pages",n)}}));return function(t){return e.apply(this,arguments)}}(),D=function(){return(0,y.useQuery)({queryKey:["pageContents"],queryFn:function(){var e=(0,i.default)((function*(){return yield E("NOTE")}));return function(){return e.apply(this,arguments)}}()})},L=function(){return(0,y.useQuery)({queryKey:["snapshotContents"],queryFn:function(){var e=(0,i.default)((function*(){return yield E("SNAPSHOT")}));return function(){return e.apply(this,arguments)}}()})},B=function(e){var t=(0,y.useQueryClient)(),n=D(),r=n.data,o=void 0===r?[]:r,a=n.isFetching;return(0,y.useQuery)({queryKey:["pageContent",e],queryFn:function(){var n=(0,i.default)((function*(){var n=o.find((function(t){return t.title===e}));n&&(void 0===(yield T()).find((function(t){return t===e}))&&(w=e,yield t.invalidateQueries({queryKey:["lastPage"]})));return n||{title:e,description:"",id:void 0}}));return function(){return n.apply(this,arguments)}}(),enabled:!a})},R=function(){var e=D(),t=e.data,n=void 0===t?[]:t,r=e.isFetching;return(0,y.useQuery)({queryKey:["lastPage"],queryFn:function(){var e=(0,i.default)((function*(){return n.find((function(e){return e.title===w}))}));return function(){return e.apply(this,arguments)}}(),enabled:!r})},I=function(){var e=(0,y.useQueryClient)(),t=(0,v.useAuthContext)().auth,n=D().data,r=void 0===n?[]:n;return(0,y.useMutation)({mutationFn:function(){var e=(0,i.default)((function*(e){var n,i=e.title,o=e.description,a=r.find((function(e){return e.title===i}));if(a)n=r.map((function(e,t){return e.id===a.id?C(C({},e),{},{description:o}):e}));else{var l,s={title:i,description:o,input:i,userId:(null==(l=t.user)?void 0:l.id)||0,parentId:0,type:"NOTE",order:0,option:{}};n=[].concat((0,u.default)(r),[s])}return yield F(n,null==a?void 0:a.id),{title:i,description:o}}));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(){var t=(0,i.default)((function*(t){yield e.invalidateQueries({queryKey:["pageContents"]}),yield e.invalidateQueries({queryKey:["snapshotContents"]}),yield e.invalidateQueries({queryKey:["pageContent",t.title]}),yield e.invalidateQueries({queryKey:["recentPages"]})}));return function(e){return t.apply(this,arguments)}}()})},z=function(){var e=(0,y.useQueryClient)();return(0,y.useMutation)({mutationFn:function(){var e=(0,i.default)((function*(e){var t=(yield T()).filter((function(t){return e!==t}));return w=void 0,yield N(t),{title:e}}));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(t){e.invalidateQueries({queryKey:["recentPages"]}),e.invalidateQueries({queryKey:["pageContent"]}),e.invalidateQueries({queryKey:["lastPage"]})}})},M=function(e){return p.default.create({container:{flex:1,backgroundColor:"dark"===e?"#121212":"#FFFFFF",paddingHorizontal:24,paddingVertical:16},card:{backgroundColor:"dark"===e?"#1E1E1E":"#FFFFFF",borderRadius:8,padding:16,marginBottom:16,borderWidth:1,borderColor:"dark"===e?"#333333":"#EEEEEE",shadowColor:"dark"===e?"#000000":"#888888",shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:4,elevation:2},title:{fontSize:18,fontWeight:"bold",marginBottom:8,color:"dark"===e?"#FFFFFF":"#000000"},text:{fontSize:16,color:"dark"===e?"#E4E4E4":"#333333",lineHeight:24},button:{backgroundColor:"dark"===e?"#2C73B5":"#3498DB",borderRadius:4,padding:12,alignItems:"center",marginVertical:8},buttonText:{color:"#FFFFFF",fontWeight:"500",fontSize:16},searchButton:{backgroundColor:"#3498DB",justifyContent:"center",alignItems:"center",width:36,height:36,borderRadius:4,marginHorizontal:4},resultSeparator:{height:1,backgroundColor:"dark"===e?"#333333":"#EEEEEE"},input:{backgroundColor:"dark"===e?"#222222":"#FFFFFF",borderWidth:1,borderColor:"dark"===e?"#444444":"#CCCCCC",borderRadius:4,padding:10,color:"dark"===e?"#E4E4E4":"#333333",marginBottom:16},separator:{height:1,backgroundColor:"dark"===e?"#333333":"#EEEEEE",marginVertical:12},smallText:{fontSize:14,color:"dark"===e?"#BBBBBB":"#777777"},header:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:16},flex:{flex:1},row:{flexDirection:"row",alignItems:"center"},centerContent:{justifyContent:"center",alignItems:"center"}})},q=n(32024),K=n(47884),Q=n(63390),H=n(56927),W=n(82103),A=n(41867),$=n(50575);function V(e){for(var t=(new DOMParser).parseFromString(e,"text/html"),n=[{path:"",title:"",header:"",level:0,description:""}],r=["H1","H2","H3","H4","H5","H6"],i=[],o=null,a=t.body.firstChild,u=function(){o&&(n.push(o),o=null)};a;){if(a.nodeType===Node.ELEMENT_NODE){var l=a;if(r.includes(l.tagName)){var s;u();for(var c=parseInt(l.tagName.substring(1)),d=(null==(s=l.textContent)?void 0:s.trim())||"";i.length>0&&i[i.length-1].level>=c;)i.pop();i.push({level:c,title:d});var f=i.map((function(e){return e.title})).join(" > ");o={path:f,title:d,level:c,header:l.outerHTML,description:""}}else o?o.description+=l.outerHTML:n[0].description+=l.outerHTML}else a.nodeType===Node.TEXT_NODE&&o&&(o.description+=a.textContent||"");a=a.nextSibling}return u(),n}function _(e){var t=(0,q.useColorScheme)(),n=M(t);return(0,$.jsx)(s.default,{style:[J.resultsContainer,"dark"===t?J.darkResults:J.lightResults],children:(0,$.jsx)(H.default,{data:e.data,keyExtractor:function(e){return e.path},renderItem:function(t){return function(t){return(0,$.jsxs)(d.default,{style:J.resultItem,onPress:function(){return e.onPress(t)},children:[0===t.level&&(0,$.jsx)(A.default,{name:"file-text-o",size:18,color:"#FFFFFF"}),(0,$.jsx)(q.Text,{style:[e.path===t.path?[n.title,{marginBottom:5,marginTop:3}]:n.text,J.resultText,{left:10*t.level+10}],children:0===t.level?e.root:t.title})]})}(t.item)},ItemSeparatorComponent:function(){return(0,$.jsx)(s.default,{style:n.resultSeparator})}})})}var J=p.default.create({backButton:{padding:8},resultItem:{padding:10,flexDirection:"row"},resultText:{fontSize:14},buttonContainer:{flexDirection:"row",justifyContent:"space-between"},resultsContainer:{borderWidth:1,borderRadius:4},lightResults:{backgroundColor:"#FFFFFF",borderColor:"#CCCCCC"},darkResults:{backgroundColor:"#222222",borderColor:"#444444"}}),U="@blacktokki:notebook:keywords",G=function(){var e=(0,i.default)((function*(){try{var e=yield g.default.getItem(U);return e?JSON.parse(e):[]}catch(t){return console.error("Error loading keywords",t),[]}}));return function(){return e.apply(this,arguments)}}(),Y=function(){var e=(0,i.default)((function*(e){try{var t=JSON.stringify(e);yield g.default.setItem(U,t)}catch(n){console.error("Error saving keywords",n)}}));return function(t){return e.apply(this,arguments)}}(),X=function(){return(0,y.useQuery)({queryKey:["keywords"],queryFn:function(){var e=(0,i.default)((function*(){return G()}));return function(){return e.apply(this,arguments)}}()})};function Z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var te="";function ne(e){var t=new URL(e);if(location.origin===t.origin){var n=new URLSearchParams(t.search),r=n.get("title"),i=n.get("section")||void 0;if(r)return{title:r,section:i}}}function re(e,t){var n=ne(e);n?t.push("NotePage",n):window.open(e,"_blank")}function ie(e){return e.flatMap((function(e){return function(e){var t=(new DOMParser).parseFromString(e,"text/html").querySelectorAll("a");return Array.from(t).map((function(e){var t;return{text:(null==(t=e.textContent)?void 0:t.trim())||e.href,url:e.href}}))}(e.description||"").map((function(t){var n=ne(t.url);if(n&&t.text!==n.title)return ee(ee({type:"_NOTELINK",name:t.text},n),{},{origin:e.title})})).filter((function(e){return void 0!==e}))}))}var oe=function(e,t){var n=t.toLowerCase(),r=ie(e);return[].concat((0,u.default)(e.filter((function(e){return e.title.toLowerCase().startsWith(n)}))),(0,u.default)(r.filter((function(e){return e.name.toLowerCase().startsWith(n)}))))},ae=function(){var e=(0,q.useColorScheme)(),t=M(e),n=(0,h.useNavigation)(),r=D().data,i=(void 0===r?[]:r).filter((function(e){return e.description}));return i&&(0,$.jsx)(d.default,{style:t.searchButton,onPress:function(){var e=i[Math.floor(Math.random()*i.length)],t=V(e.description||"");n.push("NotePage",{title:e.title,section:t[Math.floor(Math.random()*t.length)].title})},children:(0,$.jsx)(A.default,{name:"random",size:18,color:"#FFFFFF"})})},ue=function(e){return`${e.title}${e.section?" \u25b6 "+e.section:""}`},le=function(e){var t=e.filteredPages,n=e.handlePagePress,r=e.addKeyword,i=(0,q.useColorScheme)(),a=M(i),u=(0,o.useCallback)((function(e){return W.default.create({onPanResponderStart:function(){"_NOTELINK"===e.type&&e.section?(n(e.title,e.section),null==r||r(e)):(n(e.title),null==r||r({type:"_KEYWORD",title:e.title}))}}).panHandlers}),[]);return(0,$.jsx)(H.default,{data:t,keyExtractor:function(e){return JSON.stringify([e.title,e.name,e.section])},renderItem:function(e){var t=e.item;return(0,$.jsxs)(d.default,ee(ee({style:ce.resultItem},u(t)),{},{children:[(0,$.jsx)(c.default,{style:[a.text,ce.resultText],children:"_NOTELINK"===t.type?t.name:t.title}),"_NOTELINK"===t.type&&(0,$.jsx)(c.default,{style:[a.text,ce.resultText,{fontSize:12}],children:ue(t)})]}))},ItemSeparatorComponent:function(){return(0,$.jsx)(s.default,{style:[a.resultSeparator]})}})},se=function(e){var t=e.handlePress,n=e.useRandom,r=void 0===n||n,a=(0,o.useState)(te),f=(0,l.default)(a,2),p=f[0],g=f[1],v=(0,o.useState)(!1),x=(0,l.default)(v,2),m=x[0],j=x[1],b=(0,h.useNavigation)(),O=(0,q.useColorScheme)(),P=M(O),C=(0,o.useRef)(),w=X().data,k=void 0===w?[]:w,S=function(){var e=(0,y.useQueryClient)();return(0,y.useMutation)({mutationFn:function(){var e=(0,i.default)((function*(e){var t=yield G(),n=(0,u.default)(new Set([JSON.stringify(e)].concat((0,u.default)(t.map((function(e){return JSON.stringify(e)})))))).map((function(e){return JSON.parse(e)}));yield Y(n)}));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(){var t=(0,i.default)((function*(){yield e.invalidateQueries({queryKey:["keywords"]})}));return function(){return t.apply(this,arguments)}}()})}(),E=D().data,F=void 0===E?[]:E,T=p.length>0?oe(F,p).slice(0,10):k.slice(0,10),N=function(){p.trim()&&(L(p.trim()),S.mutate({type:"_KEYWORD",title:p.trim()}))},L=function(e,n){t?t(e):b.push("NotePage",{title:e,section:n}),g("")},B=(0,o.useMemo)((function(){return W.default.create({onPanResponderStart:N}).panHandlers}),[p]);return(0,o.useEffect)((function(){te=p}),[p]),(0,h.useFocusEffect)((function(){p!==te&&g(te)})),(0,$.jsxs)(s.default,{style:ce.container,children:[(0,$.jsxs)(s.default,{style:ce.searchContainer,children:[(0,$.jsx)(Q.default,{ref:function(e){C.current=e},style:[P.input,ce.searchInput],value:p,onChangeText:function(e){g(e)},placeholder:"\uac80\uc0c9",placeholderTextColor:"dark"===O?"#777777":"#999999",onSubmitEditing:N,onFocus:function(){return j(!0)},onBlur:function(){return j(!1)}}),(0,$.jsx)(d.default,{style:P.searchButton,onPress:N,disabled:!p.trim(),children:(0,$.jsx)(A.default,{name:"search",size:18,color:"#FFFFFF"})}),r&&(0,$.jsx)(ae,{})]}),m&&(0,$.jsx)(s.default,{style:[ce.resultsContainer,"dark"===O?ce.darkResults:ce.lightResults],children:T.length>0?(0,$.jsx)(le,{filteredPages:T,handlePagePress:L,addKeyword:S.mutate}):p.trim()?(0,$.jsx)(d.default,ee(ee({style:ce.resultItem},B),{},{children:(0,$.jsxs)(c.default,{style:[P.text,ce.resultText],children:['"',p,'" \uc0c8 \ub178\ud2b8 \ub9cc\ub4e4\uae30']})})):null})]})},ce=p.default.create({container:{position:"relative",width:"100%",maxWidth:960,zIndex:999},searchContainer:{flexDirection:"row"},searchInput:{flex:1,height:36,marginBottom:0,paddingVertical:4,fontSize:14},resultsContainer:{position:"absolute",top:40,left:0,right:0,maxHeight:500,borderWidth:1,borderRadius:4,zIndex:999,elevation:5},lightResults:{backgroundColor:"#FFFFFF",borderColor:"#CCCCCC"},darkResults:{backgroundColor:"#222222",borderColor:"#444444"},resultItem:{flexDirection:"row",justifyContent:"space-between",padding:10},resultText:{fontSize:14}}),de=p.default.create({buttonContainer:{flexDirection:"row",justifyContent:"space-between"},cancelButton:{flex:1,marginRight:8,backgroundColor:"#95A5A6"},saveButton:{flex:1,marginLeft:8}}),fe=n(9367),pe=n(76579),he=n(20048),ye=n(40205),ge=n(57687);function ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ve(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var me=function(){var e=(0,q.useLangContext)().lang;return(0,$.jsx)(pe.default,{left:function(e){return(0,$.jsx)(he.default,xe(xe({},e),{},{icon:"note-remove"}))},title:e("Empty Note"),onPress:function(){return(0,a.push)("EmptyPages")}})},je=function(){var e=(0,q.useLangContext)().lang;return(0,$.jsx)(pe.default,{left:function(e){return(0,$.jsx)(he.default,xe(xe({},e),{},{icon:"note-edit"}))},title:e("Empty Content"),onPress:function(){return(0,a.push)("EmptyContents")}})},be=function(e){return e.filter((function(e){return e.description})).sort((function(e,t){return new Date(t.updated).getTime()-new Date(e.updated).getTime()}))};const Oe=function(e){var t=(0,q.useLangContext)().lang,n=D(),r=function(){var e=D(),t=e.data,n=void 0===t?[]:t,r=e.isFetching;return(0,y.useQuery)({queryKey:["recentPages"],queryFn:function(){var e=(0,i.default)((function*(){return(yield T()).map((function(e){return n.find((function(t){return t.title===e}))})).filter((function(e){return void 0!==e}))}));return function(){return e.apply(this,arguments)}}(),enabled:!r})}(),l=R().data,s=o.useRef(),c=function(){var e=(0,y.useQueryClient)();return(0,y.useMutation)({mutationFn:function(){var e=(0,i.default)((function*(e){var t=e.title,n=e.direct,r=yield T();if(void 0===r.find((function(e){return e===t}))||n){var i=[t].concat((0,u.default)(r));yield N(i)}return{title:t}}));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(t){e.invalidateQueries({queryKey:["recentPages"]})}})}(),d=z(),f="NOTE"===e.type?n.data?be(n.data):[]:r.data,p=l&&void 0===(null==f?void 0:f.find((function(e){return e.id===l.id}))),h=(0,q.useResizeContext)(),g="landscape"===h?5:8,v=function(e){e===(null==l?void 0:l.title)&&(s.current?(clearTimeout(s.current),s.current=void 0,c.mutate({title:e})):s.current=setTimeout((function(){s.current=void 0}),500)),(0,a.navigate)("NotePage",{title:e})},x=function(e){var t;s.current&&(clearTimeout(s.current),s.current=void 0),void 0===(null==(t=r.data)?void 0:t.find((function(t){return t.title===e})))?c.mutate({title:e,direct:!0}):d.mutate(e)};return("LAST"!==e.type||p)&&(0,$.jsx)(ye.default,{children:f&&("LAST"===e.type?p&&(0,$.jsx)(pe.default,{left:function(e){return(0,$.jsx)(he.default,xe(xe({},e),{},{icon:"file-document"}))},title:l.title,onPress:function(){return v(l.title)},onLongPress:function(){return x(l.title)},style:{padding:g},titleStyle:{fontStyle:"italic"}}):"NOTE"===e.type?(0,$.jsxs)($.Fragment,{children:[f.slice(0,e.noteCount).map((function(e){return(0,$.jsx)(pe.default,{left:function(t){var n;return(0,$.jsx)(he.default,xe(xe({},t),{},{icon:void 0===(null==(n=r.data)?void 0:n.find((function(t){return t.title===e.title})))?"notebook":"notebook-edit"}))},title:e.title,onPress:function(){return v(e.title)},onLongPress:function(){return x(e.title)},style:{padding:g}},e.id)})),(0,$.jsx)(pe.default,{left:function(e){return(0,$.jsx)(he.default,xe(xe({},e),{},{icon:"notebook-multiple"}))},title:t("more..."),onPress:function(){return(0,a.push)("RecentPages")},style:{padding:g}})]}):f.map((function(e){return(0,$.jsx)(pe.default,{left:function(e){return(0,$.jsx)(he.default,xe(xe({},e),{},{icon:"file-document-edit"}))},right:function(t){return(0,$.jsx)(ge.default,{style:{justifyContent:"center",borderRadius:g,width:40+2*g,height:40+2*g,margin:-g},onPress:function(){return d.mutate(e.title)},children:(0,$.jsx)(he.default,{style:{left:g-7},icon:"close"})})},title:e.title,onPress:function(){return(0,a.navigate)("NotePage",{title:e.title})},style:{padding:g}},e.id)})))})};var Pe=n(55589),Ce=n(46072),we=n(39274),ke=n.n(we);function Se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Fe=(new Date).getTimezoneOffset(),Te=function(e){var t=new Date(e);t.setMinutes(t.getMinutes()-Fe);var n=t.toISOString().slice(0,16),r=n.slice(0,10);return r==(new Date).toISOString().slice(0,10)?n.slice(11):r};function Ne(e){var t=Array.from(e.attributes);for(var n of t)"href"===n.name?e.setAttribute("href",""):e.removeAttribute(n.name);for(var r of e.children)Ne(r)}function De(e){var t=(new DOMParser).parseFromString(e,"text/html").body;for(var n of t.children)Ne(n);return t.innerHTML}var Le=function(e){return e?20:4},Be=function(e){return e?250:190},Re=o.memo((function(e){var t=e.item,n=e.index,r=(0,q.useResizeContext)(),i=Be("landscape"===r),a=(0,q.useColorScheme)(),u=M(a),s="landscape"===r?2:0,c=(0,o.useState)(n<10),f=(0,l.default)(c,2),p=f[0],y=f[1];if((0,o.useEffect)((function(){if(!p){var e=setTimeout((function(){return y(!0)}),50*n-400);return function(){return clearTimeout(e)}}}),[t,n,p]),null===t)return(0,$.jsx)(q.View,{style:{flexBasis:"landscape"===r?"33%":"50%",maxWidth:i}});var g=(0,h.useNavigation)(),v=function(){return g.push("NotePage",{title:t.title})};return(0,$.jsxs)(d.default,{style:{flexBasis:"landscape"===r?"33%":"50%",padding:Le("landscape"===r),paddingRight:0,minWidth:i,maxWidth:i},onPress:v,children:[(0,$.jsx)(Ce.default,{onPress:v,style:[u.card,{paddingTop:8,aspectRatio:1/Math.sqrt(2),borderRadius:6,marginVertical:10,marginHorizontal:8,overflow:"hidden"}],children:(0,$.jsx)(Ce.default.Content,{style:{padding:0},children:p&&(0,$.jsx)(ke(),{source:{html:t.description||""},renderersProps:{a:{onPress:v}},tagsStyles:{body:{color:u.text.color}},contentWidth:i})})}),(0,$.jsxs)(q.View,{style:{flexDirection:"row",marginTop:10,padding:0,justifyContent:"space-between",alignItems:"center",width:"100%"},children:[(0,$.jsx)(q.Text,{style:{fontSize:14+s,overflow:"hidden"},children:t.title}),(0,$.jsx)(q.Text,{style:{fontSize:12+s,opacity:.4,textAlign:"right"},children:Te(t.updated)})]})]})})),Ie=o.memo((function(){var e=(0,q.useColorScheme)(),t=M(e),n=(0,q.useResizeContext)(),r=D(),i=r.data,a=void 0===i?[]:i,l=r.isLoading,s=(0,o.useMemo)((function(){return[].concat((0,u.default)(be(a).map((function(e){return Ee(Ee({},e),{},{description:De(e.description||"").slice(0,300)})}))),[null,null])}),[a]),c=(Be("landscape"===n)+5)*("landscape"===n?5:3);return l?(0,$.jsx)(q.View,{style:[t.card,t.centerContent],children:(0,$.jsx)(q.Text,{style:t.text,children:"\ub85c\ub529 \uc911..."})}):s.length>2?(0,$.jsx)(fe.default,{contentContainerStyle:{alignSelf:"center",backgroundColor:"transparent",flexBasis:"100%",maxWidth:c,flexWrap:"wrap",flexDirection:"row",paddingRight:Le("landscape"===n),justifyContent:"landscape"===n?void 0:"center"},children:s.map((function(e,t){return function(e){var t=e.item,n=e.index;return(0,$.jsx)(Re,{index:n,item:t},n)}({item:e,index:t})}))},n):(0,$.jsx)(q.View,{style:[t.card,t.centerContent],children:(0,$.jsx)(q.Text,{style:t.text,children:"\ucd5c\uadfc \uc218\uc815\ud55c \ub178\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."})})})),ze=n(31692),Me=function(){var e=(0,q.useColorScheme)(),t=(0,q.useLangContext)().lang;return(0,$.jsxs)(fe.default,{style:{flex:1,backgroundColor:q.Colors[e].background},children:[(0,$.jsx)(Pe.default,{style:{},selectable:!1,children:t("Open Pages")}),(0,$.jsx)(Oe,{type:"LAST"}),(0,$.jsx)(Oe,{type:"PAGE"}),(0,$.jsx)(Pe.default,{style:{},selectable:!1,children:t("Problems")}),(0,$.jsx)(me,{}),(0,$.jsx)(je,{})]})},qe=function(){return(0,$.jsx)(Ie,{})},Ke=function(e){var t=(0,q.useColorScheme)(),n=M(t),r=q.Colors[t].text;return(0,$.jsxs)(d.default,{style:[n.header,{marginBottom:0}],onPress:e.onPress,disabled:!e.onPress,children:[(0,$.jsx)(q.Text,{style:{fontSize:20,color:r,fontWeight:"600"},children:e.title}),e.onPress&&(0,$.jsx)(q.Text,{children:">"})]})},Qe=function(){var e=(0,q.useLangContext)().lang,t=(0,v.useAuthContext)().dispatch,n=(0,q.useColorScheme)(),r=(0,h.useNavigation)(),u=M(n),c=q.Colors[n].text,d=(0,o.useState)(!1),f=(0,l.default)(d,2),p=f[0],g=f[1],x=X().data,m=void 0===x?[]:x,j=function(){var e=(0,y.useQueryClient)();return(0,y.useMutation)({mutationFn:function(){var e=(0,i.default)((function*(){yield Y([])}));return function(){return e.apply(this,arguments)}}(),onSuccess:function(){var t=(0,i.default)((function*(){yield e.invalidateQueries({queryKey:["keywords"]})}));return function(){return t.apply(this,arguments)}}()})}();return(0,$.jsxs)(s.default,{children:[(0,$.jsx)(s.default,{style:u.card,children:(0,$.jsx)(a.ConfigSections,{})}),(0,$.jsxs)(s.default,{style:u.card,children:[(0,$.jsx)(Ke,{title:e("* Search Settings")}),(0,$.jsxs)(s.default,{style:{flexDirection:"row"},children:[(0,$.jsx)(q.TextButton,{title:"Search History",textStyle:{fontSize:16,color:c,textDecorationLine:p?"underline":"none"},style:{borderRadius:20},onPress:function(){return g(!p)}}),p&&m.length&&(0,$.jsx)(q.TextButton,{title:"Clear",textStyle:{fontSize:16,color:c},style:{borderRadius:20},onPress:function(){return j.mutate()}})]}),p&&(0,$.jsx)(s.default,{style:[u.card,{padding:0}],children:(0,$.jsx)(le,{filteredPages:m,handlePagePress:function(e,t){return r.push("NotePage",{title:e,section:t})}})})]}),(0,$.jsx)(s.default,{style:u.card,children:(0,$.jsx)(Ke,{title:e("* Archive"),onPress:function(){return r.push("Archive",{})}})}),(0,$.jsx)(s.default,{style:u.card,children:(0,$.jsx)(Ke,{title:e("* Logout"),onPress:function(){return t({type:"LOGOUT_REQUEST"})}})})]})},He=function(){var e=(0,q.useColorScheme)(),t=M(e);return(0,$.jsx)(fe.default,{style:{flex:1},contentContainerStyle:[t.container,{backgroundColor:q.Colors[e].background}],children:(0,$.jsx)(Qe,{})})};var We=p.default.create({columns:{marginTop:8,marginBottom:16},backButton:{padding:8},buttonContainer:{flexDirection:"row",justifyContent:"space-between"},cancelButton:{flex:1,marginRight:8,backgroundColor:"#95A5A6"},moveButton:{flex:1,marginLeft:8}}),Ae=n(57917),$e=function(e,t,n){var r,i=null==(r=e.find((function(e){return e.title===t})))?void 0:r.path;return i?e.filter((function(e){return e.path.startsWith(i)})).map((function(e){return(n||e.path!==i?e.header:"")+e.description})).join(""):""},Ve=function(e){var t=e.split("/");return t.length<2?[e]:[t.slice(0,t.length-1).join("/"),t[t.length-1]]},_e=p.default.create({backButton:{padding:8},pageTitle:{flex:1,fontSize:20},actionButtons:{flexDirection:"row"},actionButton:{padding:8,marginLeft:8}}),Je=function(e){var t=e.contents,n=e.isLoading,r=e.onPress,i=e.emptyMessage,o=(0,q.useColorScheme)(),a=M(o),u=(0,q.useResizeContext)();return(0,$.jsxs)($.Fragment,{children:["portrait"===u&&(0,$.jsx)(se,{}),(0,$.jsx)(s.default,{style:a.container,children:n?(0,$.jsx)(s.default,{style:[a.card,a.centerContent],children:(0,$.jsx)(c.default,{style:a.text,children:"\ub85c\ub529 \uc911..."})}):t.length>0?(0,$.jsx)(H.default,{data:t,keyExtractor:function(e){return JSON.stringify([e.title,e.section,e.id])},renderItem:function(e){var t=e.item;return(0,$.jsxs)(d.default,{style:a.card,onPress:function(){return r(t.title,t.section,t.id)},children:[(0,$.jsx)(c.default,{style:a.title,children:ue(t)}),void 0!==t.subtitle&&(0,$.jsx)(c.default,{style:a.smallText,children:t.subtitle})]})},ItemSeparatorComponent:function(){return(0,$.jsx)(s.default,{style:{height:8}})}}):(0,$.jsx)(s.default,{style:[a.card,a.centerContent],children:(0,$.jsx)(c.default,{style:a.text,children:i})})})]})};function Ue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ye(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ze={Home:{title:"Blacktokki Notebook",component:function(e){e.navigation,e.route;var t=(0,q.useLangContext)().lang,n=(0,q.useColorScheme)(),r=M(n),i=t("Blacktokki Notebook"),o=[{title:t("Discovery"),component:Me,icon:(0,$.jsx)(he.default,{icon:"compass"}),headerRight:function(){return(0,$.jsx)($.Fragment,{})}},{title:t("All Notes"),component:qe,icon:(0,$.jsx)(he.default,{icon:"notebook"}),headerRight:function(){return(0,$.jsx)($.Fragment,{})}},{title:t("Config"),component:He,icon:(0,$.jsx)(he.default,{icon:"dots-horizontal"}),headerRight:function(){return(0,$.jsx)($.Fragment,{})}}];return(0,$.jsx)(a.HomeSection,{tabViews:o,homeView:{title:i,headerRight:function(){return(0,$.jsx)(se,{})}},headerTitle:i,children:(0,$.jsxs)(s.default,{style:[r.container,{width:"100%",justifyContent:"space-between"}],children:[(0,$.jsx)(Qe,{}),(0,$.jsx)(q.ContractFooter,{buttons:[{icon:(0,$.jsx)(ze.default,{name:"github",size:24,color:q.Colors[n].iconColor}),url:"https://github.com/blacktokki/blacktokki-notebook",isWeb:!0},{icon:(0,$.jsx)(ze.default,{name:"mail",size:24,color:q.Colors[n].iconColor}),url:"mailto:ydh051541@naver.com",isWeb:!1}]})]})})},path:"home"},NotePage:{title:"Blacktokki Notebook",component:function(){var e=(0,h.useIsFocused)(),t=(0,h.useRoute)(),n=t.params,r=n.title,i=n.section,a=n.archiveId,u=(0,h.useNavigation)(),f=(0,q.useColorScheme)(),p=(0,q.useResizeContext)(),y=M(f),g=(0,o.useState)(!1),v=(0,l.default)(g,2),x=v[0],m=v[1],j=(0,o.useState)(!1),b=(0,l.default)(j,2),O=b[0],P=b[1],C=B(r),w=C.data,k=C.isFetching,S=L().data,E=a?null==S?void 0:S.find((function(e){return e.id===a&&e.description!==(null==w?void 0:w.description)})):void 0,F=function(){u.navigate("EditPage",{title:r})},T=V((null==w?void 0:w.description)||""),N=T.findIndex((function(e){return e.title===i})),D=[{icon:"arrow-left",moveSection:T.findLast((function(e,t){var n;return t<N&&(!O||(null==(n=T[N])?void 0:n.level)>=e.level)})),reverse:!1},{icon:"arrow-right",moveSection:T.find((function(e,t){var n;return t>N&&(!O||(null==(n=T[N])?void 0:n.level)>=e.level)})),reverse:!0}],R=(0,o.useState)(),I=(0,l.default)(R,2),z=I[0],Q=I[1];(0,o.useEffect)((function(){var e,t;Q(E?E.description:null==(e=i?O?$e(T,i,!0):null==(t=T.find((function(e){return e.title===i})))?void 0:t.description:null==w?void 0:w.description)?void 0:e.trim())}),[w,E,i,O]),(0,o.useEffect)((function(){m(!1)}),[t]);var H=Ve(r),W="dark"===f?"#E4E4E4":"#333333",J="dark"===f?"#FFFFFF88":"#00000088";return e&&(0,$.jsxs)($.Fragment,{children:["portrait"===p&&(0,$.jsx)(se,{}),(0,$.jsxs)(fe.default,{style:[y.container,{paddingRight:12,scrollbarGutter:"stable"}],contentContainerStyle:{flexGrow:1},children:[(0,$.jsxs)(s.default,{style:y.header,children:[(0,$.jsxs)(s.default,{style:{flexDirection:"row"},children:[(0,$.jsx)(d.default,{onPress:function(){return(2===H.length?u.push:u.navigate)("NotePage",{title:H[0]})},children:(0,$.jsx)(c.default,{style:[y.title,_e.pageTitle,i||2===H.length?{color:J}:{}],numberOfLines:1,children:H[0]})}),2===H.length&&(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(c.default,{style:[y.title,_e.pageTitle,{flex:0}],children:"/"}),(0,$.jsx)(d.default,{onPress:function(){return u.navigate("NotePage",{title:r})},children:(0,$.jsx)(c.default,{style:[y.title,_e.pageTitle,i?{color:J}:{}],numberOfLines:1,children:H[1]})})]}),!!i&&(0,$.jsx)(c.default,{style:[y.title,_e.pageTitle,{marginLeft:5}],numberOfLines:1,children:ue({title:"",section:i})}),E&&(0,$.jsx)(c.default,{style:[y.text,{marginLeft:5,fontStyle:"italic"}],children:"("+E.updated+")"})]}),(0,$.jsxs)(s.default,{style:_e.actionButtons,children:[!i&&(0,$.jsx)($.Fragment,{children:(0,$.jsx)(d.default,{onPress:function(){return u.navigate("Archive",{title:r})},style:_e.actionButton,children:(0,$.jsx)(A.default,{name:"history",size:16,color:W})})}),!!i&&(0,$.jsx)($.Fragment,{children:(0,$.jsx)(d.default,{onPress:function(){return P(!O)},style:_e.actionButton,children:(0,$.jsx)(A.default,{name:O?"compress":"expand",size:16,color:W})})}),!(!i&&!z)&&!E&&(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(d.default,{onPress:function(){return m(!x)},style:_e.actionButton,children:(0,$.jsx)(A.default,{name:"list",size:16,color:W})}),(0,$.jsx)(d.default,{onPress:function(){u.navigate("MovePage",{title:r,section:i})},style:_e.actionButton,children:(0,$.jsx)(A.default,{name:"exchange",size:16,color:W})})]}),!(!i&&!z)&&!E&&!i&&(0,$.jsx)($.Fragment,{children:(0,$.jsx)(d.default,{onPress:F,style:_e.actionButton,children:(0,$.jsx)(A.default,{name:"pencil",size:16,color:W})})})]})]}),(0,$.jsxs)(s.default,{style:y.flex,children:[(0,$.jsx)(s.default,{style:!x&&z?[y.card,{padding:0,marginBottom:0}]:{flex:1,position:"absolute"},children:(0,$.jsx)(K.EditorViewer,{active:!0,value:z||"",theme:f,onLink:function(e){return re(e,u)},autoResize:!0})}),k||void 0===z?(0,$.jsx)(s.default,{style:[y.card,y.centerContent],children:(0,$.jsx)(Ae.default,{size:"large",color:"#3498DB"})}):x?(0,$.jsx)(_,{data:T,path:i||"",root:r,onPress:function(e){return u.navigate("NotePage",{title:r,section:e.title})}}):null!=w&&w.description?!!i&&(0,$.jsx)(s.default,{style:{flex:1,flexDirection:"row",justifyContent:"space-between",alignItems:"flex-end"},children:D.map((function(e){var t=e.moveSection,n=e.icon,i=e.reverse;return void 0!==t&&(0,$.jsxs)(d.default,{onPress:function(){return u.navigate("NotePage",0===t.level?{title:r}:{title:r,section:t.title})},style:[{flexDirection:i?"row-reverse":"row",paddingVertical:16}],children:[(0,$.jsx)(A.default,{name:n,size:16,color:W,style:{alignSelf:"center"}}),(0,$.jsx)(c.default,{style:[y.text,{fontWeight:"bold",marginHorizontal:16}],children:0===t.level?r:t.title})]},n)}))}):(0,$.jsxs)(s.default,{style:[y.card,y.centerContent],children:[(0,$.jsx)(c.default,{style:y.text,children:"\uc544\uc9c1 \ub0b4\uc6a9\uc774 \uc5c6\ub294 \ubb38\uc11c\uc785\ub2c8\ub2e4. '\ud3b8\uc9d1' \ubc84\ud2bc\uc744 \ub20c\ub7ec \ub0b4\uc6a9\uc744 \ucd94\uac00\ud574\ubcf4\uc138\uc694."}),(0,$.jsx)(d.default,{onPress:F,style:y.button,children:(0,$.jsx)(c.default,{style:y.buttonText,children:"\ud3b8\uc9d1\ud558\uae30"})})]})]})]})]})},path:"page"},EditPage:{title:"Blacktokki Notebook",component:function(){var e=(0,h.useRoute)(),t=(0,h.useIsFocused)(),n=e.params.title,r=(0,h.useNavigation)(),a=(0,q.useColorScheme)(),p=M(a),y=B(n),g=y.data,v=y.isLoading,x=D().data,m=void 0===x?[]:x,j=(0,o.useState)(""),b=(0,l.default)(j,2),P=b[0],C=b[1],w=I();return(0,o.useEffect)((function(){!v&&null!=g&&g.description&&C(null==g?void 0:g.description)}),[v,g]),(0,h.useFocusEffect)((function(){var e=function(e){e.preventDefault(),e.returnValue=""};return window.addEventListener("beforeunload",e),function(){return window.removeEventListener("beforeunload",e)}})),t&&(0,$.jsxs)(s.default,{style:p.container,children:[(0,$.jsx)(s.default,{style:p.header,children:(0,$.jsxs)(c.default,{style:[p.title,{flex:1}],children:[n," - \ud3b8\uc9d1"]})}),(0,$.jsx)(K.Editor,{active:!0,value:P,setValue:C,theme:a,autoComplete:[{trigger:"[",getMatchedChars:function(){var e=(0,i.default)((function*(e){var t,r=(t=e,m.filter((function(e){return e.title.startsWith(n+"/")})).map((function(e){return{type:"_CHILDNOTE",name:e.title.split(n+"/")[1],title:e.title}})).filter((function(e){return e.name.toLowerCase().startsWith(t.toLowerCase())})));return[{type:"_NOTELINK",name:e,title:n,section:e}].concat((0,u.default)(r.length?r:[{type:"_CHILDNOTE",name:e,title:n+"/"+e}]),(0,u.default)(oe(m,e))).map((function(e){var t="_NOTELINK"===e.type?e.name+`(${ue(e)})`:"_CHILDNOTE"===e.type?e.name:e.title;return{text:t,value:`<a href=${encodeURI("_NOTELINK"===e.type&&e.section?`?title=${e.title}&section=${e.section}`:`?title=${e.title}`)}>${t}</a>`}}))}));return function(t){return e.apply(this,arguments)}}()},{trigger:"http",getMatchedChars:function(){var e=(0,i.default)((function*(e){var t="http"+e,n=new URL(t);if("http:"!==n.protocol&&"https:"!==n.protocol)return[];var r=yield O({query:t});return r.title?[{text:r.title,value:`<a href=${r.url}>${r.title}</a>`}]:[]}));return function(t){return e.apply(this,arguments)}}()}]}),(0,$.jsxs)(s.default,{style:de.buttonContainer,children:[(0,$.jsx)(d.default,{style:[p.button,de.cancelButton],onPress:function(){r.canGoBack()?r.goBack():r.navigate("NotePage",{title:n})},children:(0,$.jsx)(c.default,{style:p.buttonText,children:"\ucde8\uc18c"})}),(0,$.jsx)(d.default,{style:[p.button,de.saveButton],onPress:function(){(null==g?void 0:g.description)!==P?w.mutate({title:n,description:P},{onSuccess:function(){r.navigate("NotePage",{title:n})},onError:function(e){f.default.alert("\uc624\ub958",e.message||"\ubb38\uc11c\ub97c \uc800\uc7a5\ud558\ub294 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}}):r.navigate("NotePage",{title:n})},children:(0,$.jsx)(c.default,{style:p.buttonText,children:"\uc800\uc7a5"})})]})]})},path:"edit"},MovePage:{title:"Blacktokki Notebook",component:function(){var e,t=(0,h.useRoute)().params,n=t.title,r=t.section,a=(0,h.useNavigation)(),p=(0,q.useColorScheme)(),g=(0,q.useResizeContext)(),v=(0,o.useState)(n),x=(0,l.default)(v,2),m=x[0],j=x[1],b=B(n),O=b.data,P=b.isLoading,w=V((null==O?void 0:O.description)||""),k=(null==(e=w.find((function(e){return e.title===r})))?void 0:e.path)||"",S=B(m).data,E=V((null==S?void 0:S.description)||"").filter((function(e){return n!==m||k===e.path||!e.path.startsWith(k)})),L=(0,o.useState)(""),R=(0,l.default)(L,2),z=R[0],Q=R[1],H=(0,o.useState)(),W=(0,l.default)(H,2),A=W[0],J=W[1],U=M(p),G=I(),Y=function(){var e=(0,y.useQueryClient)(),t=D().data,n=void 0===t?[]:t;return(0,y.useMutation)({mutationFn:function(){var e=(0,i.default)((function*(e){var t=e.oldTitle,r=e.newTitle,i=e.description,o=n.find((function(e){return e.title===t}));if(!o)throw new Error("Page not found");if(n.some((function(e){return e.title===r})))throw new Error("Page with new title already exists");var a=n.map((function(e){return e.title===t?C(C({},e),{},{title:r,description:i||o.description}):e}));yield F(a,o.id);var u=(yield T()).map((function(e){return e===t?r:e}));return yield N(u),{oldTitle:t,newTitle:r}}));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(t){e.invalidateQueries({queryKey:["pageContents"]}),e.invalidateQueries({queryKey:["snapshotContents"]}),e.invalidateQueries({queryKey:["pageContent",t.oldTitle]}),e.invalidateQueries({queryKey:["pageContent",t.newTitle]}),e.invalidateQueries({queryKey:["recentPages"]})}})}(),X=(0,o.useMemo)((function(){var e,t=w.filter((function(e){return e.path.startsWith(k)})),n=(null==S?void 0:S.title)===(null==O?void 0:O.title)+"/"+(null==(e=t[0])?void 0:e.title),r=t.map((function(e,t){return(n&&0===t?"":e.header)+e.description})).join(""),i=w.filter((function(e){return!e.path.startsWith(k)})),o=i.map((function(e){return e.header+e.description})).join(""),a=(null==O?void 0:O.title)===(null==S?void 0:S.title)?i:E,l=a.findLastIndex((function(e){return e.path.startsWith(z)}));return{sourceDescription:o,targetDescription:void 0===(null==S?void 0:S.id)?r:[].concat((0,u.default)(a.slice(0,l+1).map((function(e){return e.header+e.description}))),(0,u.default)(t.map((function(e,t){return(e.path===k&&""===e.description||n&&0===t?"":e.header)+e.description}))),(0,u.default)(a.slice(l+1).map((function(e){return e.header+e.description})))).join("")}}),[w,E,k,z]),Z=X.sourceDescription,ee=X.targetDescription,te=function(){a.canGoBack()?a.goBack():a.navigate("NotePage",{title:n})};(0,o.useEffect)((function(){P||O||te(),O&&j(O.title+(r?`/${r}`:""))}),[O,P]),(0,o.useEffect)((function(){P||Q(r?"":k)}),[r,P]);var ne=w.find((function(e){return e.path===k})),ie=E.find((function(e){return e.path===z})),oe=!m.trim()||void 0===ie;return(0,$.jsx)(fe.default,{style:U.container,children:(0,$.jsxs)(s.default,{style:U.card,children:[(0,$.jsxs)(s.default,{style:{flexDirection:"landscape"===g?"row":"column",zIndex:1},children:[(0,$.jsxs)(s.default,{style:{zIndex:1},children:[(0,$.jsx)(c.default,{style:U.text,children:r?"\ud604\uc7ac \ub178\ud2b8 \uc81c\ubaa9 \ubc0f \ubb38\ub2e8:":"\ud604\uc7ac \ub178\ud2b8 \uc81c\ubaa9:"}),(0,$.jsx)(c.default,{style:[U.title,We.columns],children:ue({title:n,section:r})}),(0,$.jsx)(c.default,{style:U.text,children:"\uc0c8 \ub178\ud2b8 \uc81c\ubaa9 \ubc0f \ubb38\ub2e8:"}),(0,$.jsx)(se,{handlePress:j,useRandom:!1}),(0,$.jsx)(s.default,{style:We.columns,children:(0,$.jsx)(_,{path:z,onPress:function(e){return Q(e.path)},root:(null==S?void 0:S.title)||"",data:E})})]}),(0,$.jsxs)(s.default,{style:{flex:1},children:[(0,$.jsx)(c.default,{style:U.text,children:" \ubbf8\ub9ac\ubcf4\uae30:"}),(0,$.jsxs)(d.default,{style:[U.button,We.moveButton,{flex:0,flexDirection:"row",alignItems:"center",paddingTop:24,paddingBottom:16}],onPress:function(){return J(!A)},children:[(0,$.jsx)(c.default,{style:U.title,children:ue({title:n,section:null==ne?void 0:ne.title})}),(0,$.jsx)(c.default,{style:[U.text,{marginBottom:8,fontSize:14}],children:"  \u279c  "}),(0,$.jsx)(c.default,{style:U.title,children:ue({title:m,section:null==ie?void 0:ie.title})})]}),void 0!==A&&(0,$.jsx)(s.default,{style:{display:A?"flex":"none"},children:(0,$.jsx)(K.EditorViewer,{active:!0,value:ee,theme:p,onLink:function(e){return re(e,a)},autoResize:!0})})]})]}),(0,$.jsxs)(s.default,{style:We.buttonContainer,children:[(0,$.jsx)(d.default,{style:[U.button,We.cancelButton],onPress:te,children:(0,$.jsx)(c.default,{style:U.buttonText,children:"\ucde8\uc18c"})}),(0,$.jsx)(d.default,{style:[U.button,oe?We.cancelButton:We.moveButton],onPress:function(){void 0===(null==S?void 0:S.id)?Y.mutate({oldTitle:n,newTitle:m.trim(),description:""===k?void 0:ee},{onSuccess:function(e){a.navigate({name:"NotePage",params:{title:e.newTitle}})},onError:function(e){f.default.alert("\uc624\ub958",e.message||"\ub178\ud2b8 \uc774\ub3d9 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}}):((null==O?void 0:O.title)===S.title&&k===z&&te(),G.mutate({title:S.title,description:ee},{onSuccess:function(e){(null==O?void 0:O.title)!==S.title&&G.mutate({title:n,description:Z}),a.navigate({name:"NotePage",params:{title:e.title}})},onError:function(e){f.default.alert("\uc624\ub958",e.message||"\ub178\ud2b8 \uc774\ub3d9 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}}))},disabled:oe,children:(0,$.jsx)(c.default,{style:U.buttonText,children:"\uc774\ub3d9"})})]})]})})},path:"move"},RecentPages:{title:"Blacktokki Notebook",component:function(){var e=(0,q.useResizeContext)();return(0,$.jsxs)($.Fragment,{children:["portrait"===e&&(0,$.jsx)(se,{}),(0,$.jsx)(Ie,{})]})},path:"recent"},EmptyPages:{title:"Blacktokki Notebook",component:function(){var e=(0,h.useNavigation)(),t=D(),n=t.data,r=void 0===n?[]:n,i=t.isLoading,o=ie(r).filter((function(e){var t=r.find((function(t){return t.title===e.title}));return null==t||!t.description||void 0!==e.section&&!V(t.description).find((function(t){return t.title===e.section}))})).map((function(e){return Ge(Ge({},e),{},{subtitle:(void 0===e.section?"Unknown note link":"Unknown section link")+`(${e.origin})`})})),a=r.map((function(e){var t=Ve(e.title);if(e.description&&2===t.length&&void 0===r.find((function(e){return e.title===t[0]})))return{title:t[0],subtitle:`Empty parent note(${e.title})`}})).filter((function(e){return void 0!==e}));return(0,$.jsx)(Je,{contents:[].concat((0,u.default)(o),(0,u.default)(a)),onPress:function(t){return e.push("EditPage",{title:t})},isLoading:i,emptyMessage:"\uc791\uc131\uc774 \ud544\uc694\ud55c \ub178\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."})},path:"need"},EmptyContents:{title:"Blacktokki Notebook",component:function(){var e=(0,h.useNavigation)(),t=D(),n=t.data,r=void 0===n?[]:n,i=t.isLoading,o=r.flatMap((function(e){var t=V(e.description||""),n=t.filter((function(e){return 0!==e.level&&""===$e(t,e.title,!1).trim()})),r=t.filter((function(e){return function(e){for(var t,n=/<(ol|ul)\b[^>]*>([\s\n\r]*)<\/\1>/gi,r=[];null!==(t=n.exec(e));)r.push(t[0]);return r}(e.description).length>0}));return[].concat((0,u.default)(n.map((function(t){return{title:e.title,section:0===t.level?void 0:t.title,subtitle:"Empty section"}}))),(0,u.default)(r.map((function(t){return{title:e.title,section:0===t.level?void 0:t.title,subtitle:"Empty list"}}))))}));return(0,$.jsx)(Je,{contents:o,onPress:function(t){return e.push("EditPage",{title:t})},isLoading:i,emptyMessage:"\uc791\uc131\uc774 \ud544\uc694\ud55c \ub0b4\uc6a9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."})},path:"empty"},Archive:{title:"Blacktokki Notebook",component:function(){var e=(0,h.useNavigation)(),t=(0,h.useRoute)().params.title,n=L(),r=n.data,i=void 0===r?[]:r,o=n.isLoading;return(0,$.jsx)(Je,{contents:i.filter((function(e){return void 0===t||t===e.title})).sort((function(e,t){return new Date(t.updated).getTime()-new Date(e.updated).getTime()})).map((function(e){return Xe(Xe({},e),{},{subtitle:`\ucd5c\uadfc \uc218\uc815: ${Te(e.updated)}`})})),isLoading:o,onPress:function(t,n,r){return(void 0===t?e.push:e.navigate)("NotePage",{title:t,archiveId:r})},emptyMessage:"\ucd5c\uadfc \uc218\uc815\ud55c \ub178\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."})},path:"archive"}},et=n(52990);function tt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tt(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const rt=function(){var e=(0,q.useLangContext)().lang;return(0,$.jsxs)(q.View,{style:{flex:1},children:[(0,$.jsx)(pe.default,{left:function(e){return(0,$.jsx)(he.default,nt(nt({},e),{},{icon:"home"}))},title:e("Home"),onPress:function(){return(0,a.push)("Home")}}),(0,$.jsx)(me,{}),(0,$.jsx)(je,{}),(0,$.jsxs)(fe.default,{style:"web"===et.default.OS?{scrollbarWidth:"thin"}:{},children:[(0,$.jsx)(Pe.default,{style:{},selectable:!1,children:e("Open Pages")}),(0,$.jsx)(Oe,{type:"LAST"}),(0,$.jsx)(Oe,{type:"PAGE"}),(0,$.jsx)(Pe.default,{style:{flex:1},selectable:!1,children:e("Recent Changes")}),(0,$.jsx)(Oe,{type:"NOTE",noteCount:10})]})]})};var it=n(88610),ot=n(77650),at=n(50910);function ut(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function lt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ut(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ut(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var st=function(){return"landscape"===(0,q.useResizeContext)()?(0,$.jsx)(se,{}):void 0},ct=function(){var e=(0,i.default)((function*(e){var t=yield Promise.all([n.e(928),n.e(973)]).then(n.bind(n,49928));return{main:Ze,login:a.login,prefixes:[t.makeUrl("/")],rootPath:"blacktokki-notebook",documentTitle:{formatter:function(){return"blacktokki-notebook"}},rootScreen:{main:"Home",login:"LoginScreen"},headerLeftIcon:(0,$.jsx)(he.default,{icon:"backburger",style:{left:-18,top:-14}}),headerRight:(0,$.jsx)(st,{}),modals:[],drawer:(0,$.jsx)(rt,{})}}));return function(t){return e.apply(this,arguments)}}();const dt=function(){var e=(0,q.useColorScheme)(),t="dark"==e?it.MD2DarkTheme:ot.MD2LightTheme,n=lt(lt({},t),{},{colors:lt(lt({},t.colors),{},{primary:q.Colors[e].text})}),r=o.lazy((function(){return ct(e).then((function(e){return{default:function(){return(0,$.jsx)(a.Navigation,{config:e})}}}))}));return(0,$.jsx)(at.default,{theme:n,children:(0,$.jsx)(o.Suspense,{fallback:(0,$.jsx)($.Fragment,{}),children:(0,$.jsx)(r,{})})})}}}]);
//# sourceMappingURL=279.57dc9acb.chunk.js.map