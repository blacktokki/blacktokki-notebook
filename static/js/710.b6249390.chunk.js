"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[710],{5710:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ie});var r=n(4586),i=n(6330),o=n(9399),u=n(919),a=n(689),l=n(7904),s=n(5346),c=n(3717),d=n(5225),f=n(863),p=n(4807),h=n(3705),y=n(8111),g=n(5209),v=n(8594),x=(0,v.axiosCreate)("notebook"),m=(function(){var e=(0,i.default)((function*(e){return(yield x.get(`/api/v1/content/${e}`)).data}))}(),function(){var e=(0,i.default)((function*(e,t){var n=void 0!==e?`&parentId=${e}`:"",r=void 0!==t?`&type=${t}`:"";return(yield x.get(`/api/v1/content?self=true&size=256${n}${r}`)).data.value}));return function(t,n){return e.apply(this,arguments)}}()),j=function(){var e=(0,i.default)((function*(e){return(yield x.post("/api/v1/content",e)).data.id}));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=(0,i.default)((function*(e){var t=e.id,n=e.updated;yield x.patch("/api/v1/content",{ids:[t],updated:n})}));return function(t){return e.apply(this,arguments)}}(),C=(function(){var e=(0,i.default)((function*(e){yield x.delete(`/api/v1/content/${e}`)}))}(),/https?:\/\/(?:www\\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:[-a-zA-Z0-9()@:%_\+.~#?&\/=]*)/gi),k=function(e){return function(e,t){for(var n,r=t,i=0,o=[];null!=(n=new RegExp(e).exec(r));){o.push({index:i,str:r.substring(0,n.index)});var u=n.index+n[0].length;o.push({index:i+n.index,str:r.substring(n.index,u)}),i+=u,r=r.substring(u)}return o.push({index:i,str:r}),o}(C,e).filter((function(e,t){return t%2==1})).map((function(e){return e.str}))};!function(){var e=(0,i.default)((function*(e){var t=[];for(var n of k(e.query))t.push((yield x.get(`/api/v1/preview/autocomplete?query=${n}`)).data);return t}))}();function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P,E="@blacktokki:notebook:contents",F="@blacktokki:notebook:recent_pages",S=function(){var e=(0,i.default)((function*(){return(yield m()).filter((function(e){return"NOTE"===e.type||"BOOKMARK"===e.type}))}));return function(){return e.apply(this,arguments)}}(),T=function(){var e=(0,i.default)((function*(e,t){var n=e.find((function(e){return t===e.id}));n&&(yield t?b({id:t,updated:n}):j(n));try{var r=JSON.stringify(e);yield g.default.setItem(E,r)}catch(i){console.error("Error saving page contents",i)}}));return function(t,n){return e.apply(this,arguments)}}(),B=function(){var e=(0,i.default)((function*(){try{var e=yield g.default.getItem(F);return e?JSON.parse(e):[]}catch(t){return console.error("Error loading recent pages",t),[]}}));return function(){return e.apply(this,arguments)}}(),D=function(){var e=(0,i.default)((function*(e){try{var t=JSON.stringify(e);yield g.default.setItem(F,t)}catch(n){console.error("Error saving recent pages",n)}}));return function(t){return e.apply(this,arguments)}}(),N=function(){return(0,y.useQuery)({queryKey:["pageContents"],queryFn:S})},R=function(e){var t=(0,y.useQueryClient)();return(0,y.useQuery)({queryKey:["pageContent",e],queryFn:function(){var n=(0,i.default)((function*(){var n=(yield S()).find((function(t){return t.title===e}));n&&(void 0===(yield B()).find((function(t){return t===e}))&&(P=e,yield t.invalidateQueries({queryKey:["lastPage"]})));return n||{title:e,description:""}}));return function(){return n.apply(this,arguments)}}()})},I=function(){return(0,y.useQuery)({queryKey:["lastPage"],queryFn:function(){var e=(0,i.default)((function*(){return(yield S()).find((function(e){return e.title===P}))}));return function(){return e.apply(this,arguments)}}()})},z=function(){var e=(0,y.useQueryClient)(),t=(0,v.useAuthContext)().auth;return(0,y.useMutation)({mutationFn:function(){var e=(0,i.default)((function*(e){var n,r=e.title,i=e.description,o=yield S(),u=o.find((function(e){return e.title===r}));if(u)n=o.map((function(e,t){return e.id===u.id?w(w({},e),{},{description:i}):e}));else{var a,l={title:r,description:i,input:r,userId:(null==(a=t.user)?void 0:a.id)||0,parentId:0,type:"NOTE",order:0,option:{}};n=[].concat((0,h.default)(o),[l])}return yield T(n,null==u?void 0:u.id),{title:r,description:i}}));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(){var t=(0,i.default)((function*(t){yield e.invalidateQueries({queryKey:["pageContents"]}),yield e.invalidateQueries({queryKey:["pageContent",t.title]}),yield e.invalidateQueries({queryKey:["recentPages"]})}));return function(e){return t.apply(this,arguments)}}()})},L=function(){var e=(0,y.useQueryClient)();return(0,y.useMutation)({mutationFn:function(){var e=(0,i.default)((function*(e){var t=(yield B()).filter((function(t){return e!==t}));return P=void 0,yield D(t),{title:e}}));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(t){e.invalidateQueries({queryKey:["recentPages"]}),e.invalidateQueries({queryKey:["pageContent"]}),e.invalidateQueries({queryKey:["lastPage"]})}})},q=function(e){return f.default.create({container:{flex:1,backgroundColor:"dark"===e?"#121212":"#FFFFFF",paddingHorizontal:24,paddingVertical:16},card:{backgroundColor:"dark"===e?"#1E1E1E":"#FFFFFF",borderRadius:8,padding:16,marginBottom:16,borderWidth:1,borderColor:"dark"===e?"#333333":"#EEEEEE",shadowColor:"dark"===e?"#000000":"#888888",shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:4,elevation:2},title:{fontSize:18,fontWeight:"bold",marginBottom:8,color:"dark"===e?"#FFFFFF":"#000000"},text:{fontSize:16,color:"dark"===e?"#E4E4E4":"#333333",lineHeight:24},button:{backgroundColor:"dark"===e?"#2C73B5":"#3498DB",borderRadius:4,padding:12,alignItems:"center",marginVertical:8},buttonText:{color:"#FFFFFF",fontWeight:"500",fontSize:16},searchButton:{backgroundColor:"#3498DB",justifyContent:"center",alignItems:"center",width:36,height:36,borderRadius:4,marginHorizontal:4},resultSeparator:{height:1,backgroundColor:"dark"===e?"#333333":"#EEEEEE"},input:{backgroundColor:"dark"===e?"#222222":"#FFFFFF",borderWidth:1,borderColor:"dark"===e?"#444444":"#CCCCCC",borderRadius:4,padding:10,color:"dark"===e?"#E4E4E4":"#333333",marginBottom:16},separator:{height:1,backgroundColor:"dark"===e?"#333333":"#EEEEEE",marginVertical:12},smallText:{fontSize:14,color:"dark"===e?"#BBBBBB":"#777777"},header:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:16},flex:{flex:1},row:{flexDirection:"row",alignItems:"center"},centerContent:{justifyContent:"center",alignItems:"center"}})},K=n(4678),M=n(2184),Q=n(575),H=f.default.create({buttonContainer:{flexDirection:"row",justifyContent:"space-between"},cancelButton:{flex:1,marginRight:8,backgroundColor:"#95A5A6"},saveButton:{flex:1,marginLeft:8}}),A=n(9367),W=n(205),_=n(6579),V=n(48),$=n(4342);function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const U=function(e){var t,n=(0,K.useLangContext)().lang,r=N(),a=(0,y.useQuery)({queryKey:["recentPages"],queryFn:function(){var e=(0,i.default)((function*(){var e=yield B(),t=yield S();return e.map((function(e){return t.find((function(t){return t.title===e}))})).filter((function(e){return void 0!==e}))}));return function(){return e.apply(this,arguments)}}()}),l=I().data,s=o.useRef(),c=function(){var e=(0,y.useQueryClient)();return(0,y.useMutation)({mutationFn:function(){var e=(0,i.default)((function*(e){var t=e.title,n=e.direct,r=yield B();if(void 0===r.find((function(e){return e===t}))||n){var i=[t].concat((0,h.default)(r));yield D(i)}return{title:t}}));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(t){e.invalidateQueries({queryKey:["recentPages"]})}})}(),d=L(),f="NOTE"===e.type?null==(t=r.data)?void 0:t.filter((function(e){return e.description})).sort((function(e,t){return new Date(t.updated).getTime()-new Date(e.updated).getTime()})):a.data,p=(0,K.useResizeContext)(),g="landscape"===p?5:8,v=function(e){e===(null==l?void 0:l.title)&&(s.current?(clearTimeout(s.current),s.current=void 0,c.mutate({title:e})):s.current=setTimeout((function(){s.current=void 0}),500)),(0,u.navigate)("NotePage",{title:e})},x=function(e){var t;s.current&&(clearTimeout(s.current),s.current=void 0),void 0===(null==(t=a.data)?void 0:t.find((function(t){return t.title===e})))?c.mutate({title:e,direct:!0}):d.mutate(e)};return(0,Q.jsx)(W.default,{children:f&&("LAST"===e.type?l&&void 0===(null==f?void 0:f.find((function(e){return e.id===l.id})))&&(0,Q.jsx)(_.default,{left:function(e){return(0,Q.jsx)(V.default,G(G({},e),{},{icon:"file-document"}))},title:l.title,onPress:function(){return v(l.title)},onLongPress:function(){return x(l.title)},style:{padding:g},titleStyle:{fontStyle:"italic"}}):"NOTE"===e.type?(0,Q.jsxs)(Q.Fragment,{children:[f.slice(0,e.noteCount).map((function(e){return(0,Q.jsx)(_.default,{left:function(t){var n;return(0,Q.jsx)(V.default,G(G({},t),{},{icon:void 0===(null==(n=a.data)?void 0:n.find((function(t){return t.title===e.title})))?"notebook":"notebook-edit"}))},title:e.title,onPress:function(){return v(e.title)},onLongPress:function(){return x(e.title)},style:{padding:g}},e.id)})),((null==f?void 0:f.length)||0)>e.noteCount&&(0,Q.jsx)(_.default,{left:function(e){return(0,Q.jsx)(V.default,G(G({},e),{},{icon:"notebook-multiple"}))},title:n("more..."),onPress:function(){return(0,u.navigate)("RecentPages")},style:{padding:g}})]}):f.map((function(e){return(0,Q.jsx)(_.default,{left:function(e){return(0,Q.jsx)(V.default,G(G({},e),{},{icon:"file-document-edit"}))},right:function(t){return(0,Q.jsx)($.default,{style:{justifyContent:"center",borderRadius:g,width:40+2*g,height:40+2*g,margin:-g},onPress:function(){return d.mutate(e.title)},children:(0,Q.jsx)(V.default,{style:{left:g-7},icon:"close"})})},title:e.title,onPress:function(){return(0,u.navigate)("NotePage",{title:e.title})},style:{padding:g}},e.id)})))})};var Z=n(3390),Y=n(6927),X=n(2103),ee=n(1867);function te(e){for(var t=(new DOMParser).parseFromString(e,"text/html"),n=[{path:"",title:"",header:"",level:0,description:""}],r=["H1","H2","H3","H4","H5","H6"],i=[],o=null,u=t.body.firstChild,a=function(){o&&(n.push(o),o=null)};u;){if(u.nodeType===Node.ELEMENT_NODE){var l=u;if(r.includes(l.tagName)){var s;a();for(var c=parseInt(l.tagName.substring(1)),d=(null==(s=l.textContent)?void 0:s.trim())||"";i.length>0&&i[i.length-1].level>=c;)i.pop();i.push({level:c,title:d});var f=i.map((function(e){return e.title})).join(" > ");o={path:f,title:d,level:c,header:l.outerHTML,description:""}}else o?o.description+=l.outerHTML:n[0].description+=l.outerHTML}else u.nodeType===Node.TEXT_NODE&&o&&(o.description+=u.textContent||"");u=u.nextSibling}return a(),n}function ne(e){var t=(0,K.useColorScheme)(),n=q(t);return(0,Q.jsx)(l.default,{style:[re.resultsContainer,"dark"===t?re.darkResults:re.lightResults],children:(0,Q.jsx)(Y.default,{data:e.data,keyExtractor:function(e){return e.path},renderItem:function(t){return function(t){return(0,Q.jsxs)(c.default,{style:re.resultItem,onPress:function(){return e.onPress(t)},children:[0===t.level&&(0,Q.jsx)(ee.default,{name:"file-text-o",size:18,color:"#FFFFFF"}),(0,Q.jsx)(K.Text,{style:[e.path===t.path?[n.title,{marginBottom:5,marginTop:3}]:n.text,re.resultText,{left:10*t.level+10}],children:0===t.level?e.root:t.title})]})}(t.item)},ItemSeparatorComponent:function(){return(0,Q.jsx)(l.default,{style:n.resultSeparator})}})})}var re=f.default.create({backButton:{padding:8},resultItem:{padding:10,flexDirection:"row"},resultText:{fontSize:14},buttonContainer:{flexDirection:"row",justifyContent:"space-between"},resultsContainer:{borderWidth:1,borderRadius:4},lightResults:{backgroundColor:"#FFFFFF",borderColor:"#CCCCCC"},darkResults:{backgroundColor:"#222222",borderColor:"#444444"}}),ie="@blacktokki:notebook:keywords",oe=function(){var e=(0,i.default)((function*(){try{var e=yield g.default.getItem(ie);return e?JSON.parse(e):[]}catch(t){return console.error("Error loading keywords",t),[]}}));return function(){return e.apply(this,arguments)}}(),ue=function(){var e=(0,i.default)((function*(e){try{var t=JSON.stringify(e);yield g.default.setItem(ie,t)}catch(n){console.error("Error saving keywords",n)}}));return function(t){return e.apply(this,arguments)}}();function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var se="";function ce(e){var t=new URL(e);if(location.origin===t.origin){var n=new URLSearchParams(t.search),r=n.get("title"),i=n.get("section")||void 0;if(r)return{title:r,section:i}}}function de(e){return e.flatMap((function(e){return function(e){var t=(new DOMParser).parseFromString(e,"text/html").querySelectorAll("a");return Array.from(t).map((function(e){var t;return{text:(null==(t=e.textContent)?void 0:t.trim())||e.href,url:e.href}}))}(e.description||"").map((function(e){var t=ce(e.url);if(t&&e.text!==t.title)return le({type:"_NOTELINK",name:e.text},t)})).filter((function(e){return void 0!==e}))}))}var fe=function(){var e=(0,K.useColorScheme)(),t=q(e),n=(0,p.useNavigation)(),r=N().data,i=(void 0===r?[]:r).filter((function(e){return e.description}));return i&&(0,Q.jsx)(c.default,{style:t.searchButton,onPress:function(){var e=i[Math.floor(Math.random()*i.length)],t=te(e.description||"");n.navigate("NotePage",{title:e.title,section:t[Math.floor(Math.random()*t.length)].title})},children:(0,Q.jsx)(ee.default,{name:"random",size:18,color:"#FFFFFF"})})},pe=function(e){var t=e.handlePress,n=e.renderExtra,r=e.useRandom,u=void 0===r||r,d=(0,o.useState)(se),f=(0,a.default)(d,2),g=f[0],v=f[1],x=(0,o.useState)(!1),m=(0,a.default)(x,2),j=m[0],b=m[1],C=(0,p.useNavigation)(),k=(0,K.useColorScheme)(),O=q(k),w=(0,o.useRef)(),P=N().data,E=void 0===P?[]:P,F=(0,y.useQuery)({queryKey:["keywords"],queryFn:function(){var e=(0,i.default)((function*(){return oe()}));return function(){return e.apply(this,arguments)}}()}),S=F.data,T=void 0===S?[]:S,B=function(){var e=(0,y.useQueryClient)();return(0,y.useMutation)({mutationFn:function(){var e=(0,i.default)((function*(e){var t=yield oe(),n=(0,h.default)(new Set([].concat((0,h.default)(t),[e]))).filter((function(e){return e.trim()})).slice(0,10);yield ue(n)}));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(){var t=(0,i.default)((function*(){yield e.invalidateQueries({queryKey:["keywords"]})}));return function(){return t.apply(this,arguments)}}()})}(),D=g.toLowerCase(),R=g.length>0?[].concat((0,h.default)(E.filter((function(e){return e.title.toLowerCase().startsWith(D)}))),(0,h.default)(de(E).filter((function(e){return e.name.toLowerCase().startsWith(D)})))).slice(0,10):T.map((function(e){return{type:"_KEYWORD",title:e}})),I=function(){g.trim()&&z(g.trim())},z=function(e,n){t?t(e):C.navigate("NotePage",{title:e,section:n}),B.mutate(g),v("")},L=(0,o.useMemo)((function(){return X.default.create({onPanResponderStart:I}).panHandlers}),[g]),M=(0,o.useCallback)((function(e){return X.default.create({onPanResponderStart:function(){"_KEYWORD"===e.type?(v(e.title),setTimeout((function(){var e;return null==(e=w.current)?void 0:e.focus()}),50)):"_NOTELINK"===e.type&&e.section?z(e.title,e.section):z(e.title)}}).panHandlers}),[]);return(0,o.useEffect)((function(){se=g}),[g]),(0,p.useFocusEffect)((function(){g!==se&&v(se)})),(0,Q.jsxs)(l.default,{style:he.container,children:[(0,Q.jsxs)(l.default,{style:he.searchContainer,children:[(0,Q.jsx)(Z.default,{ref:function(e){w.current=e},style:[O.input,he.searchInput],value:g,onChangeText:function(e){v(e)},placeholder:"\uac80\uc0c9",placeholderTextColor:"dark"===k?"#777777":"#999999",onSubmitEditing:I,onFocus:function(){return b(!0)},onBlur:function(){return b(!1)}}),(0,Q.jsx)(c.default,{style:O.searchButton,onPress:I,disabled:!g.trim(),children:(0,Q.jsx)(ee.default,{name:n?"search-plus":"search",size:18,color:"#FFFFFF"})}),u&&(0,Q.jsx)(fe,{})]}),j&&(0,Q.jsxs)(l.default,{style:[he.resultsContainer,"dark"===k?he.darkResults:he.lightResults],children:[R.length>0?(0,Q.jsx)(Y.default,{data:R,keyExtractor:function(e){return JSON.stringify([e.title,e.name,e.section])},renderItem:function(e){var t=e.item;return(0,Q.jsxs)(c.default,le(le({style:he.resultItem},M(t)),{},{children:[(0,Q.jsx)(s.default,{style:[O.text,he.resultText],children:"_NOTELINK"===t.type?t.name:t.title}),"_NOTELINK"===t.type&&(0,Q.jsxs)(s.default,{style:[O.text,he.resultText,{fontSize:12}],children:[t.title,t.section?" > "+t.section:""]})]}))},ItemSeparatorComponent:function(){return(0,Q.jsx)(l.default,{style:[O.resultSeparator]})}}):g.trim()?(0,Q.jsx)(c.default,le(le({style:he.resultItem},L),{},{children:(0,Q.jsxs)(s.default,{style:[O.text,he.resultText],children:['"',g,'" \uc0c8 \ub178\ud2b8 \ub9cc\ub4e4\uae30']})})):null,null==n?void 0:n(g,R.length>0)]})]})},he=f.default.create({container:{position:"relative",width:"100%",maxWidth:960,zIndex:999},searchContainer:{flexDirection:"row"},searchInput:{flex:1,height:36,marginBottom:0,paddingVertical:4,fontSize:14},resultsContainer:{position:"absolute",top:40,left:0,right:0,maxHeight:500,borderWidth:1,borderRadius:4,zIndex:999,elevation:5},lightResults:{backgroundColor:"#FFFFFF",borderColor:"#CCCCCC"},darkResults:{backgroundColor:"#222222",borderColor:"#444444"},resultItem:{flexDirection:"row",justifyContent:"space-between",padding:10},resultText:{fontSize:14}}),ye=function(){var e=(0,K.useColorScheme)();return(0,Q.jsxs)(A.default,{style:{flex:1,backgroundColor:K.Colors[e].background},children:[(0,Q.jsx)(U,{type:"LAST"}),(0,Q.jsx)(U,{type:"PAGE"})]})},ge=function(){var e=(0,K.useColorScheme)();return(0,Q.jsx)(A.default,{style:{flex:1,backgroundColor:K.Colors[e].background},children:(0,Q.jsx)(U,{type:"NOTE",noteCount:15})})},ve=function(){var e=(0,K.useColorScheme)();return(0,Q.jsx)(A.default,{style:{flex:1,backgroundColor:K.Colors[e].background},children:(0,Q.jsx)(u.ConfigSections,{})})};f.default.create({searchContainer:{flexDirection:"row",marginBottom:16},searchInput:{flex:1,marginBottom:0},searchButton:{backgroundColor:"#3498DB",justifyContent:"center",alignItems:"center",width:48,borderRadius:4,marginLeft:8},recentButton:{flexDirection:"row",alignItems:"center",padding:8}});var xe=f.default.create({columns:{marginTop:8,marginBottom:16},backButton:{padding:8},buttonContainer:{flexDirection:"row",justifyContent:"space-between"},cancelButton:{flex:1,marginRight:8,backgroundColor:"#95A5A6"},moveButton:{flex:1,marginLeft:8}}),me=(new Date).getTimezoneOffset(),je=function(e){var t=new Date(e);t.setMinutes(t.getMinutes()-me);var n=t.toISOString().slice(0,16),r=n.slice(0,10);return r==(new Date).toISOString().slice(0,10)?n.slice(11):r},be=(f.default.create({backButton:{padding:8}}),n(7917)),Ce=f.default.create({backButton:{padding:8},pageTitle:{flex:1,fontSize:20},actionButtons:{flexDirection:"row"},actionButton:{padding:8,marginLeft:8}}),ke={Home:{title:"Blacktokki Notebook",component:function(e){e.navigation,e.route;var t=(0,K.useLangContext)().lang,n=(0,K.useColorScheme)(),r=q(n),i=t("Blacktokki Notebook"),o=[{title:t("Open Pages"),component:ye,icon:(0,Q.jsx)(V.default,{icon:"file-document"}),headerRight:function(){return(0,Q.jsx)(Q.Fragment,{})}},{title:t("Notes"),component:ge,icon:(0,Q.jsx)(V.default,{icon:"notebook"}),headerRight:function(){return(0,Q.jsx)(Q.Fragment,{})}},{title:t("Config"),component:ve,icon:(0,Q.jsx)(V.default,{icon:"dots-horizontal"}),headerRight:function(){return(0,Q.jsx)(Q.Fragment,{})}}];return(0,Q.jsx)(u.HomeSection,{tabViews:o,homeView:{title:i,headerRight:function(){return(0,Q.jsx)(pe,{})}},headerTitle:i,children:(0,Q.jsx)(l.default,{style:[r.container,{width:"100%"}],children:(0,Q.jsx)(l.default,{style:r.card,children:(0,Q.jsx)(u.ConfigSections,{})})})})},path:"home"},NotePage:{title:"Blacktokki Notebook",component:function(){var e=(0,p.useRoute)(),t=e.params,n=t.title,r=t.section,i=(0,p.useNavigation)(),u=(0,K.useColorScheme)(),d=(0,K.useResizeContext)(),f=q(u),h=(0,o.useState)(!1),y=(0,a.default)(h,2),g=y[0],v=y[1],x=R(n),m=x.data,j=x.isLoading,b=function(){i.navigate("EditPage",{title:n})},C=te((null==m?void 0:m.description)||""),k=r?function(e,t){var n,r=null==(n=e.find((function(e){return e.title===t})))?void 0:n.path;return r?e.filter((function(e){return e.path.startsWith(r)})).map((function(e){return e.header+e.description})).join(""):""}(C,r):null==m?void 0:m.description;return(0,o.useEffect)((function(){v(!1)}),[e]),(0,Q.jsxs)(Q.Fragment,{children:["portrait"===d&&(0,Q.jsx)(pe,{}),(0,Q.jsxs)(A.default,{style:[f.container,{paddingRight:12,scrollbarGutter:"stable"}],children:[(0,Q.jsxs)(l.default,{style:f.header,children:[(0,Q.jsx)(c.default,{onPress:function(){return i.navigate("NotePage",{title:n})},children:(0,Q.jsxs)(s.default,{style:[f.title,Ce.pageTitle],numberOfLines:1,children:[n,r?" \u25b6 "+r:""]})}),!(null==m||!m.description)&&(0,Q.jsxs)(l.default,{style:Ce.actionButtons,children:[(0,Q.jsx)(c.default,{onPress:function(){return v(!g)},style:Ce.actionButton,children:(0,Q.jsx)(ee.default,{name:"list",size:16,color:"dark"===u?"#E4E4E4":"#333333"})}),(0,Q.jsx)(c.default,{onPress:function(){i.navigate("MovePage",{title:n,section:r})},style:Ce.actionButton,children:(0,Q.jsx)(ee.default,{name:"exchange",size:16,color:"dark"===u?"#E4E4E4":"#333333"})}),r?void 0:(0,Q.jsx)(Q.Fragment,{children:(0,Q.jsx)(c.default,{onPress:b,style:Ce.actionButton,children:(0,Q.jsx)(ee.default,{name:"pencil",size:16,color:"dark"===u?"#E4E4E4":"#333333"})})})]})]}),(0,Q.jsx)(l.default,{style:f.flex,children:j?(0,Q.jsx)(l.default,{style:[f.card,f.centerContent],children:(0,Q.jsx)(be.default,{size:"large",color:"#3498DB"})}):(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(l.default,{style:!g&&k?[f.card,{flex:1,padding:0}]:{flex:1,position:"absolute"},children:(0,Q.jsx)(M.EditorViewer,{active:!0,value:k||"",theme:u,onLink:function(e){var t=ce(e);t?i.navigate("NotePage",t):window.open(e,"_blank")},autoResize:!0})}),g?(0,Q.jsx)(ne,{data:C,path:r||"",root:n,onPress:function(e){return i.navigate("NotePage",{title:n,section:e.title})}}):null!=m&&m.description?void 0:(0,Q.jsxs)(l.default,{style:[f.card,f.centerContent],children:[(0,Q.jsx)(s.default,{style:f.text,children:"\uc544\uc9c1 \ub0b4\uc6a9\uc774 \uc5c6\ub294 \ubb38\uc11c\uc785\ub2c8\ub2e4. '\ud3b8\uc9d1' \ubc84\ud2bc\uc744 \ub20c\ub7ec \ub0b4\uc6a9\uc744 \ucd94\uac00\ud574\ubcf4\uc138\uc694."}),(0,Q.jsx)(c.default,{onPress:b,style:f.button,children:(0,Q.jsx)(s.default,{style:f.buttonText,children:"\ud3b8\uc9d1\ud558\uae30"})})]})]})})]})]})},path:"page"},EditPage:{title:"Blacktokki Notebook",component:function(){var e=(0,p.useRoute)().params.title,t=(0,p.useNavigation)(),n=(0,K.useColorScheme)(),r=q(n),i=R(e),u=i.data,f=i.isLoading,h=(0,o.useState)(""),y=(0,a.default)(h,2),g=y[0],v=y[1],x=z();return(0,o.useEffect)((function(){!f&&null!=u&&u.description&&v(null==u?void 0:u.description)}),[f]),(0,p.useFocusEffect)((function(){var e=function(e){e.preventDefault(),e.returnValue=""};return window.addEventListener("beforeunload",e),function(){return window.removeEventListener("beforeunload",e)}})),(0,Q.jsxs)(l.default,{style:r.container,children:[(0,Q.jsx)(l.default,{style:r.header,children:(0,Q.jsxs)(s.default,{style:[r.title,{flex:1}],children:[e," - \ud3b8\uc9d1"]})}),(0,Q.jsx)(M.Editor,{active:!0,value:g,setValue:v,theme:n}),(0,Q.jsxs)(l.default,{style:H.buttonContainer,children:[(0,Q.jsx)(c.default,{style:[r.button,H.cancelButton],onPress:function(){t.canGoBack()?t.goBack():t.navigate("NotePage",{title:e})},children:(0,Q.jsx)(s.default,{style:r.buttonText,children:"\ucde8\uc18c"})}),(0,Q.jsx)(c.default,{style:[r.button,H.saveButton],onPress:function(){x.mutate({title:e,description:g},{onSuccess:function(){t.navigate("NotePage",{title:e})},onError:function(e){d.default.alert("\uc624\ub958",e.message||"\ubb38\uc11c\ub97c \uc800\uc7a5\ud558\ub294 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}})},children:(0,Q.jsx)(s.default,{style:r.buttonText,children:"\uc800\uc7a5"})})]})]})},path:"edit"},MovePage:{title:"Blacktokki Notebook",component:function(){var e=(0,p.useRoute)().params,t=e.title,n=e.section,r=(0,p.useNavigation)(),u=(0,K.useColorScheme)(),f=(0,K.useResizeContext)(),g=(0,o.useState)(t),v=(0,a.default)(g,2),x=v[0],m=v[1],j=R(t),b=j.data,C=j.isLoading,k=te((null==b?void 0:b.description)||""),O=(0,o.useState)(""),P=(0,a.default)(O,2),E=P[0],F=P[1],N=R(x).data,I=te((null==N?void 0:N.description)||"").filter((function(e){return t!==x||E===e.path||!e.path.startsWith(E)})),L=(0,o.useState)(""),H=(0,a.default)(L,2),W=H[0],_=H[1],V=(0,o.useState)(),$=(0,a.default)(V,2),J=$[0],G=$[1],U=q(u),Z=z(),Y=function(){var e=(0,y.useQueryClient)();return(0,y.useMutation)({mutationFn:function(){var e=(0,i.default)((function*(e){var t=e.oldTitle,n=e.newTitle,r=e.description,i=yield S(),o=i.find((function(e){return e.title===t}));if(!o)throw new Error("Page not found");if(i.some((function(e){return e.title===n})))throw new Error("Page with new title already exists");var u=i.map((function(e){return e.title===t?w(w({},e),{},{title:n,description:r||o.description}):e}));yield T(u,o.id);var a=(yield B()).map((function(e){return e===t?n:e}));return yield D(a),{oldTitle:t,newTitle:n}}));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(t){e.invalidateQueries({queryKey:["pageContents"]}),e.invalidateQueries({queryKey:["pageContent",t.oldTitle]}),e.invalidateQueries({queryKey:["pageContent",t.newTitle]}),e.invalidateQueries({queryKey:["recentPages"]})}})}(),X=(0,o.useMemo)((function(){var e=k.filter((function(e){return e.path.startsWith(E)})),t=e.map((function(e){return e.header+e.description})).join(""),n=k.filter((function(e){return!e.path.startsWith(E)})),r=n.map((function(e){return e.header+e.description})).join(""),i=(null==b?void 0:b.title)===(null==N?void 0:N.title)?n:I,o=i.findLastIndex((function(e){return e.path.startsWith(W)}));return{sourceDescription:r,targetDescription:void 0===N?t:[].concat((0,h.default)(i.slice(0,o+1).map((function(e){return e.header+e.description}))),(0,h.default)(e.map((function(e){return(e.path===E&&""===e.description?"":e.header)+e.description}))),(0,h.default)(i.slice(o+1).map((function(e){return e.header+e.description})))).join("")}}),[k,I,E,W]),ee=X.sourceDescription,re=X.targetDescription,ie=function(){r.canGoBack()?r.goBack():r.navigate("NotePage",{title:t})};(0,o.useEffect)((function(){C||b||ie(),b&&m(b.title)}),[b,C]),(0,o.useEffect)((function(){if(!C){var e,t=(null==(e=k.find((function(e){return e.title===n})))?void 0:e.path)||"";F(t),_(t)}}),[n,C]);var oe=k.find((function(e){return e.path===E})),ue=I.find((function(e){return e.path===W})),ae=!x.trim()||void 0===ue;return(0,Q.jsx)(A.default,{style:U.container,children:(0,Q.jsxs)(l.default,{style:U.card,children:[(0,Q.jsxs)(l.default,{style:{flexDirection:"landscape"===f?"row":"column",zIndex:1},children:[(0,Q.jsxs)(l.default,{style:{zIndex:1},children:[(0,Q.jsx)(s.default,{style:U.text,children:"\ud604\uc7ac \ub178\ud2b8 \uc81c\ubaa9:"}),(0,Q.jsx)(s.default,{style:[U.title,xe.columns],children:t}),(0,Q.jsx)(s.default,{style:U.text,children:"\ud604\uc7ac \ub178\ud2b8 \ubb38\ub2e8:"}),void 0!==n?(0,Q.jsx)(s.default,{style:[U.title,xe.columns],children:n}):(0,Q.jsx)(l.default,{style:xe.columns,children:(0,Q.jsx)(ne,{path:E,onPress:function(e){return F(e.path)},root:(null==b?void 0:b.title)||"",data:k})}),(0,Q.jsx)(s.default,{style:U.text,children:"\uc0c8 \ub178\ud2b8 \uc81c\ubaa9:"}),(0,Q.jsx)(pe,{handlePress:m,useRandom:!1}),(0,Q.jsx)(s.default,{style:U.text,children:"\uc0c8 \ub178\ud2b8 \ubb38\ub2e8:"}),(0,Q.jsx)(l.default,{style:xe.columns,children:(0,Q.jsx)(ne,{path:W,onPress:function(e){return _(e.path)},root:(null==N?void 0:N.title)||"",data:I})})]}),(0,Q.jsxs)(l.default,{style:{flex:1},children:[(0,Q.jsx)(s.default,{style:U.text,children:" \ubbf8\ub9ac\ubcf4\uae30:"}),(0,Q.jsxs)(c.default,{style:[U.button,xe.moveButton,{flex:0,flexDirection:"row",alignItems:"center",paddingTop:24,paddingBottom:16}],onPress:function(){return G(!J)},children:[(0,Q.jsxs)(s.default,{style:U.title,children:[t,0!==(null==oe?void 0:oe.level)?"/"+(null==oe?void 0:oe.title):""]}),(0,Q.jsx)(s.default,{style:[U.text,{marginBottom:8,fontSize:14}],children:"  \u25b6  "}),(0,Q.jsxs)(s.default,{style:U.title,children:[x,0!==(null==ue?void 0:ue.level)?"/"+((null==ue?void 0:ue.title)||"?"):""]})]}),void 0!==J&&(0,Q.jsx)(l.default,{style:{display:J?"flex":"none"},children:(0,Q.jsx)(M.EditorViewer,{active:!0,value:re,theme:u,autoResize:!0})})]})]}),(0,Q.jsxs)(l.default,{style:xe.buttonContainer,children:[(0,Q.jsx)(c.default,{style:[U.button,xe.cancelButton],onPress:ie,children:(0,Q.jsx)(s.default,{style:U.buttonText,children:"\ucde8\uc18c"})}),(0,Q.jsx)(c.default,{style:[U.button,ae?xe.cancelButton:xe.moveButton],onPress:function(){void 0===N?Y.mutate({oldTitle:t,newTitle:x.trim(),description:""===E?void 0:re},{onSuccess:function(e){r.navigate({name:"NotePage",params:{title:e.newTitle}})},onError:function(e){d.default.alert("\uc624\ub958",e.message||"\ub178\ud2b8 \uc774\ub3d9 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}}):((null==b?void 0:b.title)===N.title&&E===W&&ie(),Z.mutate({title:N.title,description:re},{onSuccess:function(e){(null==b?void 0:b.title)!==N.title&&Z.mutate({title:t,description:ee}),r.navigate({name:"NotePage",params:{title:e.title}})},onError:function(e){d.default.alert("\uc624\ub958",e.message||"\ub178\ud2b8 \uc774\ub3d9 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}}))},disabled:ae,children:(0,Q.jsx)(s.default,{style:U.buttonText,children:"\uc774\ub3d9"})})]})]})})},path:"move"},RecentPages:{title:"Blacktokki Notebook",component:function(){var e=(0,p.useNavigation)(),t=(0,K.useColorScheme)(),n=q(t),r=(0,K.useResizeContext)(),i=N(),o=i.data,u=void 0===o?[]:o,a=i.isLoading;return(0,Q.jsxs)(Q.Fragment,{children:["portrait"===r&&(0,Q.jsx)(pe,{}),(0,Q.jsx)(l.default,{style:n.container,children:a?(0,Q.jsx)(l.default,{style:[n.card,n.centerContent],children:(0,Q.jsx)(s.default,{style:n.text,children:"\ub85c\ub529 \uc911..."})}):u.length>0?(0,Q.jsx)(Y.default,{data:u.sort((function(e,t){return new Date(t.updated).getTime()-new Date(e.updated).getTime()})),keyExtractor:function(e){return e.title},renderItem:function(t){var r=t.item;return(0,Q.jsxs)(c.default,{style:n.card,onPress:function(){return t=r.title,void e.navigate("NotePage",{title:t});var t},children:[(0,Q.jsx)(s.default,{style:n.title,children:r.title}),(0,Q.jsxs)(s.default,{style:n.smallText,children:["\ucd5c\uadfc \uc218\uc815: ",je(r.updated)]})]})},ItemSeparatorComponent:function(){return(0,Q.jsx)(l.default,{style:{height:8}})}}):(0,Q.jsx)(l.default,{style:[n.card,n.centerContent],children:(0,Q.jsx)(s.default,{style:n.text,children:"\ucd5c\uadfc \uc218\uc815\ud55c \ub178\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."})})})]})},path:"recent"}},Oe=n(5589);function we(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?we(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):we(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Ee=function(){var e=(0,K.useLangContext)().lang;return(0,Q.jsxs)(K.View,{style:{flex:1},children:[(0,Q.jsx)(_.default,{left:function(e){return(0,Q.jsx)(V.default,Pe(Pe({},e),{},{icon:"home"}))},title:e("Home"),onPress:function(){return(0,u.navigate)("Home")}}),(0,Q.jsxs)(A.default,{children:[(0,Q.jsx)(Oe.default,{style:{},selectable:!1,children:e("Open Pages")}),(0,Q.jsx)(U,{type:"LAST"}),(0,Q.jsx)(U,{type:"PAGE"}),(0,Q.jsx)(Oe.default,{style:{flex:1},selectable:!1,children:e("Notes")}),(0,Q.jsx)(U,{type:"NOTE",noteCount:10})]})]})};var Fe=n(8610),Se=n(7650),Te=n(2876);function Be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function De(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ne=function(){return"landscape"===(0,K.useResizeContext)()?(0,Q.jsx)(pe,{}):void 0},Re=function(){var e=(0,i.default)((function*(e){var t=yield Promise.all([n.e(928),n.e(973)]).then(n.bind(n,9928));return{main:ke,login:u.login,prefixes:[t.makeUrl("/")],rootPath:"blacktokki-notebook",documentTitle:{formatter:function(){return"blacktokki-notebook"}},rootScreen:{main:"Home",login:"LoginScreen"},headerLeftIcon:(0,Q.jsx)(V.default,{icon:"backburger",style:{left:-18,top:-14}}),headerRight:(0,Q.jsx)(Ne,{}),modals:[],drawer:(0,Q.jsx)(Ee,{})}}));return function(t){return e.apply(this,arguments)}}();const Ie=function(){var e=(0,K.useColorScheme)(),t="dark"==e?Fe.MD2DarkTheme:Se.MD2LightTheme,n=De(De({},t),{},{colors:De(De({},t.colors),{},{primary:K.Colors[e].text})}),r=o.lazy((function(){return Re(e).then((function(e){return{default:function(){return(0,Q.jsx)(u.Navigation,{config:e})}}}))}));return(0,Q.jsx)(Te.default,{theme:n,children:(0,Q.jsx)(o.Suspense,{fallback:(0,Q.jsx)(Q.Fragment,{}),children:(0,Q.jsx)(r,{})})})}}}]);
//# sourceMappingURL=710.b6249390.chunk.js.map