"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[279],{41279:(t,e,n)=>{n.r(e),n.d(e,{default:()=>ae});var r=n(24586),i=n(86330),o=n(29399),a=n(12089),u=n(83705),l=n(90689),s=n(47904),c=n(95346),d=n(63717),f=n(95225),p=n(20863),y=n(54807),h=n(68111),g=n(5209),v=n(8594),x=(0,v.axiosCreate)("notebook"),m=(function(){var t=(0,i.default)((function*(t){return(yield x.get(`/api/v1/content/${t}`)).data}))}(),function(){var t=(0,i.default)((function*(t,e){var n=void 0!==t?`&parentId=${t}`:"",r=void 0!==e?`&types=${e.join(",")}`:"";return(yield x.get(`/api/v1/content?self=true&size=256${n}${r}`)).data.value}));return function(e,n){return t.apply(this,arguments)}}()),j=function(){var t=(0,i.default)((function*(t){return(yield x.post("/api/v1/content",t)).data.id}));return function(e){return t.apply(this,arguments)}}(),b=function(){var t=(0,i.default)((function*(t){var e=t.id,n=t.updated;yield x.patch("/api/v1/content",{ids:[e],updated:n})}));return function(e){return t.apply(this,arguments)}}(),P=(function(){var t=(0,i.default)((function*(t){yield x.delete(`/api/v1/content/${t}`)}))}(),/https?:\/\/(?:www\\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:[-a-zA-Z0-9()@:%_\+.~#?&\/=]*)/gi),C=function(t){return function(t,e){for(var n,r=e,i=0,o=[];null!=(n=new RegExp(t).exec(r));){o.push({index:i,str:r.substring(0,n.index)});var a=n.index+n[0].length;o.push({index:i+n.index,str:r.substring(n.index,a)}),i+=a,r=r.substring(a)}return o.push({index:i,str:r}),o}(P,t).filter((function(t,e){return e%2==1})).map((function(t){return t.str}))};!function(){var t=(0,i.default)((function*(t){var e=[];for(var n of C(t.query))e.push((yield x.get(`/api/v1/preview/autocomplete?query=${n}`)).data);return e}))}();function O(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function k(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?O(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var w,S="@blacktokki:notebook:contents",E="@blacktokki:notebook:recent_pages",F=function(){var t=(0,i.default)((function*(t){return yield m(void 0,[t])}));return function(e){return t.apply(this,arguments)}}(),T=function(){var t=(0,i.default)((function*(t,e){var n=t.find((function(t){return e===t.id}));if(n){var r=yield e?b({id:e,updated:n}).then((function(){return e})):j(n),i=k(k({},n),{},{type:"SNAPSHOT",id:void 0,parentId:r});yield j(i)}try{var o=JSON.stringify(t);yield g.default.setItem(S,o)}catch(a){console.error("Error saving page contents",a)}}));return function(e,n){return t.apply(this,arguments)}}(),N=function(){var t=(0,i.default)((function*(){try{var t=yield g.default.getItem(E);return t?JSON.parse(t):[]}catch(e){return console.error("Error loading recent pages",e),[]}}));return function(){return t.apply(this,arguments)}}(),D=function(){var t=(0,i.default)((function*(t){try{var e=JSON.stringify(t);yield g.default.setItem(E,e)}catch(n){console.error("Error saving recent pages",n)}}));return function(e){return t.apply(this,arguments)}}(),B=function(){return(0,h.useQuery)({queryKey:["pageContents"],queryFn:function(){var t=(0,i.default)((function*(){return yield F("NOTE")}));return function(){return t.apply(this,arguments)}}()})},R=function(){return(0,h.useQuery)({queryKey:["snapshotContents"],queryFn:function(){var t=(0,i.default)((function*(){return yield F("SNAPSHOT")}));return function(){return t.apply(this,arguments)}}()})},L=function(t){var e=(0,h.useQueryClient)(),n=B(),r=n.data,o=void 0===r?[]:r,a=n.isFetching;return(0,h.useQuery)({queryKey:["pageContent",t],queryFn:function(){var n=(0,i.default)((function*(){var n=o.find((function(e){return e.title===t}));n&&(void 0===(yield N()).find((function(e){return e===t}))&&(w=t,yield e.invalidateQueries({queryKey:["lastPage"]})));return n||{title:t,description:""}}));return function(){return n.apply(this,arguments)}}(),enabled:!a})},z=function(){var t=B(),e=t.data,n=void 0===e?[]:e,r=t.isFetching;return(0,h.useQuery)({queryKey:["lastPage"],queryFn:function(){var t=(0,i.default)((function*(){return n.find((function(t){return t.title===w}))}));return function(){return t.apply(this,arguments)}}(),enabled:!r})},I=function(){var t=(0,h.useQueryClient)(),e=(0,v.useAuthContext)().auth,n=B().data,r=void 0===n?[]:n;return(0,h.useMutation)({mutationFn:function(){var t=(0,i.default)((function*(t){var n,i=t.title,o=t.description,a=r.find((function(t){return t.title===i}));if(a)n=r.map((function(t,e){return t.id===a.id?k(k({},t),{},{description:o}):t}));else{var l,s={title:i,description:o,input:i,userId:(null==(l=e.user)?void 0:l.id)||0,parentId:0,type:"NOTE",order:0,option:{}};n=[].concat((0,u.default)(r),[s])}return yield T(n,null==a?void 0:a.id),{title:i,description:o}}));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(){var e=(0,i.default)((function*(e){yield t.invalidateQueries({queryKey:["pageContents"]}),yield t.invalidateQueries({queryKey:["snapshotContents"]}),yield t.invalidateQueries({queryKey:["pageContent",e.title]}),yield t.invalidateQueries({queryKey:["recentPages"]})}));return function(t){return e.apply(this,arguments)}}()})},K=function(){var t=(0,h.useQueryClient)();return(0,h.useMutation)({mutationFn:function(){var t=(0,i.default)((function*(t){var e=(yield N()).filter((function(e){return t!==e}));return w=void 0,yield D(e),{title:t}}));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(e){t.invalidateQueries({queryKey:["recentPages"]}),t.invalidateQueries({queryKey:["pageContent"]}),t.invalidateQueries({queryKey:["lastPage"]})}})},M=function(t){return p.default.create({container:{flex:1,backgroundColor:"dark"===t?"#121212":"#FFFFFF",paddingHorizontal:24,paddingVertical:16},card:{backgroundColor:"dark"===t?"#1E1E1E":"#FFFFFF",borderRadius:8,padding:16,marginBottom:16,borderWidth:1,borderColor:"dark"===t?"#333333":"#EEEEEE",shadowColor:"dark"===t?"#000000":"#888888",shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:4,elevation:2},title:{fontSize:18,fontWeight:"bold",marginBottom:8,color:"dark"===t?"#FFFFFF":"#000000"},text:{fontSize:16,color:"dark"===t?"#E4E4E4":"#333333",lineHeight:24},button:{backgroundColor:"dark"===t?"#2C73B5":"#3498DB",borderRadius:4,padding:12,alignItems:"center",marginVertical:8},buttonText:{color:"#FFFFFF",fontWeight:"500",fontSize:16},searchButton:{backgroundColor:"#3498DB",justifyContent:"center",alignItems:"center",width:36,height:36,borderRadius:4,marginHorizontal:4},resultSeparator:{height:1,backgroundColor:"dark"===t?"#333333":"#EEEEEE"},input:{backgroundColor:"dark"===t?"#222222":"#FFFFFF",borderWidth:1,borderColor:"dark"===t?"#444444":"#CCCCCC",borderRadius:4,padding:10,color:"dark"===t?"#E4E4E4":"#333333",marginBottom:16},separator:{height:1,backgroundColor:"dark"===t?"#333333":"#EEEEEE",marginVertical:12},smallText:{fontSize:14,color:"dark"===t?"#BBBBBB":"#777777"},header:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:16},flex:{flex:1},row:{flexDirection:"row",alignItems:"center"},centerContent:{justifyContent:"center",alignItems:"center"}})},q=n(32024),Q=n(47884),A=n(63390),W=n(56927),H=n(82103),$=n(41867),V=n(50575);function _(t){for(var e=(new DOMParser).parseFromString(t,"text/html"),n=[{path:"",title:"",header:"",level:0,description:""}],r=["H1","H2","H3","H4","H5","H6"],i=[],o=null,a=e.body.firstChild,u=function(){o&&(n.push(o),o=null)};a;){if(a.nodeType===Node.ELEMENT_NODE){var l=a;if(r.includes(l.tagName)){var s;u();for(var c=parseInt(l.tagName.substring(1)),d=(null==(s=l.textContent)?void 0:s.trim())||"";i.length>0&&i[i.length-1].level>=c;)i.pop();i.push({level:c,title:d});var f=i.map((function(t){return t.title})).join(" > ");o={path:f,title:d,level:c,header:l.outerHTML,description:""}}else o?o.description+=l.outerHTML:n[0].description+=l.outerHTML}else a.nodeType===Node.TEXT_NODE&&o&&(o.description+=a.textContent||"");a=a.nextSibling}return u(),n}function J(t){var e=(0,q.useColorScheme)(),n=M(e);return(0,V.jsx)(s.default,{style:[U.resultsContainer,"dark"===e?U.darkResults:U.lightResults],children:(0,V.jsx)(W.default,{data:t.data,keyExtractor:function(t){return t.path},renderItem:function(e){return function(e){return(0,V.jsxs)(d.default,{style:U.resultItem,onPress:function(){return t.onPress(e)},children:[0===e.level&&(0,V.jsx)($.default,{name:"file-text-o",size:18,color:"#FFFFFF"}),(0,V.jsx)(q.Text,{style:[t.path===e.path?[n.title,{marginBottom:5,marginTop:3}]:n.text,U.resultText,{left:10*e.level+10}],children:0===e.level?t.root:e.title})]})}(e.item)},ItemSeparatorComponent:function(){return(0,V.jsx)(s.default,{style:n.resultSeparator})}})})}var U=p.default.create({backButton:{padding:8},resultItem:{padding:10,flexDirection:"row"},resultText:{fontSize:14},buttonContainer:{flexDirection:"row",justifyContent:"space-between"},resultsContainer:{borderWidth:1,borderRadius:4},lightResults:{backgroundColor:"#FFFFFF",borderColor:"#CCCCCC"},darkResults:{backgroundColor:"#222222",borderColor:"#444444"}}),G="@blacktokki:notebook:keywords",Z=function(){var t=(0,i.default)((function*(){try{var t=yield g.default.getItem(G);return t?JSON.parse(t):[]}catch(e){return console.error("Error loading keywords",e),[]}}));return function(){return t.apply(this,arguments)}}(),Y=function(){var t=(0,i.default)((function*(t){try{var e=JSON.stringify(t);yield g.default.setItem(G,e)}catch(n){console.error("Error saving keywords",n)}}));return function(e){return t.apply(this,arguments)}}(),X=function(){return(0,h.useQuery)({queryKey:["keywords"],queryFn:function(){var t=(0,i.default)((function*(){return Z()}));return function(){return t.apply(this,arguments)}}()})};function tt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function et(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?tt(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var nt="";function rt(t){var e=new URL(t);if(location.origin===e.origin){var n=new URLSearchParams(e.search),r=n.get("title"),i=n.get("section")||void 0;if(r)return{title:r,section:i}}}function it(t){return t.flatMap((function(t){return function(t){var e=(new DOMParser).parseFromString(t,"text/html").querySelectorAll("a");return Array.from(e).map((function(t){var e;return{text:(null==(e=t.textContent)?void 0:e.trim())||t.href,url:t.href}}))}(t.description||"").map((function(e){var n=rt(e.url);if(n&&e.text!==n.title)return et(et({type:"_NOTELINK",name:e.text},n),{},{origin:t.title})})).filter((function(t){return void 0!==t}))}))}var ot=function(t,e){var n=e.toLowerCase(),r=it(t);return[].concat((0,u.default)(t.filter((function(t){return t.title.toLowerCase().startsWith(n)}))),(0,u.default)(r.filter((function(t){return t.name.toLowerCase().startsWith(n)}))))},at=function(){var t=(0,q.useColorScheme)(),e=M(t),n=(0,y.useNavigation)(),r=B().data,i=(void 0===r?[]:r).filter((function(t){return t.description}));return i&&(0,V.jsx)(d.default,{style:e.searchButton,onPress:function(){var t=i[Math.floor(Math.random()*i.length)],e=_(t.description||"");n.navigate("NotePage",{title:t.title,section:e[Math.floor(Math.random()*e.length)].title})},children:(0,V.jsx)($.default,{name:"random",size:18,color:"#FFFFFF"})})},ut=function(t){return`${t.title}${t.section?" \u25b6 "+t.section:""}`},lt=function(t){var e=t.filteredPages,n=t.handlePagePress,r=t.addKeyword,i=(0,q.useColorScheme)(),a=M(i),u=(0,o.useCallback)((function(t){return H.default.create({onPanResponderStart:function(){"_NOTELINK"===t.type&&t.section?(n(t.title,t.section),null==r||r(t)):(n(t.title),null==r||r({type:"_KEYWORD",title:t.title}))}}).panHandlers}),[]);return(0,V.jsx)(W.default,{data:e,keyExtractor:function(t){return JSON.stringify([t.title,t.name,t.section])},renderItem:function(t){var e=t.item;return(0,V.jsxs)(d.default,et(et({style:ct.resultItem},u(e)),{},{children:[(0,V.jsx)(c.default,{style:[a.text,ct.resultText],children:"_NOTELINK"===e.type?e.name:e.title}),"_NOTELINK"===e.type&&(0,V.jsx)(c.default,{style:[a.text,ct.resultText,{fontSize:12}],children:ut(e)})]}))},ItemSeparatorComponent:function(){return(0,V.jsx)(s.default,{style:[a.resultSeparator]})}})},st=function(t){var e=t.handlePress,n=t.useRandom,r=void 0===n||n,a=(0,o.useState)(nt),f=(0,l.default)(a,2),p=f[0],g=f[1],v=(0,o.useState)(!1),x=(0,l.default)(v,2),m=x[0],j=x[1],b=(0,y.useNavigation)(),P=(0,q.useColorScheme)(),C=M(P),O=(0,o.useRef)(),k=X().data,w=void 0===k?[]:k,S=function(){var t=(0,h.useQueryClient)();return(0,h.useMutation)({mutationFn:function(){var t=(0,i.default)((function*(t){var e=yield Z(),n=(0,u.default)(new Set([JSON.stringify(t)].concat((0,u.default)(e.map((function(t){return JSON.stringify(t)})))))).map((function(t){return JSON.parse(t)}));yield Y(n)}));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(){var e=(0,i.default)((function*(){yield t.invalidateQueries({queryKey:["keywords"]})}));return function(){return e.apply(this,arguments)}}()})}(),E=B().data,F=void 0===E?[]:E,T=p.length>0?ot(F,p).slice(0,10):w.slice(0,10),N=function(){p.trim()&&(D(p.trim()),S.mutate({type:"_KEYWORD",title:p.trim()}))},D=function(t,n){e?e(t):b.navigate("NotePage",{title:t,section:n}),g("")},R=(0,o.useMemo)((function(){return H.default.create({onPanResponderStart:N}).panHandlers}),[p]);return(0,o.useEffect)((function(){nt=p}),[p]),(0,y.useFocusEffect)((function(){p!==nt&&g(nt)})),(0,V.jsxs)(s.default,{style:ct.container,children:[(0,V.jsxs)(s.default,{style:ct.searchContainer,children:[(0,V.jsx)(A.default,{ref:function(t){O.current=t},style:[C.input,ct.searchInput],value:p,onChangeText:function(t){g(t)},placeholder:"\uac80\uc0c9",placeholderTextColor:"dark"===P?"#777777":"#999999",onSubmitEditing:N,onFocus:function(){return j(!0)},onBlur:function(){return j(!1)}}),(0,V.jsx)(d.default,{style:C.searchButton,onPress:N,disabled:!p.trim(),children:(0,V.jsx)($.default,{name:"search",size:18,color:"#FFFFFF"})}),r&&(0,V.jsx)(at,{})]}),m&&(0,V.jsx)(s.default,{style:[ct.resultsContainer,"dark"===P?ct.darkResults:ct.lightResults],children:T.length>0?(0,V.jsx)(lt,{filteredPages:T,handlePagePress:D,addKeyword:S.mutate}):p.trim()?(0,V.jsx)(d.default,et(et({style:ct.resultItem},R),{},{children:(0,V.jsxs)(c.default,{style:[C.text,ct.resultText],children:['"',p,'" \uc0c8 \ub178\ud2b8 \ub9cc\ub4e4\uae30']})})):null})]})},ct=p.default.create({container:{position:"relative",width:"100%",maxWidth:960,zIndex:999},searchContainer:{flexDirection:"row"},searchInput:{flex:1,height:36,marginBottom:0,paddingVertical:4,fontSize:14},resultsContainer:{position:"absolute",top:40,left:0,right:0,maxHeight:500,borderWidth:1,borderRadius:4,zIndex:999,elevation:5},lightResults:{backgroundColor:"#FFFFFF",borderColor:"#CCCCCC"},darkResults:{backgroundColor:"#222222",borderColor:"#444444"},resultItem:{flexDirection:"row",justifyContent:"space-between",padding:10},resultText:{fontSize:14}}),dt=p.default.create({buttonContainer:{flexDirection:"row",justifyContent:"space-between"},cancelButton:{flex:1,marginRight:8,backgroundColor:"#95A5A6"},saveButton:{flex:1,marginLeft:8}}),ft=n(9367),pt=n(76579),yt=n(20048),ht=n(40205),gt=n(57687);function vt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function xt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?vt(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var mt=function(){var t=(0,q.useLangContext)().lang;return(0,V.jsx)(pt.default,{left:function(t){return(0,V.jsx)(yt.default,xt(xt({},t),{},{icon:"note-remove"}))},title:t("Empty Page"),onPress:function(){return(0,a.navigate)("EmptyPages")}})},jt=function(){var t=(0,q.useLangContext)().lang;return(0,V.jsx)(pt.default,{left:function(t){return(0,V.jsx)(yt.default,xt(xt({},t),{},{icon:"note-edit"}))},title:t("Empty Content"),onPress:function(){return(0,a.navigate)("EmptyContents")}})},bt=function(t){return t.filter((function(t){return t.description})).sort((function(t,e){return new Date(e.updated).getTime()-new Date(t.updated).getTime()}))};const Pt=function(t){var e=(0,q.useLangContext)().lang,n=B(),r=function(){var t=B(),e=t.data,n=void 0===e?[]:e,r=t.isFetching;return(0,h.useQuery)({queryKey:["recentPages"],queryFn:function(){var t=(0,i.default)((function*(){return(yield N()).map((function(t){return n.find((function(e){return e.title===t}))})).filter((function(t){return void 0!==t}))}));return function(){return t.apply(this,arguments)}}(),enabled:!r})}(),l=z().data,s=o.useRef(),c=function(){var t=(0,h.useQueryClient)();return(0,h.useMutation)({mutationFn:function(){var t=(0,i.default)((function*(t){var e=t.title,n=t.direct,r=yield N();if(void 0===r.find((function(t){return t===e}))||n){var i=[e].concat((0,u.default)(r));yield D(i)}return{title:e}}));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(e){t.invalidateQueries({queryKey:["recentPages"]})}})}(),d=K(),f="NOTE"===t.type?n.data?bt(n.data):[]:r.data,p=l&&void 0===(null==f?void 0:f.find((function(t){return t.id===l.id}))),y=(0,q.useResizeContext)(),g="landscape"===y?5:8,v=function(t){t===(null==l?void 0:l.title)&&(s.current?(clearTimeout(s.current),s.current=void 0,c.mutate({title:t})):s.current=setTimeout((function(){s.current=void 0}),500)),(0,a.navigate)("NotePage",{title:t})},x=function(t){var e;s.current&&(clearTimeout(s.current),s.current=void 0),void 0===(null==(e=r.data)?void 0:e.find((function(e){return e.title===t})))?c.mutate({title:t,direct:!0}):d.mutate(t)};return("LAST"!==t.type||p)&&(0,V.jsx)(ht.default,{children:f&&("LAST"===t.type?p&&(0,V.jsx)(pt.default,{left:function(t){return(0,V.jsx)(yt.default,xt(xt({},t),{},{icon:"file-document"}))},title:l.title,onPress:function(){return v(l.title)},onLongPress:function(){return x(l.title)},style:{padding:g},titleStyle:{fontStyle:"italic"}}):"NOTE"===t.type?(0,V.jsxs)(V.Fragment,{children:[f.slice(0,t.noteCount).map((function(t){return(0,V.jsx)(pt.default,{left:function(e){var n;return(0,V.jsx)(yt.default,xt(xt({},e),{},{icon:void 0===(null==(n=r.data)?void 0:n.find((function(e){return e.title===t.title})))?"notebook":"notebook-edit"}))},title:t.title,onPress:function(){return v(t.title)},onLongPress:function(){return x(t.title)},style:{padding:g}},t.id)})),(0,V.jsx)(pt.default,{left:function(t){return(0,V.jsx)(yt.default,xt(xt({},t),{},{icon:"notebook-multiple"}))},title:e("more..."),onPress:function(){return(0,a.navigate)("RecentPages")},style:{padding:g}})]}):f.map((function(t){return(0,V.jsx)(pt.default,{left:function(t){return(0,V.jsx)(yt.default,xt(xt({},t),{},{icon:"file-document-edit"}))},right:function(e){return(0,V.jsx)(gt.default,{style:{justifyContent:"center",borderRadius:g,width:40+2*g,height:40+2*g,margin:-g},onPress:function(){return d.mutate(t.title)},children:(0,V.jsx)(yt.default,{style:{left:g-7},icon:"close"})})},title:t.title,onPress:function(){return(0,a.navigate)("NotePage",{title:t.title})},style:{padding:g}},t.id)})))})};var Ct=n(55589),Ot=n(46072),kt=n(39274),wt=n.n(kt),St=(new Date).getTimezoneOffset(),Et=function(t){var e=new Date(t);e.setMinutes(e.getMinutes()-St);var n=e.toISOString().slice(0,16),r=n.slice(0,10);return r==(new Date).toISOString().slice(0,10)?n.slice(11):r},Ft=function(t){return t?20:4},Tt=function(t){return t?250:190},Nt=o.memo((function(t){var e,n=t.item,r=t.index,i=(0,q.useResizeContext)(),a=Tt("landscape"===i),u=(0,q.useColorScheme)(),s=M(u),c="landscape"===i?2:0,f=(0,o.useState)(r<10),p=(0,l.default)(f,2),h=p[0],g=p[1],v=(0,o.useState)(r<5),x=(0,l.default)(v,2),m=x[0],j=x[1];if((0,o.useEffect)((function(){if(!h){var t=setTimeout((function(){return g(!0)}),10*r);return function(){return clearTimeout(t)}}if(!m){var e=setTimeout((function(){return j(!0)}),60);return function(){return clearTimeout(e)}}}),[n,r,h]),null===n)return(0,V.jsx)(q.View,{style:{flexBasis:"landscape"===i?"33%":"50%",maxWidth:a}});var b=(0,y.useNavigation)(),P=function(){return b.navigate("NotePage",{title:n.title})};return(0,V.jsxs)(d.default,{style:{flexBasis:"landscape"===i?"33%":"50%",padding:Ft("landscape"===i),paddingRight:0,minWidth:a,maxWidth:a},onPress:P,children:[(0,V.jsx)(Ot.default,{onPress:P,style:[s.card,{paddingTop:8,aspectRatio:1/Math.sqrt(2),borderRadius:6,marginVertical:10,marginHorizontal:8,overflow:"hidden"}],children:(0,V.jsx)(Ot.default.Content,{style:{padding:0},children:h&&(0,V.jsx)(wt(),{source:{html:(m?n.description:null==(e=n.description)?void 0:e.slice(0,200))||""},renderersProps:{a:{onPress:P}},tagsStyles:{body:{color:s.text.color}},contentWidth:a})})}),(0,V.jsxs)(q.View,{style:{flexDirection:"row",marginTop:10,padding:0,justifyContent:"space-between",alignItems:"center",width:"100%"},children:[(0,V.jsx)(q.Text,{style:{fontSize:14+c,overflow:"hidden"},children:n.title}),(0,V.jsx)(q.Text,{style:{fontSize:12+c,opacity:.4,textAlign:"right"},children:Et(n.updated)})]})]})})),Dt=o.memo((function(){var t=(0,q.useColorScheme)(),e=M(t),n=(0,q.useResizeContext)(),r=B(),i=r.data,a=void 0===i?[]:i,l=r.isLoading,s=(0,o.useMemo)((function(){return[].concat((0,u.default)(bt(a)),[null,null])}),[a]),c=(Tt("landscape"===n)+5)*("landscape"===n?5:3);return l?(0,V.jsx)(q.View,{style:[e.card,e.centerContent],children:(0,V.jsx)(q.Text,{style:e.text,children:"\ub85c\ub529 \uc911..."})}):s.length>2?(0,V.jsx)(ft.default,{contentContainerStyle:{alignSelf:"center",backgroundColor:"transparent",flexBasis:"100%",maxWidth:c,flexWrap:"wrap",flexDirection:"row",paddingRight:Ft("landscape"===n),justifyContent:"landscape"===n?void 0:"center"},children:s.map((function(t,e){return function(t){var e=t.item,n=t.index;return(0,V.jsx)(Nt,{index:n,item:e},n)}({item:t,index:e})}))},n):(0,V.jsx)(q.View,{style:[e.card,e.centerContent],children:(0,V.jsx)(q.Text,{style:e.text,children:"\ucd5c\uadfc \uc218\uc815\ud55c \ub178\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."})})})),Bt=n(31692),Rt=function(){var t=(0,q.useColorScheme)(),e=(0,q.useLangContext)().lang;return(0,V.jsxs)(ft.default,{style:{flex:1,backgroundColor:q.Colors[t].background},children:[(0,V.jsx)(Ct.default,{style:{},selectable:!1,children:e("Open Pages")}),(0,V.jsx)(Pt,{type:"LAST"}),(0,V.jsx)(Pt,{type:"PAGE"}),(0,V.jsx)(Ct.default,{style:{},selectable:!1,children:e("Problems")}),(0,V.jsx)(mt,{}),(0,V.jsx)(jt,{})]})},Lt=function(){return(0,V.jsx)(Dt,{})},zt=function(t){var e=(0,q.useColorScheme)(),n=M(e),r=q.Colors[e].text;return(0,V.jsxs)(d.default,{style:[n.header,{marginBottom:0}],onPress:t.onPress,disabled:!t.onPress,children:[(0,V.jsx)(q.Text,{style:{fontSize:20,color:r,fontWeight:"600"},children:t.title}),t.onPress&&(0,V.jsx)(q.Text,{children:">"})]})},It=function(){var t=(0,q.useLangContext)().lang,e=(0,v.useAuthContext)().dispatch,n=(0,q.useColorScheme)(),r=M(n),u=q.Colors[n].text,c=(0,o.useState)(!1),d=(0,l.default)(c,2),f=d[0],p=d[1],y=X().data,g=void 0===y?[]:y,x=function(){var t=(0,h.useQueryClient)();return(0,h.useMutation)({mutationFn:function(){var t=(0,i.default)((function*(){yield Y([])}));return function(){return t.apply(this,arguments)}}(),onSuccess:function(){var e=(0,i.default)((function*(){yield t.invalidateQueries({queryKey:["keywords"]})}));return function(){return e.apply(this,arguments)}}()})}();return(0,V.jsxs)(s.default,{children:[(0,V.jsx)(s.default,{style:r.card,children:(0,V.jsx)(a.ConfigSections,{})}),(0,V.jsxs)(s.default,{style:r.card,children:[(0,V.jsx)(zt,{title:t("* Search Settings")}),(0,V.jsxs)(s.default,{style:{flexDirection:"row"},children:[(0,V.jsx)(q.TextButton,{title:"Search History",textStyle:{fontSize:16,color:u,textDecorationLine:f?"underline":"none"},style:{borderRadius:20},onPress:function(){return p(!f)}}),f&&g.length&&(0,V.jsx)(q.TextButton,{title:"Clear",textStyle:{fontSize:16,color:u},style:{borderRadius:20},onPress:function(){return x.mutate()}})]}),f&&(0,V.jsx)(s.default,{style:[r.card,{padding:0}],children:(0,V.jsx)(lt,{filteredPages:g,handlePagePress:function(t,e){return(0,a.navigate)("NotePage",{title:t,section:e})}})})]}),(0,V.jsx)(s.default,{style:r.card,children:(0,V.jsx)(zt,{title:t("* Archive"),onPress:function(){return(0,a.navigate)("Archive",{})}})}),(0,V.jsx)(s.default,{style:r.card,children:(0,V.jsx)(zt,{title:t("* Logout"),onPress:function(){return e({type:"LOGOUT_REQUEST"})}})})]})},Kt=function(){var t=(0,q.useColorScheme)(),e=M(t);return(0,V.jsx)(ft.default,{style:{flex:1},contentContainerStyle:[e.container,{backgroundColor:q.Colors[t].background}],children:(0,V.jsx)(It,{})})};var Mt=p.default.create({columns:{marginTop:8,marginBottom:16},backButton:{padding:8},buttonContainer:{flexDirection:"row",justifyContent:"space-between"},cancelButton:{flex:1,marginRight:8,backgroundColor:"#95A5A6"},moveButton:{flex:1,marginLeft:8}}),qt=n(57917),Qt=function(t,e,n){var r,i=null==(r=t.find((function(t){return t.title===e})))?void 0:r.path;return i?t.filter((function(t){return t.path.startsWith(i)})).map((function(t){return(n||t.path!==i?t.header:"")+t.description})).join(""):""},At=function(t){var e=t.split("/");return e.length<2?[t]:[e.slice(0,e.length-1).join("/"),e[e.length-1]]},Wt=p.default.create({backButton:{padding:8},pageTitle:{flex:1,fontSize:20},actionButtons:{flexDirection:"row"},actionButton:{padding:8,marginLeft:8}}),Ht=function(t){var e=t.contents,n=t.isLoading,r=t.onPress,i=t.emptyMessage,o=(0,q.useColorScheme)(),a=M(o),u=(0,q.useResizeContext)();return(0,V.jsxs)(V.Fragment,{children:["portrait"===u&&(0,V.jsx)(st,{}),(0,V.jsx)(s.default,{style:a.container,children:n?(0,V.jsx)(s.default,{style:[a.card,a.centerContent],children:(0,V.jsx)(c.default,{style:a.text,children:"\ub85c\ub529 \uc911..."})}):e.length>0?(0,V.jsx)(W.default,{data:e,keyExtractor:function(t){return JSON.stringify([t.title,t.section,t.id])},renderItem:function(t){var e=t.item;return(0,V.jsxs)(d.default,{style:a.card,onPress:function(){return r(e.title,e.section,e.id)},children:[(0,V.jsx)(c.default,{style:a.title,children:ut(e)}),void 0!==e.subtitle&&(0,V.jsx)(c.default,{style:a.smallText,children:e.subtitle})]})},ItemSeparatorComponent:function(){return(0,V.jsx)(s.default,{style:{height:8}})}}):(0,V.jsx)(s.default,{style:[a.card,a.centerContent],children:(0,V.jsx)(c.default,{style:a.text,children:i})})})]})};function $t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Vt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$t(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$t(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function _t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Jt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_t(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_t(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ut={Home:{title:"Blacktokki Notebook",component:function(t){t.navigation,t.route;var e=(0,q.useLangContext)().lang,n=(0,q.useColorScheme)(),r=M(n),i=e("Blacktokki Notebook"),o=[{title:e("Discovery"),component:Rt,icon:(0,V.jsx)(yt.default,{icon:"compass"}),headerRight:function(){return(0,V.jsx)(V.Fragment,{})}},{title:e("All Notes"),component:Lt,icon:(0,V.jsx)(yt.default,{icon:"notebook"}),headerRight:function(){return(0,V.jsx)(V.Fragment,{})}},{title:e("Config"),component:Kt,icon:(0,V.jsx)(yt.default,{icon:"dots-horizontal"}),headerRight:function(){return(0,V.jsx)(V.Fragment,{})}}];return(0,V.jsx)(a.HomeSection,{tabViews:o,homeView:{title:i,headerRight:function(){return(0,V.jsx)(st,{})}},headerTitle:i,children:(0,V.jsxs)(s.default,{style:[r.container,{width:"100%",justifyContent:"space-between"}],children:[(0,V.jsx)(It,{}),(0,V.jsx)(q.ContractFooter,{buttons:[{icon:(0,V.jsx)(Bt.default,{name:"github",size:24,color:q.Colors[n].iconColor}),url:"https://github.com/blacktokki/blacktokki-notebook",isWeb:!0},{icon:(0,V.jsx)(Bt.default,{name:"mail",size:24,color:q.Colors[n].iconColor}),url:"mailto:ydh051541@naver.com",isWeb:!1}]})]})})},path:"home"},NotePage:{title:"Blacktokki Notebook",component:function(){var t=(0,y.useRoute)(),e=t.params,n=e.title,r=e.section,i=e.archiveId,a=(0,y.useNavigation)(),u=(0,q.useColorScheme)(),f=(0,q.useResizeContext)(),p=M(u),h=(0,o.useState)(!1),g=(0,l.default)(h,2),v=g[0],x=g[1],m=L(n),j=m.data,b=m.isLoading,P=R().data,C=i?null==P?void 0:P.find((function(t){return t.id===i&&t.description!==(null==j?void 0:j.description)})):void 0,O=function(){a.navigate("EditPage",{title:n})},k=_((null==j?void 0:j.description)||""),w=(0,o.useState)(),S=(0,l.default)(w,2),E=S[0],F=S[1];(0,o.useEffect)((function(){if(void 0!==E)return function(){return F(void 0)};F(C?C.description:r?Qt(k,r,!0):null==j?void 0:j.description)}),[j,C,r,E]),(0,o.useEffect)((function(){x(!1)}),[t]);var T=At(n);return(0,V.jsxs)(V.Fragment,{children:["portrait"===f&&(0,V.jsx)(st,{}),(0,V.jsxs)(ft.default,{style:[p.container,{paddingRight:12,scrollbarGutter:"stable"}],children:[(0,V.jsxs)(s.default,{style:p.header,children:[(0,V.jsxs)(s.default,{style:{flexDirection:"row"},children:[(0,V.jsx)(d.default,{onPress:function(){return a.navigate("NotePage",{title:T[0]})},children:(0,V.jsx)(c.default,{style:[p.title,Wt.pageTitle],numberOfLines:1,children:T[0]})}),2===T.length&&(0,V.jsx)(c.default,{style:[p.title,Wt.pageTitle],numberOfLines:1,children:"/"+T[1]}),r&&(0,V.jsx)(c.default,{style:[p.title,Wt.pageTitle,{marginLeft:5}],numberOfLines:1,children:ut({title:"",section:r})}),C&&(0,V.jsx)(c.default,{style:[p.text,{marginLeft:5,fontStyle:"italic"}],children:"("+C.updated+")"})]}),(0,V.jsxs)(s.default,{style:Wt.actionButtons,children:[!r&&(0,V.jsx)(V.Fragment,{children:(0,V.jsx)(d.default,{onPress:function(){return a.navigate("Archive",{title:n})},style:Wt.actionButton,children:(0,V.jsx)($.default,{name:"history",size:16,color:"dark"===u?"#E4E4E4":"#333333"})})}),!!E&&!C&&(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(d.default,{onPress:function(){return x(!v)},style:Wt.actionButton,children:(0,V.jsx)($.default,{name:"list",size:16,color:"dark"===u?"#E4E4E4":"#333333"})}),(0,V.jsx)(d.default,{onPress:function(){a.navigate("MovePage",{title:n,section:r})},style:Wt.actionButton,children:(0,V.jsx)($.default,{name:"exchange",size:16,color:"dark"===u?"#E4E4E4":"#333333"})})]}),!!E&&!C&&!r&&(0,V.jsx)(V.Fragment,{children:(0,V.jsx)(d.default,{onPress:O,style:Wt.actionButton,children:(0,V.jsx)($.default,{name:"pencil",size:16,color:"dark"===u?"#E4E4E4":"#333333"})})})]})]}),(0,V.jsx)(s.default,{style:p.flex,children:b?(0,V.jsx)(s.default,{style:[p.card,p.centerContent],children:(0,V.jsx)(qt.default,{size:"large",color:"#3498DB"})}):(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(s.default,{style:!v&&E?[p.card,{flex:1,padding:0}]:{flex:1,position:"absolute"},children:(0,V.jsx)(Q.EditorViewer,{active:!0,value:E||"",theme:u,onLink:function(t){var e=rt(t);e?a.navigate("NotePage",e):window.open(t,"_blank")},autoResize:!0})}),v?(0,V.jsx)(J,{data:k,path:r||"",root:n,onPress:function(t){return a.navigate("NotePage",{title:n,section:t.title})}}):null!=j&&j.description?void 0:(0,V.jsxs)(s.default,{style:[p.card,p.centerContent],children:[(0,V.jsx)(c.default,{style:p.text,children:"\uc544\uc9c1 \ub0b4\uc6a9\uc774 \uc5c6\ub294 \ubb38\uc11c\uc785\ub2c8\ub2e4. '\ud3b8\uc9d1' \ubc84\ud2bc\uc744 \ub20c\ub7ec \ub0b4\uc6a9\uc744 \ucd94\uac00\ud574\ubcf4\uc138\uc694."}),(0,V.jsx)(d.default,{onPress:O,style:p.button,children:(0,V.jsx)(c.default,{style:p.buttonText,children:"\ud3b8\uc9d1\ud558\uae30"})})]})]})})]})]})},path:"page"},EditPage:{title:"Blacktokki Notebook",component:function(){var t=(0,y.useRoute)().params.title,e=(0,y.useNavigation)(),n=(0,q.useColorScheme)(),r=M(n),i=L(t),a=i.data,p=i.isLoading,h=B().data,g=void 0===h?[]:h,v=(0,o.useState)(""),x=(0,l.default)(v,2),m=x[0],j=x[1],b=I();return(0,o.useEffect)((function(){!p&&null!=a&&a.description&&j(null==a?void 0:a.description)}),[p]),(0,y.useFocusEffect)((function(){var t=function(t){t.preventDefault(),t.returnValue=""};return window.addEventListener("beforeunload",t),function(){return window.removeEventListener("beforeunload",t)}})),(0,V.jsxs)(s.default,{style:r.container,children:[(0,V.jsx)(s.default,{style:r.header,children:(0,V.jsxs)(c.default,{style:[r.title,{flex:1}],children:[t," - \ud3b8\uc9d1"]})}),(0,V.jsx)(Q.Editor,{active:!0,value:m,setValue:j,theme:n,autoComplete:[{trigger:"[",getMatchedChars:function(e){return[{type:"_NOTELINK",name:e,title:t,section:e}].concat((0,u.default)(ot(g,e))).map((function(t){var e="_NOTELINK"===t.type?t.name+`(${ut(t)})`:t.title;return{text:e,value:`<a href=${encodeURI("_NOTELINK"===t.type&&t.section?`?title=${t.title}&section=${t.section}`:`?title=${t.title}`)}>${e}</a>`}}))}}]}),(0,V.jsxs)(s.default,{style:dt.buttonContainer,children:[(0,V.jsx)(d.default,{style:[r.button,dt.cancelButton],onPress:function(){e.canGoBack()?e.goBack():e.navigate("NotePage",{title:t})},children:(0,V.jsx)(c.default,{style:r.buttonText,children:"\ucde8\uc18c"})}),(0,V.jsx)(d.default,{style:[r.button,dt.saveButton],onPress:function(){(null==a?void 0:a.description)!==m?b.mutate({title:t,description:m},{onSuccess:function(){e.navigate("NotePage",{title:t})},onError:function(t){f.default.alert("\uc624\ub958",t.message||"\ubb38\uc11c\ub97c \uc800\uc7a5\ud558\ub294 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}}):e.navigate("NotePage",{title:t})},children:(0,V.jsx)(c.default,{style:r.buttonText,children:"\uc800\uc7a5"})})]})]})},path:"edit"},MovePage:{title:"Blacktokki Notebook",component:function(){var t,e=(0,y.useRoute)().params,n=e.title,r=e.section,a=(0,y.useNavigation)(),p=(0,q.useColorScheme)(),g=(0,q.useResizeContext)(),v=(0,o.useState)(n),x=(0,l.default)(v,2),m=x[0],j=x[1],b=L(n),P=b.data,C=b.isLoading,O=_((null==P?void 0:P.description)||""),w=(null==(t=O.find((function(t){return t.title===r})))?void 0:t.path)||"",S=L(m).data,E=_((null==S?void 0:S.description)||"").filter((function(t){return n!==m||w===t.path||!t.path.startsWith(w)})),F=(0,o.useState)(""),R=(0,l.default)(F,2),z=R[0],K=R[1],A=(0,o.useState)(),W=(0,l.default)(A,2),H=W[0],$=W[1],U=M(p),G=I(),Z=function(){var t=(0,h.useQueryClient)(),e=B().data,n=void 0===e?[]:e;return(0,h.useMutation)({mutationFn:function(){var t=(0,i.default)((function*(t){var e=t.oldTitle,r=t.newTitle,i=t.description,o=n.find((function(t){return t.title===e}));if(!o)throw new Error("Page not found");if(n.some((function(t){return t.title===r})))throw new Error("Page with new title already exists");var a=n.map((function(t){return t.title===e?k(k({},t),{},{title:r,description:i||o.description}):t}));yield T(a,o.id);var u=(yield N()).map((function(t){return t===e?r:t}));return yield D(u),{oldTitle:e,newTitle:r}}));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(e){t.invalidateQueries({queryKey:["pageContents"]}),t.invalidateQueries({queryKey:["snapshotContents"]}),t.invalidateQueries({queryKey:["pageContent",e.oldTitle]}),t.invalidateQueries({queryKey:["pageContent",e.newTitle]}),t.invalidateQueries({queryKey:["recentPages"]})}})}(),Y=(0,o.useMemo)((function(){var t=O.filter((function(t){return t.path.startsWith(w)})),e=t.map((function(t){return t.header+t.description})).join(""),n=O.filter((function(t){return!t.path.startsWith(w)})),r=n.map((function(t){return t.header+t.description})).join(""),i=(null==P?void 0:P.title)===(null==S?void 0:S.title)?n:E,o=i.findLastIndex((function(t){return t.path.startsWith(z)}));return{sourceDescription:r,targetDescription:void 0===S?e:[].concat((0,u.default)(i.slice(0,o+1).map((function(t){return t.header+t.description}))),(0,u.default)(t.map((function(t){return(t.path===w&&""===t.description?"":t.header)+t.description}))),(0,u.default)(i.slice(o+1).map((function(t){return t.header+t.description})))).join("")}}),[O,E,w,z]),X=Y.sourceDescription,tt=Y.targetDescription,et=function(){a.canGoBack()?a.goBack():a.navigate("NotePage",{title:n})};(0,o.useEffect)((function(){C||P||et(),P&&j(P.title)}),[P,C]),(0,o.useEffect)((function(){C||K(w)}),[r,C]);var nt=O.find((function(t){return t.path===w})),rt=E.find((function(t){return t.path===z})),it=!m.trim()||void 0===rt;return(0,V.jsx)(ft.default,{style:U.container,children:(0,V.jsxs)(s.default,{style:U.card,children:[(0,V.jsxs)(s.default,{style:{flexDirection:"landscape"===g?"row":"column",zIndex:1},children:[(0,V.jsxs)(s.default,{style:{zIndex:1},children:[(0,V.jsx)(c.default,{style:U.text,children:r?"\ud604\uc7ac \ub178\ud2b8 \uc81c\ubaa9 \ubc0f \ubb38\ub2e8:":"\ud604\uc7ac \ub178\ud2b8 \uc81c\ubaa9:"}),(0,V.jsx)(c.default,{style:[U.title,Mt.columns],children:ut({title:n,section:r})}),(0,V.jsx)(c.default,{style:U.text,children:"\uc0c8 \ub178\ud2b8 \uc81c\ubaa9 \ubc0f \ubb38\ub2e8:"}),(0,V.jsx)(st,{handlePress:j,useRandom:!1}),(0,V.jsx)(s.default,{style:Mt.columns,children:(0,V.jsx)(J,{path:z,onPress:function(t){return K(t.path)},root:(null==S?void 0:S.title)||"",data:E})})]}),(0,V.jsxs)(s.default,{style:{flex:1},children:[(0,V.jsx)(c.default,{style:U.text,children:" \ubbf8\ub9ac\ubcf4\uae30:"}),(0,V.jsxs)(d.default,{style:[U.button,Mt.moveButton,{flex:0,flexDirection:"row",alignItems:"center",paddingTop:24,paddingBottom:16}],onPress:function(){return $(!H)},children:[(0,V.jsx)(c.default,{style:U.title,children:ut({title:n,section:null==nt?void 0:nt.title})}),(0,V.jsx)(c.default,{style:[U.text,{marginBottom:8,fontSize:14}],children:"  \u279c  "}),(0,V.jsx)(c.default,{style:U.title,children:ut({title:m,section:null==rt?void 0:rt.title})})]}),void 0!==H&&(0,V.jsx)(s.default,{style:{display:H?"flex":"none"},children:(0,V.jsx)(Q.EditorViewer,{active:!0,value:tt,theme:p,autoResize:!0})})]})]}),(0,V.jsxs)(s.default,{style:Mt.buttonContainer,children:[(0,V.jsx)(d.default,{style:[U.button,Mt.cancelButton],onPress:et,children:(0,V.jsx)(c.default,{style:U.buttonText,children:"\ucde8\uc18c"})}),(0,V.jsx)(d.default,{style:[U.button,it?Mt.cancelButton:Mt.moveButton],onPress:function(){void 0===S?Z.mutate({oldTitle:n,newTitle:m.trim(),description:""===w?void 0:tt},{onSuccess:function(t){a.navigate({name:"NotePage",params:{title:t.newTitle}})},onError:function(t){f.default.alert("\uc624\ub958",t.message||"\ub178\ud2b8 \uc774\ub3d9 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}}):((null==P?void 0:P.title)===S.title&&w===z&&et(),G.mutate({title:S.title,description:tt},{onSuccess:function(t){(null==P?void 0:P.title)!==S.title&&G.mutate({title:n,description:X}),a.navigate({name:"NotePage",params:{title:t.title}})},onError:function(t){f.default.alert("\uc624\ub958",t.message||"\ub178\ud2b8 \uc774\ub3d9 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}}))},disabled:it,children:(0,V.jsx)(c.default,{style:U.buttonText,children:"\uc774\ub3d9"})})]})]})})},path:"move"},RecentPages:{title:"Blacktokki Notebook",component:function(){var t=(0,q.useResizeContext)();return(0,V.jsxs)(V.Fragment,{children:["portrait"===t&&(0,V.jsx)(st,{}),(0,V.jsx)(Dt,{})]})},path:"recent"},EmptyPages:{title:"Blacktokki Notebook",component:function(){var t=(0,y.useNavigation)(),e=B(),n=e.data,r=void 0===n?[]:n,i=e.isLoading,o=it(r).filter((function(t){var e=r.find((function(e){return e.title===t.title}));return null==e||!e.description||void 0!==t.section&&!_(e.description).find((function(e){return e.title===t.section}))})).map((function(t){return Vt(Vt({},t),{},{subtitle:(void 0===t.section?"Unknown note link":"Unknown section link")+`(${t.origin})`})})),a=r.map((function(t){var e=At(t.title);if(t.description&&2===e.length&&void 0===r.find((function(t){return t.title===e[0]})))return{title:e[0],subtitle:`Empty parent note(${t.title})`}})).filter((function(t){return void 0!==t}));return(0,V.jsx)(Ht,{contents:[].concat((0,u.default)(o),(0,u.default)(a)),onPress:function(e){return t.navigate("EditPage",{title:e})},isLoading:i,emptyMessage:"\uc791\uc131\uc774 \ud544\uc694\ud55c \ub178\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."})},path:"need"},EmptyContents:{title:"Blacktokki Notebook",component:function(){var t=(0,y.useNavigation)(),e=B(),n=e.data,r=void 0===n?[]:n,i=e.isLoading,o=r.flatMap((function(t){var e=_(t.description||""),n=e.filter((function(t){return 0!==t.level&&""===Qt(e,t.title,!1).trim()})),r=e.filter((function(t){return function(t){for(var e,n=/<(ol|ul)\b[^>]*>([\s\n\r]*)<\/\1>/gi,r=[];null!==(e=n.exec(t));)r.push(e[0]);return r}(t.description).length>0}));return[].concat((0,u.default)(n.map((function(e){return{title:t.title,section:0===e.level?void 0:e.title,subtitle:"Empty section"}}))),(0,u.default)(r.map((function(e){return{title:t.title,section:0===e.level?void 0:e.title,subtitle:"Empty list"}}))))}));return(0,V.jsx)(Ht,{contents:o,onPress:function(e){return t.navigate("EditPage",{title:e})},isLoading:i,emptyMessage:"\uc791\uc131\uc774 \ud544\uc694\ud55c \ub0b4\uc6a9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."})},path:"empty"},Archive:{title:"Blacktokki Notebook",component:function(){var t=(0,y.useNavigation)(),e=(0,y.useRoute)().params.title,n=R(),r=n.data,i=void 0===r?[]:r,o=n.isLoading;return(0,V.jsx)(Ht,{contents:i.filter((function(t){return void 0===e||e===t.title})).sort((function(t,e){return new Date(e.updated).getTime()-new Date(t.updated).getTime()})).map((function(t){return Jt(Jt({},t),{},{subtitle:`\ucd5c\uadfc \uc218\uc815: ${Et(t.updated)}`})})),isLoading:o,onPress:function(e,n,r){return t.navigate("NotePage",{title:e,archiveId:r})},emptyMessage:"\ucd5c\uadfc \uc218\uc815\ud55c \ub178\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."})},path:"archive"}};function Gt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Zt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Gt(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Gt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}const Yt=function(){var t=(0,q.useLangContext)().lang;return(0,V.jsxs)(q.View,{style:{flex:1},children:[(0,V.jsx)(pt.default,{left:function(t){return(0,V.jsx)(yt.default,Zt(Zt({},t),{},{icon:"home"}))},title:t("Home"),onPress:function(){return(0,a.navigate)("Home")}}),(0,V.jsx)(mt,{}),(0,V.jsx)(jt,{}),(0,V.jsxs)(ft.default,{children:[(0,V.jsx)(Ct.default,{style:{},selectable:!1,children:t("Open Pages")}),(0,V.jsx)(Pt,{type:"LAST"}),(0,V.jsx)(Pt,{type:"PAGE"}),(0,V.jsx)(Ct.default,{style:{flex:1},selectable:!1,children:t("Recent Changes")}),(0,V.jsx)(Pt,{type:"NOTE",noteCount:10})]})]})};var Xt=n(88610),te=n(77650),ee=n(50910);function ne(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function re(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ne(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ne(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ie=function(){return"landscape"===(0,q.useResizeContext)()?(0,V.jsx)(st,{}):void 0},oe=function(){var t=(0,i.default)((function*(t){var e=yield Promise.all([n.e(928),n.e(973)]).then(n.bind(n,49928));return{main:Ut,login:a.login,prefixes:[e.makeUrl("/")],rootPath:"blacktokki-notebook",documentTitle:{formatter:function(){return"blacktokki-notebook"}},rootScreen:{main:"Home",login:"LoginScreen"},headerLeftIcon:(0,V.jsx)(yt.default,{icon:"backburger",style:{left:-18,top:-14}}),headerRight:(0,V.jsx)(ie,{}),modals:[],drawer:(0,V.jsx)(Yt,{})}}));return function(e){return t.apply(this,arguments)}}();const ae=function(){var t=(0,q.useColorScheme)(),e="dark"==t?Xt.MD2DarkTheme:te.MD2LightTheme,n=re(re({},e),{},{colors:re(re({},e.colors),{},{primary:q.Colors[t].text})}),r=o.lazy((function(){return oe(t).then((function(t){return{default:function(){return(0,V.jsx)(a.Navigation,{config:t})}}}))}));return(0,V.jsx)(ee.default,{theme:n,children:(0,V.jsx)(o.Suspense,{fallback:(0,V.jsx)(V.Fragment,{}),children:(0,V.jsx)(r,{})})})}}}]);
//# sourceMappingURL=279.4830c105.chunk.js.map