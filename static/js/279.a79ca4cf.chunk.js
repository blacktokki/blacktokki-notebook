"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[279],{41279:(t,e,n)=>{n.r(e),n.d(e,{default:()=>ce});var r=n(24586),i=n(86330),o=n(32024),u=n(12089),a=n(29399),l=n(20048),s=n(88610),c=n(77650),d=n(50910),f=n(90689),p=n(83705),h=n(54807),y=n(47904),g=n(63390),v=n(63717),x=n(56927),m=n(95346),j=n(20863),b=n(82103),O=n(41867),C=n(8594),P=n(5209),w=n(68111),S="@blacktokki:notebook:keywords:",k=function(){var t=(0,i.default)((function*(t){try{var e=yield P.default.getItem(S+t);return e?JSON.parse(e):[]}catch(n){return console.error("Error loading keywords",n),[]}}));return function(e){return t.apply(this,arguments)}}(),E=function(){var t=(0,i.default)((function*(t,e){try{var n=JSON.stringify(e);yield P.default.setItem(S+t,n)}catch(r){console.error("Error saving keywords",r)}}));return function(e,n){return t.apply(this,arguments)}}(),F=function(){var t,e=(0,C.useAuthContext)().auth,n=e.isLocal?"":`${null==(t=e.user)?void 0:t.id}`;return(0,w.useQuery)({queryKey:["keywords",n],queryFn:function(){var t=(0,i.default)((function*(){return yield k(n)}));return function(){return t.apply(this,arguments)}}()})},T=(0,C.axiosCreate)("notebook"),L=(function(){var t=(0,i.default)((function*(t){return(yield T.get(`/api/v1/content/${t}`)).data}))}(),function(){var t=(0,i.default)((function*(t,e){var n=void 0!==t?`&parentId=${t}`:"",r=void 0!==e?`&types=${e.join(",")}`:"";return(yield T.get(`/api/v1/content?self=true&size=256${n}${r}`)).data.value}));return function(e,n){return t.apply(this,arguments)}}()),D=function(){var t=(0,i.default)((function*(t){return(yield T.post("/api/v1/content",t)).data.id}));return function(e){return t.apply(this,arguments)}}(),N=function(){var t=(0,i.default)((function*(t){var e=t.id,n=t.updated;yield T.patch("/api/v1/content",{ids:[e],updated:n})}));return function(e){return t.apply(this,arguments)}}(),R=(function(){var t=(0,i.default)((function*(t){yield T.delete(`/api/v1/content/${t}`)}))}(),function(){var t=(0,i.default)((function*(t){return(yield T.get(`/api/v1/preview/autocomplete?query=${t.query}`)).data}));return function(e){return t.apply(this,arguments)}}());function B(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function I(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?B(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var z,A="@blacktokki:notebook:contents",M="@blacktokki:notebook:recent_pages",q=function(){var t=(0,i.default)((function*(t,e){if(t)return yield L(void 0,[e]);if("SNAPSHOT"===e)return[];try{var n=yield P.default.getItem(A);return n?JSON.parse(n):[]}catch(r){return console.error("Error loading page contents",r),[]}}));return function(e,n){return t.apply(this,arguments)}}(),K=function(){var t=(0,i.default)((function*(t,e,n){if(t){var r=e.find((function(t){return n===t.id}));if(r){var i=yield n?N({id:n,updated:r}).then((function(){return n})):D(r),o=I(I({},r),{},{type:"SNAPSHOT",id:void 0,parentId:i});yield D(o)}}else try{var u=JSON.stringify(e);yield P.default.setItem(A,u)}catch(a){console.error("Error saving page contents",a)}}));return function(e,n,r){return t.apply(this,arguments)}}(),H=function(){var t=(0,i.default)((function*(){try{var t=yield P.default.getItem(M);return t?JSON.parse(t):[]}catch(e){return console.error("Error loading recent pages",e),[]}}));return function(){return t.apply(this,arguments)}}(),Q=function(){var t=(0,i.default)((function*(t){try{var e=JSON.stringify(t);yield P.default.setItem(M,e)}catch(n){console.error("Error saving recent pages",n)}}));return function(e){return t.apply(this,arguments)}}(),W=function(){var t=(0,C.useAuthContext)().auth;return(0,w.useQuery)({queryKey:["pageContents",!t.isLocal],queryFn:function(){var e=(0,i.default)((function*(){return yield q(!t.isLocal,"NOTE")}));return function(){return e.apply(this,arguments)}}()})},$=function(){var t=(0,C.useAuthContext)().auth;return(0,w.useQuery)({queryKey:["snapshotContents",!t.isLocal],queryFn:function(){var e=(0,i.default)((function*(){return yield q(!t.isLocal,"SNAPSHOT")}));return function(){return e.apply(this,arguments)}}()})},_=function(t){var e=(0,w.useQueryClient)(),n=W(),r=n.data,o=void 0===r?[]:r,u=n.isFetching;return(0,w.useQuery)({queryKey:["pageContent",t],queryFn:function(){var n=(0,i.default)((function*(){var n=o.find((function(e){return e.title===t}));n&&(void 0===(yield H()).find((function(e){return e===t}))&&(z=t,yield e.invalidateQueries({queryKey:["lastPage"]})));return n||{title:t,description:"",id:void 0}}));return function(){return n.apply(this,arguments)}}(),enabled:!u})},V=function(){var t=W(),e=t.data,n=void 0===e?[]:e,r=t.isFetching;return(0,w.useQuery)({queryKey:["lastPage"],queryFn:function(){var t=(0,i.default)((function*(){return n.find((function(t){return t.title===z}))}));return function(){return t.apply(this,arguments)}}(),enabled:!r})},J=function(){var t=(0,w.useQueryClient)(),e=(0,C.useAuthContext)().auth,n=W().data,r=void 0===n?[]:n;return(0,w.useMutation)({mutationFn:function(){var t=(0,i.default)((function*(t){var n,i=t.title,o=t.description,u=r.find((function(t){return t.title===i})),a=e.isLocal?(new Date).toISOString():void 0;if(u)n=r.map((function(t,e){return t.id===u.id?I(I({},t),{},{description:o,updated:a}):t}));else{var l,s={title:i,description:o,input:i,userId:(null==(l=e.user)?void 0:l.id)||0,parentId:0,type:"NOTE",order:0,updated:a,option:{}};n=[].concat((0,p.default)(r),[s])}return yield K(!e.isLocal,n,null==u?void 0:u.id),{title:i,description:o}}));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(){var e=(0,i.default)((function*(e){yield t.invalidateQueries({queryKey:["pageContents"]}),yield t.invalidateQueries({queryKey:["snapshotContents"]}),yield t.invalidateQueries({queryKey:["pageContent",e.title]}),yield t.invalidateQueries({queryKey:["recentPages"]})}));return function(t){return e.apply(this,arguments)}}()})},U=function(){var t=(0,w.useQueryClient)();return(0,w.useMutation)({mutationFn:function(){var t=(0,i.default)((function*(t){var e=(yield H()).filter((function(e){return t!==e}));return z=void 0,yield Q(e),{title:t}}));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(e){t.invalidateQueries({queryKey:["recentPages"]}),t.invalidateQueries({queryKey:["pageContent"]}),t.invalidateQueries({queryKey:["lastPage"]})}})},G=function(t){return j.default.create({container:{flex:1,backgroundColor:"dark"===t?"#121212":"#FFFFFF",paddingHorizontal:24,paddingVertical:16},card:{backgroundColor:"dark"===t?"#1E1E1E":"#FFFFFF",borderRadius:8,padding:16,marginBottom:16,borderWidth:1,borderColor:"dark"===t?"#333333":"#EEEEEE",shadowColor:"dark"===t?"#000000":"#888888",shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:4,elevation:2},title:{fontSize:18,fontWeight:"bold",marginBottom:8,color:"dark"===t?"#FFFFFF":"#000000"},text:{fontSize:16,color:"dark"===t?"#E4E4E4":"#333333",lineHeight:24},button:{backgroundColor:"dark"===t?"#2C73B5":"#3498DB",borderRadius:4,padding:12,alignItems:"center",marginVertical:8},buttonText:{color:"#FFFFFF",fontWeight:"500",fontSize:16},searchButton:{backgroundColor:"#3498DB",justifyContent:"center",alignItems:"center",width:36,height:36,borderRadius:4,marginHorizontal:4},resultSeparator:{height:1,backgroundColor:"dark"===t?"#333333":"#EEEEEE"},input:{backgroundColor:"dark"===t?"#222222":"#FFFFFF",borderWidth:1,borderColor:"dark"===t?"#444444":"#CCCCCC",borderRadius:4,padding:10,color:"dark"===t?"#E4E4E4":"#333333",marginBottom:16},separator:{height:1,backgroundColor:"dark"===t?"#333333":"#EEEEEE",marginVertical:12},smallText:{fontSize:14,color:"dark"===t?"#BBBBBB":"#777777"},header:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:16},flex:{flex:1},row:{flexDirection:"row",alignItems:"center"},centerContent:{justifyContent:"center",alignItems:"center"}})},Y=n(50575);function X(t){for(var e=(new DOMParser).parseFromString(t,"text/html"),n=[{path:"",title:"",header:"",level:0,description:""}],r=["H1","H2","H3","H4","H5","H6"],i=[],o=null,u=e.body.firstChild,a=function(){o&&(n.push(o),o=null)};u;){if(u.nodeType===Node.ELEMENT_NODE){var l=u;if(r.includes(l.tagName)){var s;a();for(var c=parseInt(l.tagName.substring(1),10),d=(null==(s=l.textContent)?void 0:s.trim())||"";i.length>0&&i[i.length-1].level>=c;)i.pop();i.push({level:c,title:d});var f=i.map((function(t){return t.title})).join(" > ");o={path:f,title:d,level:c,header:l.outerHTML,description:""}}else o?o.description+=l.outerHTML:n[0].description+=l.outerHTML}else u.nodeType===Node.TEXT_NODE&&o&&(o.description+=u.textContent||"");u=u.nextSibling}return a(),n}function Z(t){var e=(0,o.useColorScheme)(),n=G(e);return(0,Y.jsx)(y.default,{style:[tt.resultsContainer,"dark"===e?tt.darkResults:tt.lightResults],children:(0,Y.jsx)(x.default,{data:t.data,keyExtractor:function(t){return t.path},renderItem:function(e){return function(e){return(0,Y.jsxs)(v.default,{style:tt.resultItem,onPress:function(){return t.onPress(e)},children:[0===e.level&&(0,Y.jsx)(O.default,{name:"file-text-o",size:18,color:"#FFFFFF"}),(0,Y.jsx)(o.Text,{style:[t.path===e.path?[n.title,{marginBottom:5,marginTop:3}]:n.text,tt.resultText,{left:10*e.level+10}],children:0===e.level?t.root:e.title})]})}(e.item)},ItemSeparatorComponent:function(){return(0,Y.jsx)(y.default,{style:n.resultSeparator})}})})}var tt=j.default.create({backButton:{padding:8},resultItem:{padding:10,flexDirection:"row"},resultText:{fontSize:14},buttonContainer:{flexDirection:"row",justifyContent:"space-between"},resultsContainer:{borderWidth:1,borderRadius:4},lightResults:{backgroundColor:"#FFFFFF",borderColor:"#CCCCCC"},darkResults:{backgroundColor:"#222222",borderColor:"#444444"}});function et(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function nt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?et(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var rt="";function it(t){var e=new URL(t);if(location.origin===e.origin){var n=new URLSearchParams(e.search),r=n.get("title"),i=n.get("section")||void 0;if(r)return{title:r,section:i}}}function ot(t,e){var n=it(t);n?e.push("NotePage",n):window.open(t,"_blank")}function ut(t){return t.flatMap((function(t){return function(t){var e=(new DOMParser).parseFromString(t,"text/html").querySelectorAll("a");return Array.from(e).map((function(t){var e;return{text:(null==(e=t.textContent)?void 0:e.trim())||t.href,url:t.href}}))}(t.description||"").map((function(e){var n=it(e.url);if(n&&e.text!==n.title)return nt(nt({type:"_NOTELINK",name:e.text},n),{},{origin:t.title})})).filter((function(t){return void 0!==t}))}))}var at=function(t,e){var n=e.toLowerCase(),r=ut(t);return[].concat((0,p.default)(t.filter((function(t){return t.title.toLowerCase().startsWith(n)}))),(0,p.default)(r.filter((function(t){return t.name.toLowerCase().startsWith(n)}))))},lt=function(){var t=(0,o.useColorScheme)(),e=G(t),n=(0,h.useNavigation)(),r=W().data,i=(void 0===r?[]:r).filter((function(t){return t.description}));return i&&(0,Y.jsx)(v.default,{style:e.searchButton,onPress:function(){var t=i[Math.floor(Math.random()*i.length)],e=X(t.description||"");n.push("NotePage",{title:t.title,section:e[Math.floor(Math.random()*e.length)].title})},children:(0,Y.jsx)(O.default,{name:"random",size:18,color:"#FFFFFF"})})},st=function(t){return`${t.title}${t.section?" \u25b6 "+t.section:""}`},ct=function(t){var e=t.filteredPages,n=t.handlePagePress,r=t.addKeyword,i=(0,o.useColorScheme)(),u=G(i),l=(0,a.useCallback)((function(t){return b.default.create({onPanResponderStart:function(){"_NOTELINK"===t.type&&t.section?(n(t.title,t.section),null==r||r(t)):(n(t.title),null==r||r({type:"_KEYWORD",title:t.title}))}}).panHandlers}),[]);return(0,Y.jsx)(x.default,{data:e,keyExtractor:function(t){return JSON.stringify([t.title,t.name,t.section])},renderItem:function(t){var e=t.item;return(0,Y.jsxs)(v.default,nt(nt({style:ft.resultItem},l(e)),{},{children:[(0,Y.jsx)(m.default,{style:[u.text,ft.resultText],children:"_NOTELINK"===e.type?e.name:e.title}),"_NOTELINK"===e.type&&(0,Y.jsx)(m.default,{style:[u.text,ft.resultText,{fontSize:12}],children:st(e)})]}))},ItemSeparatorComponent:function(){return(0,Y.jsx)(y.default,{style:[u.resultSeparator]})}})},dt=function(t){var e=t.handlePress,n=t.useRandom,r=void 0===n||n,u=(0,a.useState)(rt),l=(0,f.default)(u,2),s=l[0],c=l[1],d=(0,a.useState)(!1),x=(0,f.default)(d,2),j=x[0],P=x[1],S=(0,h.useNavigation)(),T=(0,o.useColorScheme)(),L=G(T),D=(0,a.useRef)(),N=F().data,R=void 0===N?[]:N,B=function(){var t,e=(0,w.useQueryClient)(),n=(0,C.useAuthContext)().auth,r=n.isLocal?"":`${null==(t=n.user)?void 0:t.id}`;return(0,w.useMutation)({mutationFn:function(){var t=(0,i.default)((function*(t){var e=yield k(r),n=(0,p.default)(new Set([JSON.stringify(t)].concat((0,p.default)(e.map((function(t){return JSON.stringify(t)})))))).map((function(t){return JSON.parse(t)}));yield E(r,n)}));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(){var t=(0,i.default)((function*(){yield e.invalidateQueries({queryKey:["keywords",r]})}));return function(){return t.apply(this,arguments)}}()})}(),I=W().data,z=void 0===I?[]:I,A=s.length>0?at(z,s).slice(0,10):R.slice(0,10),M=function(){s.trim()&&(q(s.trim()),B.mutate({type:"_KEYWORD",title:s.trim()}))},q=function(t,n){e?e(t):S.push("NotePage",{title:t,section:n}),c("")},K=(0,a.useMemo)((function(){return b.default.create({onPanResponderStart:M}).panHandlers}),[s]);return(0,a.useEffect)((function(){rt=s}),[s]),(0,h.useFocusEffect)((function(){s!==rt&&c(rt)})),(0,Y.jsxs)(y.default,{style:ft.container,children:[(0,Y.jsxs)(y.default,{style:ft.searchContainer,children:[(0,Y.jsx)(g.default,{ref:function(t){D.current=t},style:[L.input,ft.searchInput],value:s,onChangeText:function(t){c(t)},placeholder:"\uac80\uc0c9",placeholderTextColor:"dark"===T?"#777777":"#999999",onSubmitEditing:M,onFocus:function(){return P(!0)},onBlur:function(){return P(!1)}}),(0,Y.jsx)(v.default,{style:L.searchButton,onPress:M,disabled:!s.trim(),children:(0,Y.jsx)(O.default,{name:"search",size:18,color:"#FFFFFF"})}),r&&(0,Y.jsx)(lt,{})]}),j&&(0,Y.jsx)(y.default,{style:[ft.resultsContainer,"dark"===T?ft.darkResults:ft.lightResults],children:A.length>0?(0,Y.jsx)(ct,{filteredPages:A,handlePagePress:q,addKeyword:B.mutate}):s.trim()?(0,Y.jsx)(v.default,nt(nt({style:ft.resultItem},K),{},{children:(0,Y.jsxs)(m.default,{style:[L.text,ft.resultText],children:['"',s,'" \uc0c8 \ub178\ud2b8 \ub9cc\ub4e4\uae30']})})):null})]})},ft=j.default.create({container:{position:"relative",width:"100%",maxWidth:960,zIndex:999},searchContainer:{flexDirection:"row"},searchInput:{flex:1,height:36,marginBottom:0,paddingVertical:4,fontSize:14},resultsContainer:{position:"absolute",top:40,left:0,right:0,maxHeight:500,borderWidth:1,borderRadius:4,zIndex:999,elevation:5},lightResults:{backgroundColor:"#FFFFFF",borderColor:"#CCCCCC"},darkResults:{backgroundColor:"#222222",borderColor:"#444444"},resultItem:{flexDirection:"row",justifyContent:"space-between",padding:10},resultText:{fontSize:14}}),pt=function(t){var e=t.contents,n=t.isLoading,r=t.onPress,i=t.emptyMessage,u=(0,o.useColorScheme)(),a=G(u),l=(0,o.useResizeContext)();return(0,Y.jsxs)(Y.Fragment,{children:["portrait"===l&&(0,Y.jsx)(dt,{}),(0,Y.jsx)(y.default,{style:a.container,children:n?(0,Y.jsx)(y.default,{style:[a.card,a.centerContent],children:(0,Y.jsx)(m.default,{style:a.text,children:"\ub85c\ub529 \uc911..."})}):e.length>0?(0,Y.jsx)(x.default,{data:e,keyExtractor:function(t){return JSON.stringify([t.title,t.section,t.id])},renderItem:function(t){var e=t.item;return(0,Y.jsxs)(v.default,{style:a.card,onPress:function(){return r(e.title,e.section,e.id)},children:[(0,Y.jsx)(m.default,{style:a.title,children:st(e)}),void 0!==e.subtitle&&(0,Y.jsx)(m.default,{style:a.smallText,children:e.subtitle})]})},ItemSeparatorComponent:function(){return(0,Y.jsx)(y.default,{style:{height:8}})}}):(0,Y.jsx)(y.default,{style:[a.card,a.centerContent],children:(0,Y.jsx)(m.default,{style:a.text,children:i})})})]})},ht=n(9367),yt=n(46072),gt=n(76579),vt=n(40205),xt=n(57687);function mt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function jt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?mt(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var bt=function(){var t=(0,o.useLangContext)().lang;return(0,Y.jsx)(gt.default,{left:function(t){return(0,Y.jsx)(l.default,jt(jt({},t),{},{icon:"note-remove"}))},title:t("Empty Note"),onPress:function(){return(0,u.push)("EmptyPages")}})},Ot=function(){var t=(0,o.useLangContext)().lang;return(0,Y.jsx)(gt.default,{left:function(t){return(0,Y.jsx)(l.default,jt(jt({},t),{},{icon:"note-edit"}))},title:t("Empty Content"),onPress:function(){return(0,u.push)("EmptyContents")}})},Ct=function(t){return t.filter((function(t){return t.description})).sort((function(t,e){return new Date(e.updated).getTime()-new Date(t.updated).getTime()}))};const Pt=function(t){var e=(0,o.useLangContext)().lang,n=W(),r=function(){var t=W(),e=t.data,n=void 0===e?[]:e,r=t.isFetching;return(0,w.useQuery)({queryKey:["recentPages"],queryFn:function(){var t=(0,i.default)((function*(){return(yield H()).map((function(t){return n.find((function(e){return e.title===t}))})).filter((function(t){return void 0!==t}))}));return function(){return t.apply(this,arguments)}}(),enabled:!r})}(),s=V().data,c=a.useRef(),d=function(){var t=(0,w.useQueryClient)();return(0,w.useMutation)({mutationFn:function(){var t=(0,i.default)((function*(t){var e=t.title,n=t.direct,r=yield H();if(void 0===r.find((function(t){return t===e}))||n){var i=[e].concat((0,p.default)(r));yield Q(i)}return{title:e}}));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(e){t.invalidateQueries({queryKey:["recentPages"]})}})}(),f=U(),h="NOTE"===t.type?n.data?Ct(n.data):[]:r.data,y=s&&void 0===(null==h?void 0:h.find((function(t){return t.id===s.id}))),g=(0,o.useResizeContext)(),v="landscape"===g?5:8,x=function(t){t===(null==s?void 0:s.title)&&(c.current?(clearTimeout(c.current),c.current=void 0,d.mutate({title:t})):c.current=setTimeout((function(){c.current=void 0}),500)),(0,u.navigate)("NotePage",{title:t})},m=function(t){var e;c.current&&(clearTimeout(c.current),c.current=void 0),void 0===(null==(e=r.data)?void 0:e.find((function(e){return e.title===t})))?d.mutate({title:t,direct:!0}):f.mutate(t)};return("LAST"!==t.type||y)&&(0,Y.jsx)(vt.default,{children:h&&("LAST"===t.type?y&&(0,Y.jsx)(gt.default,{left:function(t){return(0,Y.jsx)(l.default,jt(jt({},t),{},{icon:"file-document"}))},title:s.title,onPress:function(){return x(s.title)},onLongPress:function(){return m(s.title)},style:{padding:v},titleStyle:{fontStyle:"italic"}}):"NOTE"===t.type?(0,Y.jsxs)(Y.Fragment,{children:[h.slice(0,t.noteCount).map((function(t){return(0,Y.jsx)(gt.default,{left:function(e){var n;return(0,Y.jsx)(l.default,jt(jt({},e),{},{icon:void 0===(null==(n=r.data)?void 0:n.find((function(e){return e.title===t.title})))?"notebook":"notebook-edit"}))},title:t.title,onPress:function(){return x(t.title)},onLongPress:function(){return m(t.title)},style:{padding:v}},t.title)})),(0,Y.jsx)(gt.default,{left:function(t){return(0,Y.jsx)(l.default,jt(jt({},t),{},{icon:"notebook-multiple"}))},title:e("more..."),onPress:function(){return(0,u.push)("RecentPages")},style:{padding:v}})]}):h.map((function(t){return(0,Y.jsx)(gt.default,{left:function(t){return(0,Y.jsx)(l.default,jt(jt({},t),{},{icon:"file-document-edit"}))},right:function(e){return(0,Y.jsx)(xt.default,{style:{justifyContent:"center",borderRadius:v,width:40+2*v,height:40+2*v,margin:-v},onPress:function(){return f.mutate(t.title)},children:(0,Y.jsx)(l.default,{style:{left:v-7},icon:"close"})})},title:t.title,onPress:function(){return(0,u.navigate)("NotePage",{title:t.title})},style:{padding:v}},t.title)})))})};function wt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function St(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?wt(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var kt=(new Date).getTimezoneOffset(),Et=function(t){var e=new Date(t);e.setMinutes(e.getMinutes()-kt);var n=e.toISOString().slice(0,16),r=n.slice(0,10);return r===(new Date).toISOString().slice(0,10)?n.slice(11):r};function Ft(t){var e=Array.from(t.attributes);for(var n of e)"href"===n.name?t.setAttribute("href",""):t.removeAttribute(n.name);for(var r of t.children)Ft(r)}function Tt(t){var e=(new DOMParser).parseFromString(t,"text/html").body;for(var n of e.children)Ft(n);return e.innerHTML}var Lt=function(t){return t?20:4},Dt=function(t){return t?250:190},Nt=a.memo((function(t){var e=t.item,n=t.index,r=(0,o.useResizeContext)(),i=Dt("landscape"===r),u=(0,o.useColorScheme)(),l=G(u),s="landscape"===r?2:0,c=(0,a.useState)(n<10),d=(0,f.default)(c,2),p=d[0],y=d[1];if((0,a.useEffect)((function(){if(!p){var t=setTimeout((function(){return y(!0)}),50*n-400);return function(){return clearTimeout(t)}}}),[e,n,p]),null===e)return(0,Y.jsx)(o.View,{style:{flexBasis:"landscape"===r?"33%":"50%",maxWidth:i}});var g=(0,h.useNavigation)(),x=function(){return g.push("NotePage",{title:e.title})};return(0,Y.jsxs)(v.default,{style:{flexBasis:"landscape"===r?"33%":"50%",padding:Lt("landscape"===r),paddingRight:0,minWidth:i,maxWidth:i},onPress:x,children:[(0,Y.jsx)(yt.default,{onPress:x,style:[l.card,{paddingTop:8,aspectRatio:1/Math.sqrt(2),borderRadius:6,marginVertical:10,marginHorizontal:8,overflow:"hidden"}],children:(0,Y.jsx)(yt.default.Content,{style:{padding:0},children:p&&e.descriptionComponent})}),(0,Y.jsxs)(o.View,{style:{flexDirection:"row",marginTop:10,padding:0,justifyContent:"space-between",alignItems:"center",width:"100%"},children:[(0,Y.jsx)(o.Text,{style:{fontSize:14+s,overflow:"hidden"},children:e.title}),(0,Y.jsx)(o.Text,{style:{fontSize:12+s,opacity:.4,textAlign:"right"},children:Et(e.updated)})]})]})})),Rt=a.memo((function(){var t=(0,o.useColorScheme)(),e=G(t),r=(0,o.useResizeContext)(),i=W(),u=i.data,l=void 0===u?[]:u,s=i.isLoading,c=(0,h.useNavigation)(),d=Dt("landscape"===r),f=(0,a.useMemo)((function(){return a.lazy((function(){return n.e(274).then(n.t.bind(n,39274,23))}))}),[]),y=(0,a.useMemo)((function(){return[].concat((0,p.default)(Ct(l).map((function(t){return St(St({},t),{},{descriptionComponent:(0,Y.jsx)(f,{source:{html:Tt(t.description||"").slice(0,300)||""},renderersProps:{a:{onPress:function(){return c.push("NotePage",{title:t.title})}}},tagsStyles:{body:{color:e.text.color}},contentWidth:d})})}))),[null,null])}),[l]),g=(d+5)*("landscape"===r?5:3);return s?(0,Y.jsx)(o.View,{style:[e.card,e.centerContent],children:(0,Y.jsx)(o.Text,{style:e.text,children:"\ub85c\ub529 \uc911..."})}):y.length>2?(0,Y.jsx)(ht.default,{contentContainerStyle:{alignSelf:"center",backgroundColor:"transparent",flexBasis:"100%",maxWidth:g,flexWrap:"wrap",flexDirection:"row",paddingRight:Lt("landscape"===r),justifyContent:"landscape"===r?void 0:"center"},children:(0,Y.jsx)(a.Suspense,{children:y.map((function(t,e){return function(t){var e=t.item,n=t.index;return(0,Y.jsx)(Nt,{index:n,item:e},n)}({item:t,index:e})}))})},r):(0,Y.jsx)(o.View,{style:[e.card,e.centerContent],children:(0,Y.jsx)(o.Text,{style:e.text,children:"\ucd5c\uadfc \uc218\uc815\ud55c \ub178\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."})})}));function Bt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function It(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Bt(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Bt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var zt=n(54426),At=n(95225),Mt=j.default.create({buttonContainer:{flexDirection:"row",justifyContent:"space-between"},cancelButton:{flex:1,marginRight:8,backgroundColor:"#95A5A6"},saveButton:{flex:1,marginLeft:8}}),qt=n(57917),Kt=function(t,e,n){var r,i=null==(r=t.find((function(t){return t.title===e})))?void 0:r.path;return i?t.filter((function(t){return t.path.startsWith(i)})).map((function(t){return(n||t.path!==i?t.header:"")+t.description})).join(""):""},Ht=function(t){var e=t.split("/");return e.length<2?[t]:[e.slice(0,e.length-1).join("/"),e[e.length-1]]},Qt=j.default.create({backButton:{padding:8},pageTitle:{flex:1,fontSize:20},actionButtons:{flexDirection:"row"},actionButton:{padding:8,marginLeft:8}});function Wt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function $t(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Wt(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Wt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var _t=j.default.create({columns:{marginTop:8,marginBottom:16},backButton:{padding:8},buttonContainer:{flexDirection:"row",justifyContent:"space-between"},cancelButton:{flex:1,marginRight:8,backgroundColor:"#95A5A6"},moveButton:{flex:1,marginLeft:8}}),Vt=n(55589),Jt=n(31692),Ut=function(){var t=(0,o.useColorScheme)(),e=(0,o.useLangContext)().lang;return(0,Y.jsxs)(ht.default,{style:{flex:1,backgroundColor:o.Colors[t].background},children:[(0,Y.jsx)(Vt.default,{style:{},selectable:!1,children:e("Open Pages")}),(0,Y.jsx)(Pt,{type:"LAST"}),(0,Y.jsx)(Pt,{type:"PAGE"}),(0,Y.jsx)(Vt.default,{style:{},selectable:!1,children:e("Problems")}),(0,Y.jsx)(bt,{}),(0,Y.jsx)(Ot,{})]})},Gt=function(){return(0,Y.jsx)(Rt,{})},Yt=function(t){var e=(0,o.useColorScheme)(),n=G(e),r=o.Colors[e].text;return(0,Y.jsxs)(v.default,{style:[n.header,{marginBottom:0}],onPress:t.onPress,disabled:!t.onPress,children:[(0,Y.jsx)(o.Text,{style:{fontSize:20,color:r,fontWeight:"600"},children:t.title}),t.onPress&&(0,Y.jsx)(o.Text,{children:">"})]})},Xt=function(){var t,e=(0,o.useLangContext)().lang,n=(0,C.useAuthContext)(),r=n.auth,l=n.dispatch,s=(0,o.useColorScheme)(),c=(0,h.useNavigation)(),d=G(s),p=o.Colors[s].text,g=(0,a.useState)(!1),v=(0,f.default)(g,2),x=v[0],m=v[1],j=F().data,b=void 0===j?[]:j,O=function(){var t,e=(0,w.useQueryClient)(),n=(0,C.useAuthContext)().auth,r=n.isLocal?"":`${null==(t=n.user)?void 0:t.id}`;return(0,w.useMutation)({mutationFn:function(){var t=(0,i.default)((function*(){yield E(r,[])}));return function(){return t.apply(this,arguments)}}(),onSuccess:function(){var t=(0,i.default)((function*(){yield e.invalidateQueries({queryKey:["keywords",r]})}));return function(){return t.apply(this,arguments)}}()})}();return(0,Y.jsxs)(y.default,{children:[(0,Y.jsx)(y.default,{style:d.card,children:(0,Y.jsx)(u.ConfigSections,{})}),(0,Y.jsxs)(y.default,{style:d.card,children:[(0,Y.jsx)(Yt,{title:e("* Search Settings")}),(0,Y.jsxs)(y.default,{style:{flexDirection:"row"},children:[(0,Y.jsx)(o.TextButton,{title:"Search History",textStyle:{fontSize:16,color:p,textDecorationLine:x?"underline":"none"},style:{borderRadius:20},onPress:function(){return m(!x)}}),x&&!!b.length&&(0,Y.jsx)(o.TextButton,{title:"Clear",textStyle:{fontSize:16,color:p},style:{borderRadius:20},onPress:function(){return O.mutate()}})]}),x&&(0,Y.jsx)(y.default,{style:[d.card,{padding:0}],children:(0,Y.jsx)(ct,{filteredPages:b,handlePagePress:function(t,e){return c.push("NotePage",{title:t,section:e})}})})]}),(0,Y.jsx)(y.default,{style:d.card,children:(0,Y.jsx)(Yt,{title:e("* Archive"),onPress:function(){return c.push("Archive",{})}})}),(0,Y.jsxs)(y.default,{style:d.card,children:[(0,Y.jsx)(Yt,{title:e("* Account Settings")}),(0,Y.jsxs)(y.default,{style:{flexDirection:"row"},children:[!!r.user&&(0,Y.jsx)(o.TextButton,{title:"My Account: "+(null==(t=r.user)?void 0:t.username),textStyle:{fontSize:16,color:p,textDecorationLine:r.isLocal?"none":"underline"},style:{borderRadius:20},onPress:function(){return l({type:"LOGOUT_LOCAL"})}}),(0,Y.jsx)(o.TextButton,{title:"Local Account",textStyle:{fontSize:16,color:p,textDecorationLine:r.isLocal?"underline":"none"},style:{borderRadius:20},onPress:function(){return l({type:"LOGIN_LOCAL"})}}),r.user?(0,Y.jsx)(o.TextButton,{title:"Logout",textStyle:{fontSize:16,color:p},style:{borderRadius:20},onPress:function(){return l({type:"LOGOUT_REQUEST"})}}):(0,Y.jsx)(o.TextButton,{title:"Login",textStyle:{fontSize:16,color:p},style:{borderRadius:20},onPress:function(){return l({type:"LOGOUT_LOCAL"})}})]})]})]})},Zt=function(){var t=(0,o.useColorScheme)(),e=G(t);return(0,Y.jsx)(ht.default,{style:{flex:1},contentContainerStyle:[e.container,{backgroundColor:o.Colors[t].background}],children:(0,Y.jsx)(Xt,{})})};var te=function(t){return t.isLocal?"Blacktokki Notebook - Local":"Blacktokki Notebook"},ee={Home:{title:te,component:function(t){t.navigation,t.route;var e=(0,o.useLangContext)().lang,n=(0,o.useColorScheme)(),r=G(n),i=(0,C.useAuthContext)().auth.isLocal?"Blacktokki Notebook - Local":"Blacktokki Notebook",a=[{title:e("Discovery"),component:Ut,icon:(0,Y.jsx)(l.default,{icon:"compass"}),headerRight:function(){return(0,Y.jsx)(Y.Fragment,{})}},{title:e("All Notes"),component:Gt,icon:(0,Y.jsx)(l.default,{icon:"notebook"}),headerRight:function(){return(0,Y.jsx)(Y.Fragment,{})}},{title:e("Config"),component:Zt,icon:(0,Y.jsx)(l.default,{icon:"dots-horizontal"}),headerRight:function(){return(0,Y.jsx)(Y.Fragment,{})}}];return(0,Y.jsx)(u.HomeSection,{tabViews:a,homeView:{title:i,headerRight:function(){return(0,Y.jsx)(dt,{})}},headerTitle:i,children:(0,Y.jsxs)(y.default,{style:[r.container,{width:"100%",justifyContent:"space-between"}],children:[(0,Y.jsx)(Xt,{}),(0,Y.jsx)(o.ContractFooter,{buttons:[{icon:(0,Y.jsx)(Jt.default,{name:"github",size:24,color:o.Colors[n].iconColor}),url:"https://github.com/blacktokki/blacktokki-notebook",isWeb:!0},{icon:(0,Y.jsx)(Jt.default,{name:"mail",size:24,color:o.Colors[n].iconColor}),url:"mailto:ydh051541@naver.com",isWeb:!1}]})]})})},path:"home"},NotePage:{title:te,component:function(){var t=(0,h.useIsFocused)(),e=(0,h.useRoute)(),n=e.params,r=n.title,i=n.section,u=n.archiveId,l=(0,h.useNavigation)(),s=(0,o.useColorScheme)(),c=(0,o.useResizeContext)(),d=G(s),p=(0,a.useState)(!1),g=(0,f.default)(p,2),x=g[0],j=g[1],b=(0,a.useState)(!1),C=(0,f.default)(b,2),P=C[0],w=C[1],S=_(r),k=S.data,E=S.isFetching,F=$().data,T=u?null==F?void 0:F.find((function(t){return t.id===u&&t.description!==(null==k?void 0:k.description)})):void 0,L=function(){l.navigate("EditPage",{title:r})},D=X((null==k?void 0:k.description)||""),N=D.findIndex((function(t){return t.title===i})),R=[{icon:"arrow-left",moveSection:D.findLast((function(t,e){var n;return e<N&&(!P||(null==(n=D[N])?void 0:n.level)>=t.level)})),reverse:!1},{icon:"arrow-right",moveSection:D.find((function(t,e){var n;return e>N&&(!P||(null==(n=D[N])?void 0:n.level)>=t.level)})),reverse:!0}],B=(0,a.useState)(),I=(0,f.default)(B,2),z=I[0],A=I[1];(0,a.useEffect)((function(){var t,e;A(T?T.description:null==(t=i?P?Kt(D,i,!0):null==(e=D.find((function(t){return t.title===i})))?void 0:e.description:null==k?void 0:k.description)?void 0:t.trim())}),[k,T,i,P]),(0,a.useEffect)((function(){j(!1)}),[e]);var M=Ht(r),q="dark"===s?"#E4E4E4":"#333333",K="dark"===s?"#FFFFFF88":"#00000088";return t&&(0,Y.jsxs)(Y.Fragment,{children:["portrait"===c&&(0,Y.jsx)(dt,{}),(0,Y.jsxs)(ht.default,{style:[d.container,{paddingRight:12,scrollbarGutter:"stable"}],contentContainerStyle:{flexGrow:1},children:[(0,Y.jsxs)(y.default,{style:d.header,children:[(0,Y.jsxs)(y.default,{style:{flexDirection:"row"},children:[(0,Y.jsx)(v.default,{onPress:function(){return(2===M.length?l.push:l.navigate)("NotePage",{title:M[0]})},children:(0,Y.jsx)(m.default,{style:[d.title,Qt.pageTitle,i||2===M.length?{color:K}:{}],numberOfLines:1,children:M[0]})}),2===M.length&&(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(m.default,{style:[d.title,Qt.pageTitle,{flex:0}],children:"/"}),(0,Y.jsx)(v.default,{onPress:function(){return l.navigate("NotePage",{title:r})},children:(0,Y.jsx)(m.default,{style:[d.title,Qt.pageTitle,i?{color:K}:{}],numberOfLines:1,children:M[1]})})]}),!!i&&(0,Y.jsx)(m.default,{style:[d.title,Qt.pageTitle,{marginLeft:5}],numberOfLines:1,children:st({title:"",section:i})}),T&&(0,Y.jsx)(m.default,{style:[d.text,{marginLeft:5,fontStyle:"italic"}],children:"("+T.updated+")"})]}),(0,Y.jsxs)(y.default,{style:Qt.actionButtons,children:[!i&&(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsx)(v.default,{onPress:function(){return l.navigate("Archive",{title:r})},style:Qt.actionButton,children:(0,Y.jsx)(O.default,{name:"history",size:16,color:q})})}),!!i&&(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsx)(v.default,{onPress:function(){return w(!P)},style:Qt.actionButton,children:(0,Y.jsx)(O.default,{name:P?"compress":"expand",size:16,color:q})})}),!(!i&&!z)&&!T&&(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(v.default,{onPress:function(){return j(!x)},style:Qt.actionButton,children:(0,Y.jsx)(O.default,{name:"list",size:16,color:q})}),(0,Y.jsx)(v.default,{onPress:function(){l.navigate("MovePage",{title:r,section:i})},style:Qt.actionButton,children:(0,Y.jsx)(O.default,{name:"exchange",size:16,color:q})})]}),!(!i&&!z)&&!T&&!i&&(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsx)(v.default,{onPress:L,style:Qt.actionButton,children:(0,Y.jsx)(O.default,{name:"pencil",size:16,color:q})})})]})]}),(0,Y.jsxs)(y.default,{style:d.flex,children:[(0,Y.jsx)(y.default,{style:!x&&z?[d.card,{padding:0,marginBottom:0}]:{flex:1,position:"absolute"},children:(0,Y.jsx)(zt.EditorViewer,{active:!0,value:z||"",theme:s,onLink:function(t){return ot(t,l)},autoResize:!0})}),E||void 0===z?(0,Y.jsx)(y.default,{style:[d.card,d.centerContent],children:(0,Y.jsx)(qt.default,{size:"large",color:"#3498DB"})}):x?(0,Y.jsx)(Z,{data:D,path:i||"",root:r,onPress:function(t){return l.navigate("NotePage",{title:r,section:t.title})}}):null!=k&&k.description?!!i&&(0,Y.jsx)(y.default,{style:{flex:1,flexDirection:"row",justifyContent:"space-between",alignItems:"flex-end"},children:R.map((function(t){var e=t.moveSection,n=t.icon,i=t.reverse;return void 0!==e&&(0,Y.jsxs)(v.default,{onPress:function(){return l.navigate("NotePage",0===e.level?{title:r}:{title:r,section:e.title})},style:[{flexDirection:i?"row-reverse":"row",paddingVertical:16}],children:[(0,Y.jsx)(O.default,{name:n,size:16,color:q,style:{alignSelf:"center"}}),(0,Y.jsx)(m.default,{style:[d.text,{fontWeight:"bold",marginHorizontal:16}],children:0===e.level?r:e.title})]},n)}))}):(0,Y.jsxs)(y.default,{style:[d.card,d.centerContent],children:[(0,Y.jsx)(m.default,{style:d.text,children:"\uc544\uc9c1 \ub0b4\uc6a9\uc774 \uc5c6\ub294 \ubb38\uc11c\uc785\ub2c8\ub2e4. '\ud3b8\uc9d1' \ubc84\ud2bc\uc744 \ub20c\ub7ec \ub0b4\uc6a9\uc744 \ucd94\uac00\ud574\ubcf4\uc138\uc694."}),(0,Y.jsx)(v.default,{onPress:L,style:d.button,children:(0,Y.jsx)(m.default,{style:d.buttonText,children:"\ud3b8\uc9d1\ud558\uae30"})})]})]})]})]})},path:"page"},EditPage:{title:te,component:function(){var t=(0,h.useRoute)(),e=(0,h.useIsFocused)(),n=t.params.title,r=(0,h.useNavigation)(),u=(0,o.useColorScheme)(),l=G(u),s=_(n),c=s.data,d=s.isLoading,g=W().data,x=void 0===g?[]:g,j=(0,a.useState)(""),b=(0,f.default)(j,2),O=b[0],C=b[1],P=J();return(0,a.useEffect)((function(){!d&&null!=c&&c.description&&C(null==c?void 0:c.description)}),[d,c]),(0,h.useFocusEffect)((function(){var t=function(t){t.preventDefault(),t.returnValue=""};return window.addEventListener("beforeunload",t),function(){return window.removeEventListener("beforeunload",t)}})),e&&(0,Y.jsxs)(y.default,{style:l.container,children:[(0,Y.jsx)(y.default,{style:l.header,children:(0,Y.jsxs)(m.default,{style:[l.title,{flex:1}],children:[n," - \ud3b8\uc9d1"]})}),(0,Y.jsx)(zt.Editor,{active:!0,value:O,setValue:C,theme:u,autoComplete:[{trigger:"[",getMatchedChars:function(){var t=(0,i.default)((function*(t){var e,r=(e=t,x.filter((function(t){return t.title.startsWith(n+"/")})).map((function(t){return{type:"_CHILDNOTE",name:t.title.split(n+"/")[1],title:t.title}})).filter((function(t){return t.name.toLowerCase().startsWith(e.toLowerCase())})));return[{type:"_NOTELINK",name:t,title:n,section:t}].concat((0,p.default)(r.length?r:[{type:"_CHILDNOTE",name:t,title:n+"/"+t}]),(0,p.default)(at(x,t))).map((function(t){var e="_NOTELINK"===t.type?t.name+`(${st(t)})`:"_CHILDNOTE"===t.type?t.name:t.title;return{text:e,value:`<a href=${encodeURI("_NOTELINK"===t.type&&t.section?`?title=${t.title}&section=${t.section}`:`?title=${t.title}`)}>${e}</a>`}}))}));return function(e){return t.apply(this,arguments)}}()},{trigger:"http",getMatchedChars:function(){var t=(0,i.default)((function*(t){var e="http"+t,n=new URL(e);if("http:"!==n.protocol&&"https:"!==n.protocol)return[];var r=yield R({query:e});return r.title?[{text:r.title,value:`<a href=${r.url}>${r.title}</a>`}]:[]}));return function(e){return t.apply(this,arguments)}}()}]}),(0,Y.jsxs)(y.default,{style:Mt.buttonContainer,children:[(0,Y.jsx)(v.default,{style:[l.button,Mt.cancelButton],onPress:function(){r.canGoBack()?r.goBack():r.navigate("NotePage",{title:n})},children:(0,Y.jsx)(m.default,{style:l.buttonText,children:"\ucde8\uc18c"})}),(0,Y.jsx)(v.default,{style:[l.button,Mt.saveButton],onPress:function(){(null==c?void 0:c.description)!==O?P.mutate({title:n,description:O},{onSuccess:function(){r.navigate("NotePage",{title:n})},onError:function(t){At.default.alert("\uc624\ub958",t.message||"\ubb38\uc11c\ub97c \uc800\uc7a5\ud558\ub294 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}}):r.navigate("NotePage",{title:n})},children:(0,Y.jsx)(m.default,{style:l.buttonText,children:"\uc800\uc7a5"})})]})]})},path:"edit"},MovePage:{title:te,component:function(){var t,e=(0,h.useRoute)().params,n=e.title,r=e.section,u=(0,h.useNavigation)(),l=(0,o.useColorScheme)(),s=(0,o.useResizeContext)(),c=(0,a.useState)(n),d=(0,f.default)(c,2),g=d[0],x=d[1],j=_(n),b=j.data,O=j.isLoading,P=X((null==b?void 0:b.description)||""),S=(null==(t=P.find((function(t){return t.title===r})))?void 0:t.path)||"",k=_(g).data,E=X((null==k?void 0:k.description)||"").filter((function(t){return n!==g||S===t.path||!t.path.startsWith(S)})),F=(0,a.useState)(""),T=(0,f.default)(F,2),L=T[0],D=T[1],N=(0,a.useState)(),R=(0,f.default)(N,2),B=R[0],z=R[1],A=G(l),M=J(),q=function(){var t=(0,w.useQueryClient)(),e=W().data,n=void 0===e?[]:e,r=(0,C.useAuthContext)().auth;return(0,w.useMutation)({mutationFn:function(){var t=(0,i.default)((function*(t){var e=t.oldTitle,i=t.newTitle,o=t.description,u=n.find((function(t){return t.title===e}));if(!u)throw new Error("Page not found");if(n.some((function(t){return t.title===i})))throw new Error("Page with new title already exists");var a=n.map((function(t){return t.title===e?I(I({},t),{},{title:i,description:o||u.description}):t}));yield K(!r.isLocal,a,u.id);var l=(yield H()).map((function(t){return t===e?i:t}));return yield Q(l),{oldTitle:e,newTitle:i}}));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(e){t.invalidateQueries({queryKey:["pageContents"]}),t.invalidateQueries({queryKey:["snapshotContents"]}),t.invalidateQueries({queryKey:["pageContent",e.oldTitle]}),t.invalidateQueries({queryKey:["pageContent",e.newTitle]}),t.invalidateQueries({queryKey:["recentPages"]})}})}(),$=(0,a.useMemo)((function(){var t,e=P.filter((function(t){return t.path.startsWith(S)})),n=(null==k?void 0:k.title)===(null==b?void 0:b.title)+"/"+(null==(t=e[0])?void 0:t.title),r=e.map((function(t,e){return(n&&0===e?"":t.header)+t.description})).join(""),i=P.filter((function(t){return!t.path.startsWith(S)})),o=i.map((function(t){return t.header+t.description})).join(""),u=(null==b?void 0:b.title)===(null==k?void 0:k.title)?i:E,a=u.findLastIndex((function(t){return t.path.startsWith(L)}));return{sourceDescription:o,targetDescription:void 0===(null==k?void 0:k.id)?r:[].concat((0,p.default)(u.slice(0,a+1).map((function(t){return t.header+t.description}))),(0,p.default)(e.map((function(t,e){return(t.path===S&&""===t.description||n&&0===e?"":t.header)+t.description}))),(0,p.default)(u.slice(a+1).map((function(t){return t.header+t.description})))).join("")}}),[P,E,S,L]),V=$.sourceDescription,U=$.targetDescription,tt=function(){u.canGoBack()?u.goBack():u.navigate("NotePage",{title:n})};(0,a.useEffect)((function(){O||b||tt(),b&&x(b.title+(r?`/${r}`:""))}),[b,O]),(0,a.useEffect)((function(){O||D(r?"":S)}),[r,O]);var et=P.find((function(t){return t.path===S})),nt=E.find((function(t){return t.path===L})),rt=!g.trim()||void 0===nt;return(0,Y.jsx)(ht.default,{style:A.container,children:(0,Y.jsxs)(y.default,{style:A.card,children:[(0,Y.jsxs)(y.default,{style:{flexDirection:"landscape"===s?"row":"column",zIndex:1},children:[(0,Y.jsxs)(y.default,{style:{zIndex:1},children:[(0,Y.jsx)(m.default,{style:A.text,children:r?"\ud604\uc7ac \ub178\ud2b8 \uc81c\ubaa9 \ubc0f \ubb38\ub2e8:":"\ud604\uc7ac \ub178\ud2b8 \uc81c\ubaa9:"}),(0,Y.jsx)(m.default,{style:[A.title,_t.columns],children:st({title:n,section:r})}),(0,Y.jsx)(m.default,{style:A.text,children:"\uc0c8 \ub178\ud2b8 \uc81c\ubaa9 \ubc0f \ubb38\ub2e8:"}),(0,Y.jsx)(dt,{handlePress:x,useRandom:!1}),(0,Y.jsx)(y.default,{style:_t.columns,children:(0,Y.jsx)(Z,{path:L,onPress:function(t){return D(t.path)},root:(null==k?void 0:k.title)||"",data:E})})]}),(0,Y.jsxs)(y.default,{style:{flex:1},children:[(0,Y.jsx)(m.default,{style:A.text,children:" \ubbf8\ub9ac\ubcf4\uae30:"}),(0,Y.jsxs)(v.default,{style:[A.button,_t.moveButton,{flex:0,flexDirection:"row",alignItems:"center",paddingTop:24,paddingBottom:16}],onPress:function(){return z(!B)},children:[(0,Y.jsx)(m.default,{style:A.title,children:st({title:n,section:null==et?void 0:et.title})}),(0,Y.jsx)(m.default,{style:[A.text,{marginBottom:8,fontSize:14}],children:" \u279c "}),(0,Y.jsx)(m.default,{style:A.title,children:st({title:g,section:null==nt?void 0:nt.title})})]}),void 0!==B&&(0,Y.jsx)(y.default,{style:{display:B?"flex":"none"},children:(0,Y.jsx)(zt.EditorViewer,{active:!0,value:U,theme:l,onLink:function(t){return ot(t,u)},autoResize:!0})})]})]}),(0,Y.jsxs)(y.default,{style:_t.buttonContainer,children:[(0,Y.jsx)(v.default,{style:[A.button,_t.cancelButton],onPress:tt,children:(0,Y.jsx)(m.default,{style:A.buttonText,children:"\ucde8\uc18c"})}),(0,Y.jsx)(v.default,{style:[A.button,rt?_t.cancelButton:_t.moveButton],onPress:function(){void 0===(null==k?void 0:k.id)?q.mutate({oldTitle:n,newTitle:g.trim(),description:""===S?void 0:U},{onSuccess:function(t){u.navigate({name:"NotePage",params:{title:t.newTitle}})},onError:function(t){At.default.alert("\uc624\ub958",t.message||"\ub178\ud2b8 \uc774\ub3d9 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}}):((null==b?void 0:b.title)===k.title&&S===L&&tt(),M.mutate({title:k.title,description:U},{onSuccess:function(t){(null==b?void 0:b.title)!==k.title&&M.mutate({title:n,description:V}),u.navigate({name:"NotePage",params:{title:t.title}})},onError:function(t){At.default.alert("\uc624\ub958",t.message||"\ub178\ud2b8 \uc774\ub3d9 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}}))},disabled:rt,children:(0,Y.jsx)(m.default,{style:A.buttonText,children:"\uc774\ub3d9"})})]})]})})},path:"move"},RecentPages:{title:te,component:function(){var t=(0,o.useResizeContext)();return(0,Y.jsxs)(Y.Fragment,{children:["portrait"===t&&(0,Y.jsx)(dt,{}),(0,Y.jsx)(Rt,{})]})},path:"recent"},EmptyPages:{title:te,component:function(){var t=(0,h.useNavigation)(),e=W(),n=e.data,r=void 0===n?[]:n,i=e.isLoading,o=ut(r).filter((function(t){var e=r.find((function(e){return e.title===t.title}));return null==e||!e.description||void 0!==t.section&&!X(e.description).find((function(e){return e.title===t.section}))})).map((function(t){return $t($t({},t),{},{subtitle:(void 0===t.section?"Unknown note link":"Unknown section link")+`(${t.origin})`})})),u=r.map((function(t){var e=Ht(t.title);if(t.description&&2===e.length&&void 0===r.find((function(t){return t.title===e[0]})))return{title:e[0],subtitle:`Empty parent note(${t.title})`}})).filter((function(t){return void 0!==t}));return(0,Y.jsx)(pt,{contents:[].concat((0,p.default)(o),(0,p.default)(u)),onPress:function(e){return t.push("EditPage",{title:e})},isLoading:i,emptyMessage:"\uc791\uc131\uc774 \ud544\uc694\ud55c \ub178\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."})},path:"need"},EmptyContents:{title:te,component:function(){var t=(0,h.useNavigation)(),e=W(),n=e.data,r=void 0===n?[]:n,i=e.isLoading,o=r.flatMap((function(t){var e=X(t.description||""),n=e.filter((function(t){return 0!==t.level&&""===Kt(e,t.title,!1).trim()})),r=e.filter((function(t){return function(t){for(var e,n=/<(ol|ul)\b[^>]*>([\s\n\r]*)<\/\1>/gi,r=[];null!==(e=n.exec(t));)r.push(e[0]);return r}(t.description).length>0}));return[].concat((0,p.default)(n.map((function(e){return{title:t.title,section:0===e.level?void 0:e.title,subtitle:"Empty section"}}))),(0,p.default)(r.map((function(e){return{title:t.title,section:0===e.level?void 0:e.title,subtitle:"Empty list"}}))))}));return(0,Y.jsx)(pt,{contents:o,onPress:function(e){return t.push("EditPage",{title:e})},isLoading:i,emptyMessage:"\uc791\uc131\uc774 \ud544\uc694\ud55c \ub0b4\uc6a9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."})},path:"empty"},Archive:{title:te,component:function(){var t=(0,h.useNavigation)(),e=(0,h.useRoute)().params.title,n=$(),r=n.data,i=void 0===r?[]:r,o=n.isLoading;return(0,Y.jsx)(pt,{contents:i.filter((function(t){return void 0===e||e===t.title})).sort((function(t,e){return new Date(e.updated).getTime()-new Date(t.updated).getTime()})).map((function(t){return It(It({},t),{},{subtitle:`\ucd5c\uadfc \uc218\uc815: ${Et(t.updated)}`})})),isLoading:o,onPress:function(e,n,r){return(void 0===e?t.push:t.navigate)("NotePage",{title:e,archiveId:r})},emptyMessage:"\ucd5c\uadfc \uc218\uc815\ud55c \ub178\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."})},path:"archive"}},ne=n(52990);function re(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ie(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?re(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):re(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}const oe=function(){var t=(0,o.useLangContext)().lang;return(0,Y.jsxs)(o.View,{style:{flex:1},children:[(0,Y.jsx)(gt.default,{left:function(t){return(0,Y.jsx)(l.default,ie(ie({},t),{},{icon:"home"}))},title:t("Home"),onPress:function(){return(0,u.push)("Home")}}),(0,Y.jsx)(bt,{}),(0,Y.jsx)(Ot,{}),(0,Y.jsxs)(ht.default,{style:"web"===ne.default.OS?{scrollbarWidth:"thin"}:{},children:[(0,Y.jsx)(Vt.default,{style:{},selectable:!1,children:t("Open Pages")}),(0,Y.jsx)(Pt,{type:"LAST"}),(0,Y.jsx)(Pt,{type:"PAGE"}),(0,Y.jsx)(Vt.default,{style:{flex:1},selectable:!1,children:t("Recent Changes")}),(0,Y.jsx)(Pt,{type:"NOTE",noteCount:10})]})]})};function ue(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ae(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ue(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ue(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var le=function(){return"landscape"===(0,o.useResizeContext)()?(0,Y.jsx)(dt,{}):void 0},se=function(){var t=(0,i.default)((function*(){var t=yield Promise.all([n.e(928),n.e(973)]).then(n.bind(n,49928));return{main:ee,login:u.login,prefixes:[t.makeUrl("/")],rootPath:"blacktokki-notebook",documentTitle:{formatter:function(){return"blacktokki-notebook"}},rootScreen:{main:"Home",login:"LoginScreen"},headerLeftIcon:(0,Y.jsx)(l.default,{icon:"backburger",style:{left:-18,top:-14}}),headerRight:(0,Y.jsx)(le,{}),modals:[],drawer:(0,Y.jsx)(oe,{})}}));return function(){return t.apply(this,arguments)}}();const ce=function(){var t=(0,o.useColorScheme)(),e="dark"===t?s.MD2DarkTheme:c.MD2LightTheme,n=ae(ae({},e),{},{colors:ae(ae({},e.colors),{},{primary:o.Colors[t].text})}),r=a.lazy((function(){return se().then((function(t){return{default:function(){return(0,Y.jsx)(u.Navigation,{config:t})}}}))}));return(0,Y.jsx)(d.default,{theme:n,children:(0,Y.jsx)(a.Suspense,{fallback:(0,Y.jsx)(Y.Fragment,{}),children:(0,Y.jsx)(r,{})})})}}}]);
//# sourceMappingURL=279.a79ca4cf.chunk.js.map